<!doctype html>
<html lang="en">
 <head>
  <title>PostgreSQL: Documentation: 13: 50.3. The Parser Stage</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta http-equiv="Content-Type" content="text/xhtml; charset=utf-8" />
   
  <meta name="theme-color" content="#336791"/>
  <meta name="copyright" content="The PostgreSQL Global Development Group" />
  <meta property="og:url" content="https://www.postgresql.org/docs/13/parser-stage.html" />
  <meta property="og:type" content="article" />
  <meta property="article:published_time" content="2025-02-20T14:13:26" />
  <meta property="og:image" content="https://www.postgresql.org/media/img/about/press/elephant.png" />
  <meta property="og:title" content="50.3. The Parser Stage" />
  <meta property="og:description" content="50.3.&amp;nbsp;The Parser Stage 50.3.1. Parser 50.3.2. Transformation Process The parser stage consists of two parts: The parser defined in gram.y …" />
  <meta property="og:site_name" content="PostgreSQL Documentation" />


  

  
  
  
  
  

  

  
  </head>
  <body>
    <div class="container-fluid">
      <div class="row justify-content-md-center">
        <div class="col">
          
          
        </div>
      </div>
      <div class="row justify-content-center pg-shout-box">
        <div class="col text-white text-center">February 20, 2025: <a href="/about/news/postgresql-174-168-1512-1417-and-1320-released-3018/">
  PostgreSQL 17.4, 16.8, 15.12, 14.17, and 13.20 Released!
</a>

</div>
      </div>
    </div>
    <div class="container-fluid margin">
      <div class="row">
        <div id="pgContentWrap" class="col-11">
          <div class="row">
            <div class="col-md-6 mb-2">
              <div class="row">
                <div class="col">
                  <div>
                    <a href="/docs/" title="Documentation">Documentation</a> &rarr; <a href="/docs/13/index.html">PostgreSQL 13</a>
                  </div>
                </div>
              </div>
              
                <div class="row">
                  <div class="col">
                    Supported Versions:
                      
                        
                        
                          <a href="/docs/current/parser-stage.html" title="PostgreSQL 17 - 50.3. The Parser Stage" >Current</a>
                          (<a href="/docs/17/parser-stage.html" title="PostgreSQL 17 - 50.3. The Parser Stage" >17</a>)
                        
                      
                         / 
                        
                          <a href="/docs/16/parser-stage.html" title="PostgreSQL 16 - 50.3. The Parser Stage" >16</a>
                        
                      
                         / 
                        
                          <a href="/docs/15/parser-stage.html" title="PostgreSQL 15 - 50.3. The Parser Stage" >15</a>
                        
                      
                         / 
                        
                          <a href="/docs/14/parser-stage.html" title="PostgreSQL 14 - 50.3. The Parser Stage" >14</a>
                        
                      
                         / 
                        
                          <a href="/docs/13/parser-stage.html" title="PostgreSQL 13 - 50.3. The Parser Stage" class="docs-version-selected">13</a>
                        
                      
                  </div>
                </div>
              
              
                <div class="row">
                  <div class="col">
                    Development Versions:
                    
                      
                      <a href="/docs/devel/parser-stage.html" title="PostgreSQL devel - 50.3. The Parser Stage"  rel="nofollow">devel</a>
                    
                  </div>
                </div>
              
              
                <div class="row">
                  <div class="col-12">
                    Unsupported versions:
                    
                      
                      <a href="/docs/12/parser-stage.html" title="PostgreSQL 12 - 50.3. The Parser Stage"  rel="nofollow">12</a>
                    
                       / 
                      <a href="/docs/11/parser-stage.html" title="PostgreSQL 11 - 50.3. The Parser Stage"  rel="nofollow">11</a>
                    
                       / 
                      <a href="/docs/10/parser-stage.html" title="PostgreSQL 10 - 50.3. The Parser Stage"  rel="nofollow">10</a>
                    
                       / 
                      <a href="/docs/9.6/parser-stage.html" title="PostgreSQL 9.6 - 50.3. The Parser Stage"  rel="nofollow">9.6</a>
                    
                       / 
                      <a href="/docs/9.5/parser-stage.html" title="PostgreSQL 9.5 - 50.3. The Parser Stage"  rel="nofollow">9.5</a>
                    
                       / 
                      <a href="/docs/9.4/parser-stage.html" title="PostgreSQL 9.4 - 50.3. The Parser Stage"  rel="nofollow">9.4</a>
                    
                       / 
                      <a href="/docs/9.3/parser-stage.html" title="PostgreSQL 9.3 - 50.3. The Parser Stage"  rel="nofollow">9.3</a>
                    
                       / 
                      <a href="/docs/9.2/parser-stage.html" title="PostgreSQL 9.2 - 50.3. The Parser Stage"  rel="nofollow">9.2</a>
                    
                       / 
                      <a href="/docs/9.1/parser-stage.html" title="PostgreSQL 9.1 - 50.3. The Parser Stage"  rel="nofollow">9.1</a>
                    
                       / 
                      <a href="/docs/9.0/parser-stage.html" title="PostgreSQL 9.0 - 50.3. The Parser Stage"  rel="nofollow">9.0</a>
                    
                       / 
                      <a href="/docs/8.4/parser-stage.html" title="PostgreSQL 8.4 - 50.3. The Parser Stage"  rel="nofollow">8.4</a>
                    
                       / 
                      <a href="/docs/8.3/parser-stage.html" title="PostgreSQL 8.3 - 50.3. The Parser Stage"  rel="nofollow">8.3</a>
                    
                       / 
                      <a href="/docs/8.2/parser-stage.html" title="PostgreSQL 8.2 - 50.3. The Parser Stage"  rel="nofollow">8.2</a>
                    
                       / 
                      <a href="/docs/8.1/parser-stage.html" title="PostgreSQL 8.1 - 50.3. The Parser Stage"  rel="nofollow">8.1</a>
                    
                       / 
                      <a href="/docs/8.0/parser-stage.html" title="PostgreSQL 8.0 - 50.3. The Parser Stage"  rel="nofollow">8.0</a>
                    
                       / 
                      <a href="/docs/7.4/parser-stage.html" title="PostgreSQL 7.4 - 50.3. The Parser Stage"  rel="nofollow">7.4</a>
                    
                       / 
                      <a href="/docs/7.3/parser-stage.html" title="PostgreSQL 7.3 - 50.3. The Parser Stage"  rel="nofollow">7.3</a>
                    
                       / 
                      <a href="/docs/7.2/parser-stage.html" title="PostgreSQL 7.2 - 50.3. The Parser Stage"  rel="nofollow">7.2</a>
                    
                       / 
                      <a href="/docs/7.1/parser-stage.html" title="PostgreSQL 7.1 - 50.3. The Parser Stage"  rel="nofollow">7.1</a>
                    
                  </div>
                </div>
              
            </div>
            <div class="col-md-6 col-lg-5 offset-lg-1">
              <form id="docSearchForm" role="search" method="get" action="/search/">
                <input type="hidden" name="u" value="/docs/13/" />
                <div class="input-group">
                  <input type="text" id="q" name="q" class="form-control" placeholder="Search the documentation for..."/>
                  <span class="input-group-btn">
                    <button class="btn btn-default" type="submit"><i class="fas fa-search"></i></button>
                  </span>
                </div>
              </form>
            </div>
          </div>

          <div id="docContent">
            <div xmlns="http://www.w3.org/TR/xhtml1/transitional" class="navheader">
  <table width="100%" summary="Navigation header">
    <tr>
      <th colspan="5" align="center">50.3.&nbsp;The Parser Stage</th>
    </tr>
    <tr>
      <td width="10%" align="left"><a accesskey="p" href="connect-estab.html" title="50.2.&nbsp;How Connections Are Established">Prev</a>&nbsp;</td>
      <td width="10%" align="left"><a accesskey="u" href="overview.html" title="Chapter&nbsp;50.&nbsp;Overview of PostgreSQL Internals">Up</a></td>
      <th width="60%" align="center">Chapter&nbsp;50.&nbsp;Overview of PostgreSQL Internals</th>
      <td width="10%" align="right"><a accesskey="h" href="index.html" title="PostgreSQL 13.20 Documentation">Home</a></td>
      <td width="10%" align="right">&nbsp;<a accesskey="n" href="rule-system.html" title="50.4.&nbsp;The PostgreSQL Rule System">Next</a></td>
    </tr>
  </table>
  <hr />
</div>
<div class="sect1" id="PARSER-STAGE">
  <div class="titlepage">
    <div>
      <div>
        <h2 class="title" style="clear: both">50.3.&nbsp;The Parser Stage</h2>
      </div>
    </div>
  </div>
  <div class="toc">
    <dl class="toc">
      <dt><span class="sect2"><a href="parser-stage.html#id-1.10.3.6.3">50.3.1. Parser</a></span></dt>
      <dt><span class="sect2"><a href="parser-stage.html#id-1.10.3.6.4">50.3.2. Transformation Process</a></span></dt>
    </dl>
  </div>
  <p>The <em class="firstterm">parser stage</em> consists of two parts:</p>
  <div class="itemizedlist">
    <ul class="itemizedlist" style="list-style-type: disc;">
      <li class="listitem">
        <p>The <em class="firstterm">parser</em> defined in <code class="filename">gram.y</code> and <code class="filename">scan.l</code> is built using the Unix tools <span class="application">bison</span> and <span class="application">flex</span>.</p>
      </li>
      <li class="listitem">
        <p>The <em class="firstterm">transformation process</em> does modifications and augmentations to the data structures returned by the parser.</p>
      </li>
    </ul>
  </div>
  <div class="sect2" id="id-1.10.3.6.3">
    <div class="titlepage">
      <div>
        <div>
          <h3 class="title">50.3.1.&nbsp;Parser</h3>
        </div>
      </div>
    </div>
    <p>The parser has to check the query string (which arrives as plain text) for valid syntax. If the syntax is correct a <em class="firstterm">parse tree</em> is built up and handed back; otherwise an error is returned. The parser and lexer are implemented using the well-known Unix tools <span class="application">bison</span> and <span class="application">flex</span>.</p>
    <p>The <em class="firstterm">lexer</em> is defined in the file <code class="filename">scan.l</code> and is responsible for recognizing <em class="firstterm">identifiers</em>, the <em class="firstterm">SQL key words</em> etc. For every key word or identifier that is found, a <em class="firstterm">token</em> is generated and handed to the parser.</p>
    <p>The parser is defined in the file <code class="filename">gram.y</code> and consists of a set of <em class="firstterm">grammar rules</em> and <em class="firstterm">actions</em> that are executed whenever a rule is fired. The code of the actions (which is actually C code) is used to build up the parse tree.</p>
    <p>The file <code class="filename">scan.l</code> is transformed to the C source file <code class="filename">scan.c</code> using the program <span class="application">flex</span> and <code class="filename">gram.y</code> is transformed to <code class="filename">gram.c</code> using <span class="application">bison</span>. After these transformations have taken place a normal C compiler can be used to create the parser. Never make any changes to the generated C files as they will be overwritten the next time <span class="application">flex</span> or <span class="application">bison</span> is called.</p>
    <div class="note">
      <h3 class="title">Note</h3>
      <p>The mentioned transformations and compilations are normally done automatically using the <em class="firstterm">makefiles</em> shipped with the <span class="productname">PostgreSQL</span> source distribution.</p>
    </div>
    <p>A detailed description of <span class="application">bison</span> or the grammar rules given in <code class="filename">gram.y</code> would be beyond the scope of this paper. There are many books and documents dealing with <span class="application">flex</span> and <span class="application">bison</span>. You should be familiar with <span class="application">bison</span> before you start to study the grammar given in <code class="filename">gram.y</code> otherwise you won't understand what happens there.</p>
  </div>
  <div class="sect2" id="id-1.10.3.6.4">
    <div class="titlepage">
      <div>
        <div>
          <h3 class="title">50.3.2.&nbsp;Transformation Process</h3>
        </div>
      </div>
    </div>
    <p>The parser stage creates a parse tree using only fixed rules about the syntactic structure of SQL. It does not make any lookups in the system catalogs, so there is no possibility to understand the detailed semantics of the requested operations. After the parser completes, the <em class="firstterm">transformation process</em> takes the tree handed back by the parser as input and does the semantic interpretation needed to understand which tables, functions, and operators are referenced by the query. The data structure that is built to represent this information is called the <em class="firstterm">query tree</em>.</p>
    <p>The reason for separating raw parsing from semantic analysis is that system catalog lookups can only be done within a transaction, and we do not wish to start a transaction immediately upon receiving a query string. The raw parsing stage is sufficient to identify the transaction control commands (<code class="command">BEGIN</code>, <code class="command">ROLLBACK</code>, etc), and these can then be correctly executed without any further analysis. Once we know that we are dealing with an actual query (such as <code class="command">SELECT</code> or <code class="command">UPDATE</code>), it is okay to start a transaction if we're not already in one. Only then can the transformation process be invoked.</p>
    <p>The query tree created by the transformation process is structurally similar to the raw parse tree in most places, but it has many differences in detail. For example, a <code class="structname">FuncCall</code> node in the parse tree represents something that looks syntactically like a function call. This might be transformed to either a <code class="structname">FuncExpr</code> or <code class="structname">Aggref</code> node depending on whether the referenced name turns out to be an ordinary function or an aggregate function. Also, information about the actual data types of columns and expression results is added to the query tree.</p>
  </div>
</div>
<div xmlns="http://www.w3.org/TR/xhtml1/transitional" class="navfooter">
  <hr />
  <table width="100%" summary="Navigation footer">
    <tr>
      <td width="40%" align="left"><a accesskey="p" href="connect-estab.html" title="50.2.&nbsp;How Connections Are Established">Prev</a>&nbsp;</td>
      <td width="20%" align="center"><a accesskey="u" href="overview.html" title="Chapter&nbsp;50.&nbsp;Overview of PostgreSQL Internals">Up</a></td>
      <td width="40%" align="right">&nbsp;<a accesskey="n" href="rule-system.html" title="50.4.&nbsp;The PostgreSQL Rule System">Next</a></td>
    </tr>
    <tr>
      <td width="40%" align="left" valign="top">50.2.&nbsp;How Connections Are Established&nbsp;</td>
      <td width="20%" align="center"><a accesskey="h" href="index.html" title="PostgreSQL 13.20 Documentation">Home</a></td>
      <td width="40%" align="right" valign="top">&nbsp;50.4.&nbsp;The <span xmlns="http://www.w3.org/1999/xhtml" class="productname">PostgreSQL</span> Rule System</td>
    </tr>
  </table>
</div>

          </div>
          
            <div id="docComments">
              <h2>Submit correction</h2>
              <p>
              If you see anything in the documentation that is not correct, does not match
              your experience with the particular feature or requires further clarification,
              please use
              <a href="/account/comments/new/13/parser-stage.html/" rel="nofollow">this form</a>
              to report a documentation issue.
              </p>
            </div>
          
        </div> 
      </div>
    </div>
    
    
    
    
    
    
  </body>
</html>
