<!doctype html>
<html lang="en">
 <head>
  <title>PostgreSQL: Documentation: 13: 43.2. PL/Tcl Functions and Arguments</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta http-equiv="Content-Type" content="text/xhtml; charset=utf-8" />
   
  <meta name="theme-color" content="#336791"/>
  <meta name="copyright" content="The PostgreSQL Global Development Group" />
  <meta property="og:url" content="https://www.postgresql.org/docs/13/pltcl-functions.html" />
  <meta property="og:type" content="article" />
  <meta property="article:published_time" content="2025-02-20T14:13:26" />
  <meta property="og:image" content="https://www.postgresql.org/media/img/about/press/elephant.png" />
  <meta property="og:title" content="43.2. PL/Tcl Functions and Arguments" />
  <meta property="og:description" content="43.2.&amp;nbsp;PL/Tcl Functions and Arguments To create a function in the PL/Tcl language, use the standard CREATE FUNCTION syntax: CREATE FUNCTION …" />
  <meta property="og:site_name" content="PostgreSQL Documentation" />


  

  
  
  
  
  

  

  
  </head>
  <body>
    <div class="container-fluid">
      <div class="row justify-content-md-center">
        <div class="col">
          
          
        </div>
      </div>
      <div class="row justify-content-center pg-shout-box">
        <div class="col text-white text-center">February 20, 2025: <a href="/about/news/postgresql-174-168-1512-1417-and-1320-released-3018/">
  PostgreSQL 17.4, 16.8, 15.12, 14.17, and 13.20 Released!
</a>

</div>
      </div>
    </div>
    <div class="container-fluid margin">
      <div class="row">
        <div id="pgContentWrap" class="col-11">
          <div class="row">
            <div class="col-md-6 mb-2">
              <div class="row">
                <div class="col">
                  <div>
                    <a href="/docs/" title="Documentation">Documentation</a> &rarr; <a href="/docs/13/index.html">PostgreSQL 13</a>
                  </div>
                </div>
              </div>
              
                <div class="row">
                  <div class="col">
                    Supported Versions:
                      
                        
                        
                          <a href="/docs/current/pltcl-functions.html" title="PostgreSQL 17 - 43.2. PL/Tcl Functions and Arguments" >Current</a>
                          (<a href="/docs/17/pltcl-functions.html" title="PostgreSQL 17 - 43.2. PL/Tcl Functions and Arguments" >17</a>)
                        
                      
                         / 
                        
                          <a href="/docs/16/pltcl-functions.html" title="PostgreSQL 16 - 43.2. PL/Tcl Functions and Arguments" >16</a>
                        
                      
                         / 
                        
                          <a href="/docs/15/pltcl-functions.html" title="PostgreSQL 15 - 43.2. PL/Tcl Functions and Arguments" >15</a>
                        
                      
                         / 
                        
                          <a href="/docs/14/pltcl-functions.html" title="PostgreSQL 14 - 43.2. PL/Tcl Functions and Arguments" >14</a>
                        
                      
                         / 
                        
                          <a href="/docs/13/pltcl-functions.html" title="PostgreSQL 13 - 43.2. PL/Tcl Functions and Arguments" class="docs-version-selected">13</a>
                        
                      
                  </div>
                </div>
              
              
                <div class="row">
                  <div class="col">
                    Development Versions:
                    
                      
                      <a href="/docs/devel/pltcl-functions.html" title="PostgreSQL devel - 43.2. PL/Tcl Functions and Arguments"  rel="nofollow">devel</a>
                    
                  </div>
                </div>
              
              
                <div class="row">
                  <div class="col-12">
                    Unsupported versions:
                    
                      
                      <a href="/docs/12/pltcl-functions.html" title="PostgreSQL 12 - 43.2. PL/Tcl Functions and Arguments"  rel="nofollow">12</a>
                    
                       / 
                      <a href="/docs/11/pltcl-functions.html" title="PostgreSQL 11 - 43.2. PL/Tcl Functions and Arguments"  rel="nofollow">11</a>
                    
                       / 
                      <a href="/docs/10/pltcl-functions.html" title="PostgreSQL 10 - 43.2. PL/Tcl Functions and Arguments"  rel="nofollow">10</a>
                    
                       / 
                      <a href="/docs/9.6/pltcl-functions.html" title="PostgreSQL 9.6 - 43.2. PL/Tcl Functions and Arguments"  rel="nofollow">9.6</a>
                    
                       / 
                      <a href="/docs/9.5/pltcl-functions.html" title="PostgreSQL 9.5 - 43.2. PL/Tcl Functions and Arguments"  rel="nofollow">9.5</a>
                    
                       / 
                      <a href="/docs/9.4/pltcl-functions.html" title="PostgreSQL 9.4 - 43.2. PL/Tcl Functions and Arguments"  rel="nofollow">9.4</a>
                    
                       / 
                      <a href="/docs/9.3/pltcl-functions.html" title="PostgreSQL 9.3 - 43.2. PL/Tcl Functions and Arguments"  rel="nofollow">9.3</a>
                    
                       / 
                      <a href="/docs/9.2/pltcl-functions.html" title="PostgreSQL 9.2 - 43.2. PL/Tcl Functions and Arguments"  rel="nofollow">9.2</a>
                    
                       / 
                      <a href="/docs/9.1/pltcl-functions.html" title="PostgreSQL 9.1 - 43.2. PL/Tcl Functions and Arguments"  rel="nofollow">9.1</a>
                    
                       / 
                      <a href="/docs/9.0/pltcl-functions.html" title="PostgreSQL 9.0 - 43.2. PL/Tcl Functions and Arguments"  rel="nofollow">9.0</a>
                    
                       / 
                      <a href="/docs/8.4/pltcl-functions.html" title="PostgreSQL 8.4 - 43.2. PL/Tcl Functions and Arguments"  rel="nofollow">8.4</a>
                    
                       / 
                      <a href="/docs/8.3/pltcl-functions.html" title="PostgreSQL 8.3 - 43.2. PL/Tcl Functions and Arguments"  rel="nofollow">8.3</a>
                    
                       / 
                      <a href="/docs/8.2/pltcl-functions.html" title="PostgreSQL 8.2 - 43.2. PL/Tcl Functions and Arguments"  rel="nofollow">8.2</a>
                    
                       / 
                      <a href="/docs/8.1/pltcl-functions.html" title="PostgreSQL 8.1 - 43.2. PL/Tcl Functions and Arguments"  rel="nofollow">8.1</a>
                    
                       / 
                      <a href="/docs/8.0/pltcl-functions.html" title="PostgreSQL 8.0 - 43.2. PL/Tcl Functions and Arguments"  rel="nofollow">8.0</a>
                    
                       / 
                      <a href="/docs/7.4/pltcl-functions.html" title="PostgreSQL 7.4 - 43.2. PL/Tcl Functions and Arguments"  rel="nofollow">7.4</a>
                    
                  </div>
                </div>
              
            </div>
            <div class="col-md-6 col-lg-5 offset-lg-1">
              <form id="docSearchForm" role="search" method="get" action="/search/">
                <input type="hidden" name="u" value="/docs/13/" />
                <div class="input-group">
                  <input type="text" id="q" name="q" class="form-control" placeholder="Search the documentation for..."/>
                  <span class="input-group-btn">
                    <button class="btn btn-default" type="submit"><i class="fas fa-search"></i></button>
                  </span>
                </div>
              </form>
            </div>
          </div>

          <div id="docContent">
            <div xmlns="http://www.w3.org/TR/xhtml1/transitional" class="navheader">
  <table width="100%" summary="Navigation header">
    <tr>
      <th colspan="5" align="center">43.2.&nbsp;PL/Tcl Functions and Arguments</th>
    </tr>
    <tr>
      <td width="10%" align="left"><a accesskey="p" href="pltcl-overview.html" title="43.1.&nbsp;Overview">Prev</a>&nbsp;</td>
      <td width="10%" align="left"><a accesskey="u" href="pltcl.html" title="Chapter&nbsp;43.&nbsp;PL/Tcl — Tcl Procedural Language">Up</a></td>
      <th width="60%" align="center">Chapter&nbsp;43.&nbsp;PL/Tcl — Tcl Procedural Language</th>
      <td width="10%" align="right"><a accesskey="h" href="index.html" title="PostgreSQL 13.20 Documentation">Home</a></td>
      <td width="10%" align="right">&nbsp;<a accesskey="n" href="pltcl-data.html" title="43.3.&nbsp;Data Values in PL/Tcl">Next</a></td>
    </tr>
  </table>
  <hr />
</div>
<div class="sect1" id="PLTCL-FUNCTIONS">
  <div class="titlepage">
    <div>
      <div>
        <h2 class="title" style="clear: both">43.2.&nbsp;PL/Tcl Functions and Arguments</h2>
      </div>
    </div>
  </div>
  <p>To create a function in the <span class="application">PL/Tcl</span> language, use the standard <a class="xref" href="sql-createfunction.html" title="CREATE FUNCTION"><span class="refentrytitle">CREATE FUNCTION</span></a> syntax:</p>
  <pre class="programlisting">
CREATE FUNCTION <em class="replaceable"><code>funcname</code></em> (<em class="replaceable"><code>argument-types</code></em>) RETURNS <em class="replaceable"><code>return-type</code></em> AS $$
    # PL/Tcl function body
$$ LANGUAGE pltcl;
</pre>
  <p><span class="application">PL/TclU</span> is the same, except that the language has to be specified as <code class="literal">pltclu</code>.</p>
  <p>The body of the function is simply a piece of Tcl script. When the function is called, the argument values are passed to the Tcl script as variables named <code class="literal">1</code> ... <code class="literal"><em class="replaceable"><code>n</code></em></code>. The result is returned from the Tcl code in the usual way, with a <code class="literal">return</code> statement. In a procedure, the return value from the Tcl code is ignored.</p>
  <p>For example, a function returning the greater of two integer values could be defined as:</p>
  <pre class="programlisting">
CREATE FUNCTION tcl_max(integer, integer) RETURNS integer AS $$
    if {$1 &gt; $2} {return $1}
    return $2
$$ LANGUAGE pltcl STRICT;
</pre>
  <p>Note the clause <code class="literal">STRICT</code>, which saves us from having to think about null input values: if a null value is passed, the function will not be called at all, but will just return a null result automatically.</p>
  <p>In a nonstrict function, if the actual value of an argument is null, the corresponding <code class="literal">$<em class="replaceable"><code>n</code></em></code> variable will be set to an empty string. To detect whether a particular argument is null, use the function <code class="literal">argisnull</code>. For example, suppose that we wanted <code class="function">tcl_max</code> with one null and one nonnull argument to return the nonnull argument, rather than null:</p>
  <pre class="programlisting">
CREATE FUNCTION tcl_max(integer, integer) RETURNS integer AS $$
    if {[argisnull 1]} {
        if {[argisnull 2]} { return_null }
        return $2
    }
    if {[argisnull 2]} { return $1 }
    if {$1 &gt; $2} {return $1}
    return $2
$$ LANGUAGE pltcl;
</pre>
  <p>As shown above, to return a null value from a PL/Tcl function, execute <code class="literal">return_null</code>. This can be done whether the function is strict or not.</p>
  <p>Composite-type arguments are passed to the function as Tcl arrays. The element names of the array are the attribute names of the composite type. If an attribute in the passed row has the null value, it will not appear in the array. Here is an example:</p>
  <pre class="programlisting">
CREATE TABLE employee (
    name text,
    salary integer,
    age integer
);

CREATE FUNCTION overpaid(employee) RETURNS boolean AS $$
    if {200000.0 &lt; $1(salary)} {
        return "t"
    }
    if {$1(age) &lt; 30 &amp;&amp; 100000.0 &lt; $1(salary)} {
        return "t"
    }
    return "f"
$$ LANGUAGE pltcl;
</pre>
  <p>PL/Tcl functions can return composite-type results, too. To do this, the Tcl code must return a list of column name/value pairs matching the expected result type. Any column names omitted from the list are returned as nulls, and an error is raised if there are unexpected column names. Here is an example:</p>
  <pre class="programlisting">
CREATE FUNCTION square_cube(in int, out squared int, out cubed int) AS $$
    return [list squared [expr {$1 * $1}] cubed [expr {$1 * $1 * $1}]]
$$ LANGUAGE pltcl;
</pre>
  <p>Output arguments of procedures are returned in the same way, for example:</p>
  <pre class="programlisting">
CREATE PROCEDURE tcl_triple(INOUT a integer, INOUT b integer) AS $$
    return [list a [expr {$1 * 3}] b [expr {$2 * 3}]]
$$ LANGUAGE pltcl;

CALL tcl_triple(5, 10);
</pre>
  <div class="tip">
    <h3 class="title">Tip</h3>
    <p>The result list can be made from an array representation of the desired tuple with the <code class="literal">array get</code> Tcl command. For example:</p>
    <pre class="programlisting">
CREATE FUNCTION raise_pay(employee, delta int) RETURNS employee AS $$
    set 1(salary) [expr {$1(salary) + $2}]
    return [array get 1]
$$ LANGUAGE pltcl;
</pre>
  </div>
  <p>PL/Tcl functions can return sets. To do this, the Tcl code should call <code class="function">return_next</code> once per row to be returned, passing either the appropriate value when returning a scalar type, or a list of column name/value pairs when returning a composite type. Here is an example returning a scalar type:</p>
  <pre class="programlisting">
CREATE FUNCTION sequence(int, int) RETURNS SETOF int AS $$
    for {set i $1} {$i &lt; $2} {incr i} {
        return_next $i
    }
$$ LANGUAGE pltcl;
</pre>
  <p>and here is one returning a composite type:</p>
  <pre class="programlisting">
CREATE FUNCTION table_of_squares(int, int) RETURNS TABLE (x int, x2 int) AS $$
    for {set i $1} {$i &lt; $2} {incr i} {
        return_next [list x $i x2 [expr {$i * $i}]]
    }
$$ LANGUAGE pltcl;
</pre>
</div>
<div xmlns="http://www.w3.org/TR/xhtml1/transitional" class="navfooter">
  <hr />
  <table width="100%" summary="Navigation footer">
    <tr>
      <td width="40%" align="left"><a accesskey="p" href="pltcl-overview.html" title="43.1.&nbsp;Overview">Prev</a>&nbsp;</td>
      <td width="20%" align="center"><a accesskey="u" href="pltcl.html" title="Chapter&nbsp;43.&nbsp;PL/Tcl — Tcl Procedural Language">Up</a></td>
      <td width="40%" align="right">&nbsp;<a accesskey="n" href="pltcl-data.html" title="43.3.&nbsp;Data Values in PL/Tcl">Next</a></td>
    </tr>
    <tr>
      <td width="40%" align="left" valign="top">43.1.&nbsp;Overview&nbsp;</td>
      <td width="20%" align="center"><a accesskey="h" href="index.html" title="PostgreSQL 13.20 Documentation">Home</a></td>
      <td width="40%" align="right" valign="top">&nbsp;43.3.&nbsp;Data Values in PL/Tcl</td>
    </tr>
  </table>
</div>

          </div>
          
            <div id="docComments">
              <h2>Submit correction</h2>
              <p>
              If you see anything in the documentation that is not correct, does not match
              your experience with the particular feature or requires further clarification,
              please use
              <a href="/account/comments/new/13/pltcl-functions.html/" rel="nofollow">this form</a>
              to report a documentation issue.
              </p>
            </div>
          
        </div> 
      </div>
    </div>
    
    
    
    
    
    
  </body>
</html>
