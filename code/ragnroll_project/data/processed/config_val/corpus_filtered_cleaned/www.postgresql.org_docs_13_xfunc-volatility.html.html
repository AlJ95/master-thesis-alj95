<!doctype html>
<html lang="en">
 <head>
  <title>PostgreSQL: Documentation: 13: 37.7. Function Volatility Categories</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta http-equiv="Content-Type" content="text/xhtml; charset=utf-8" />
   
  <meta name="theme-color" content="#336791"/>
  <meta name="copyright" content="The PostgreSQL Global Development Group" />
  <meta property="og:url" content="https://www.postgresql.org/docs/13/xfunc-volatility.html" />
  <meta property="og:type" content="article" />
  <meta property="article:published_time" content="2025-02-20T14:13:26" />
  <meta property="og:image" content="https://www.postgresql.org/media/img/about/press/elephant.png" />
  <meta property="og:title" content="37.7. Function Volatility Categories" />
  <meta property="og:description" content="37.7.&amp;nbsp;Function Volatility Categories Every function has a volatility classification, with the possibilities being VOLATILE, STABLE, or IMMUTABLE. VOLATILE is the …" />
  <meta property="og:site_name" content="PostgreSQL Documentation" />


  

  
  
  
  
  

  

  
  </head>
  <body>
    <div class="container-fluid">
      <div class="row justify-content-md-center">
        <div class="col">
          
          
        </div>
      </div>
      <div class="row justify-content-center pg-shout-box">
        <div class="col text-white text-center">February 20, 2025: <a href="/about/news/postgresql-174-168-1512-1417-and-1320-released-3018/">
  PostgreSQL 17.4, 16.8, 15.12, 14.17, and 13.20 Released!
</a>

</div>
      </div>
    </div>
    <div class="container-fluid margin">
      <div class="row">
        <div id="pgContentWrap" class="col-11">
          <div class="row">
            <div class="col-md-6 mb-2">
              <div class="row">
                <div class="col">
                  <div>
                    <a href="/docs/" title="Documentation">Documentation</a> &rarr; <a href="/docs/13/index.html">PostgreSQL 13</a>
                  </div>
                </div>
              </div>
              
                <div class="row">
                  <div class="col">
                    Supported Versions:
                      
                        
                        
                          <a href="/docs/current/xfunc-volatility.html" title="PostgreSQL 17 - 37.7. Function Volatility Categories" >Current</a>
                          (<a href="/docs/17/xfunc-volatility.html" title="PostgreSQL 17 - 37.7. Function Volatility Categories" >17</a>)
                        
                      
                         / 
                        
                          <a href="/docs/16/xfunc-volatility.html" title="PostgreSQL 16 - 37.7. Function Volatility Categories" >16</a>
                        
                      
                         / 
                        
                          <a href="/docs/15/xfunc-volatility.html" title="PostgreSQL 15 - 37.7. Function Volatility Categories" >15</a>
                        
                      
                         / 
                        
                          <a href="/docs/14/xfunc-volatility.html" title="PostgreSQL 14 - 37.7. Function Volatility Categories" >14</a>
                        
                      
                         / 
                        
                          <a href="/docs/13/xfunc-volatility.html" title="PostgreSQL 13 - 37.7. Function Volatility Categories" class="docs-version-selected">13</a>
                        
                      
                  </div>
                </div>
              
              
                <div class="row">
                  <div class="col">
                    Development Versions:
                    
                      
                      <a href="/docs/devel/xfunc-volatility.html" title="PostgreSQL devel - 37.7. Function Volatility Categories"  rel="nofollow">devel</a>
                    
                  </div>
                </div>
              
              
                <div class="row">
                  <div class="col-12">
                    Unsupported versions:
                    
                      
                      <a href="/docs/12/xfunc-volatility.html" title="PostgreSQL 12 - 37.7. Function Volatility Categories"  rel="nofollow">12</a>
                    
                       / 
                      <a href="/docs/11/xfunc-volatility.html" title="PostgreSQL 11 - 37.7. Function Volatility Categories"  rel="nofollow">11</a>
                    
                       / 
                      <a href="/docs/10/xfunc-volatility.html" title="PostgreSQL 10 - 37.7. Function Volatility Categories"  rel="nofollow">10</a>
                    
                       / 
                      <a href="/docs/9.6/xfunc-volatility.html" title="PostgreSQL 9.6 - 37.7. Function Volatility Categories"  rel="nofollow">9.6</a>
                    
                       / 
                      <a href="/docs/9.5/xfunc-volatility.html" title="PostgreSQL 9.5 - 37.7. Function Volatility Categories"  rel="nofollow">9.5</a>
                    
                       / 
                      <a href="/docs/9.4/xfunc-volatility.html" title="PostgreSQL 9.4 - 37.7. Function Volatility Categories"  rel="nofollow">9.4</a>
                    
                       / 
                      <a href="/docs/9.3/xfunc-volatility.html" title="PostgreSQL 9.3 - 37.7. Function Volatility Categories"  rel="nofollow">9.3</a>
                    
                       / 
                      <a href="/docs/9.2/xfunc-volatility.html" title="PostgreSQL 9.2 - 37.7. Function Volatility Categories"  rel="nofollow">9.2</a>
                    
                       / 
                      <a href="/docs/9.1/xfunc-volatility.html" title="PostgreSQL 9.1 - 37.7. Function Volatility Categories"  rel="nofollow">9.1</a>
                    
                       / 
                      <a href="/docs/9.0/xfunc-volatility.html" title="PostgreSQL 9.0 - 37.7. Function Volatility Categories"  rel="nofollow">9.0</a>
                    
                       / 
                      <a href="/docs/8.4/xfunc-volatility.html" title="PostgreSQL 8.4 - 37.7. Function Volatility Categories"  rel="nofollow">8.4</a>
                    
                       / 
                      <a href="/docs/8.3/xfunc-volatility.html" title="PostgreSQL 8.3 - 37.7. Function Volatility Categories"  rel="nofollow">8.3</a>
                    
                       / 
                      <a href="/docs/8.2/xfunc-volatility.html" title="PostgreSQL 8.2 - 37.7. Function Volatility Categories"  rel="nofollow">8.2</a>
                    
                       / 
                      <a href="/docs/8.1/xfunc-volatility.html" title="PostgreSQL 8.1 - 37.7. Function Volatility Categories"  rel="nofollow">8.1</a>
                    
                       / 
                      <a href="/docs/8.0/xfunc-volatility.html" title="PostgreSQL 8.0 - 37.7. Function Volatility Categories"  rel="nofollow">8.0</a>
                    
                  </div>
                </div>
              
            </div>
            <div class="col-md-6 col-lg-5 offset-lg-1">
              <form id="docSearchForm" role="search" method="get" action="/search/">
                <input type="hidden" name="u" value="/docs/13/" />
                <div class="input-group">
                  <input type="text" id="q" name="q" class="form-control" placeholder="Search the documentation for..."/>
                  <span class="input-group-btn">
                    <button class="btn btn-default" type="submit"><i class="fas fa-search"></i></button>
                  </span>
                </div>
              </form>
            </div>
          </div>

          <div id="docContent">
            <div xmlns="http://www.w3.org/TR/xhtml1/transitional" class="navheader">
  <table width="100%" summary="Navigation header">
    <tr>
      <th colspan="5" align="center">37.7.&nbsp;Function Volatility Categories</th>
    </tr>
    <tr>
      <td width="10%" align="left"><a accesskey="p" href="xfunc-overload.html" title="37.6.&nbsp;Function Overloading">Prev</a>&nbsp;</td>
      <td width="10%" align="left"><a accesskey="u" href="extend.html" title="Chapter&nbsp;37.&nbsp;Extending SQL">Up</a></td>
      <th width="60%" align="center">Chapter&nbsp;37.&nbsp;Extending <acronym xmlns="http://www.w3.org/1999/xhtml" class="acronym">SQL</acronym></th>
      <td width="10%" align="right"><a accesskey="h" href="index.html" title="PostgreSQL 13.20 Documentation">Home</a></td>
      <td width="10%" align="right">&nbsp;<a accesskey="n" href="xfunc-pl.html" title="37.8.&nbsp;Procedural Language Functions">Next</a></td>
    </tr>
  </table>
  <hr />
</div>
<div class="sect1" id="XFUNC-VOLATILITY">
  <div class="titlepage">
    <div>
      <div>
        <h2 class="title" style="clear: both">37.7.&nbsp;Function Volatility Categories</h2>
      </div>
    </div>
  </div><a id="id-1.8.3.10.2" class="indexterm" name="id-1.8.3.10.2"></a><a id="id-1.8.3.10.3" class="indexterm" name="id-1.8.3.10.3"></a><a id="id-1.8.3.10.4" class="indexterm" name="id-1.8.3.10.4"></a><a id="id-1.8.3.10.5" class="indexterm" name="id-1.8.3.10.5"></a>
  <p>Every function has a <em class="firstterm">volatility</em> classification, with the possibilities being <code class="literal">VOLATILE</code>, <code class="literal">STABLE</code>, or <code class="literal">IMMUTABLE</code>. <code class="literal">VOLATILE</code> is the default if the <a class="xref" href="sql-createfunction.html" title="CREATE FUNCTION"><span class="refentrytitle">CREATE FUNCTION</span></a> command does not specify a category. The volatility category is a promise to the optimizer about the behavior of the function:</p>
  <div class="itemizedlist">
    <ul class="itemizedlist" style="list-style-type: disc;">
      <li class="listitem">
        <p>A <code class="literal">VOLATILE</code> function can do anything, including modifying the database. It can return different results on successive calls with the same arguments. The optimizer makes no assumptions about the behavior of such functions. A query using a volatile function will re-evaluate the function at every row where its value is needed.</p>
      </li>
      <li class="listitem">
        <p>A <code class="literal">STABLE</code> function cannot modify the database and is guaranteed to return the same results given the same arguments for all rows within a single statement. This category allows the optimizer to optimize multiple calls of the function to a single call. In particular, it is safe to use an expression containing such a function in an index scan condition. (Since an index scan will evaluate the comparison value only once, not once at each row, it is not valid to use a <code class="literal">VOLATILE</code> function in an index scan condition.)</p>
      </li>
      <li class="listitem">
        <p>An <code class="literal">IMMUTABLE</code> function cannot modify the database and is guaranteed to return the same results given the same arguments forever. This category allows the optimizer to pre-evaluate the function when a query calls it with constant arguments. For example, a query like <code class="literal">SELECT ... WHERE x = 2 + 2</code> can be simplified on sight to <code class="literal">SELECT ... WHERE x = 4</code>, because the function underlying the integer addition operator is marked <code class="literal">IMMUTABLE</code>.</p>
      </li>
    </ul>
  </div>
  <p>For best optimization results, you should label your functions with the strictest volatility category that is valid for them.</p>
  <p>Any function with side-effects <span class="emphasis"><em>must</em></span> be labeled <code class="literal">VOLATILE</code>, so that calls to it cannot be optimized away. Even a function with no side-effects needs to be labeled <code class="literal">VOLATILE</code> if its value can change within a single query; some examples are <code class="literal">random()</code>, <code class="literal">currval()</code>, <code class="literal">timeofday()</code>.</p>
  <p>Another important example is that the <code class="function">current_timestamp</code> family of functions qualify as <code class="literal">STABLE</code>, since their values do not change within a transaction.</p>
  <p>There is relatively little difference between <code class="literal">STABLE</code> and <code class="literal">IMMUTABLE</code> categories when considering simple interactive queries that are planned and immediately executed: it doesn't matter a lot whether a function is executed once during planning or once during query execution startup. But there is a big difference if the plan is saved and reused later. Labeling a function <code class="literal">IMMUTABLE</code> when it really isn't might allow it to be prematurely folded to a constant during planning, resulting in a stale value being re-used during subsequent uses of the plan. This is a hazard when using prepared statements or when using function languages that cache plans (such as <span class="application">PL/pgSQL</span>).</p>
  <p>For functions written in SQL or in any of the standard procedural languages, there is a second important property determined by the volatility category, namely the visibility of any data changes that have been made by the SQL command that is calling the function. A <code class="literal">VOLATILE</code> function will see such changes, a <code class="literal">STABLE</code> or <code class="literal">IMMUTABLE</code> function will not. This behavior is implemented using the snapshotting behavior of MVCC (see <a class="xref" href="mvcc.html" title="Chapter&nbsp;13.&nbsp;Concurrency Control">Chapter&nbsp;13</a>): <code class="literal">STABLE</code> and <code class="literal">IMMUTABLE</code> functions use a snapshot established as of the start of the calling query, whereas <code class="literal">VOLATILE</code> functions obtain a fresh snapshot at the start of each query they execute.</p>
  <div class="note">
    <h3 class="title">Note</h3>
    <p>Functions written in C can manage snapshots however they want, but it's usually a good idea to make C functions work this way too.</p>
  </div>
  <p>Because of this snapshotting behavior, a function containing only <code class="command">SELECT</code> commands can safely be marked <code class="literal">STABLE</code>, even if it selects from tables that might be undergoing modifications by concurrent queries. <span class="productname">PostgreSQL</span> will execute all commands of a <code class="literal">STABLE</code> function using the snapshot established for the calling query, and so it will see a fixed view of the database throughout that query.</p>
  <p>The same snapshotting behavior is used for <code class="command">SELECT</code> commands within <code class="literal">IMMUTABLE</code> functions. It is generally unwise to select from database tables within an <code class="literal">IMMUTABLE</code> function at all, since the immutability will be broken if the table contents ever change. However, <span class="productname">PostgreSQL</span> does not enforce that you do not do that.</p>
  <p>A common error is to label a function <code class="literal">IMMUTABLE</code> when its results depend on a configuration parameter. For example, a function that manipulates timestamps might well have results that depend on the <a class="xref" href="runtime-config-client.html#GUC-TIMEZONE">TimeZone</a> setting. For safety, such functions should be labeled <code class="literal">STABLE</code> instead.</p>
  <div class="note">
    <h3 class="title">Note</h3>
    <p><span class="productname">PostgreSQL</span> requires that <code class="literal">STABLE</code> and <code class="literal">IMMUTABLE</code> functions contain no SQL commands other than <code class="command">SELECT</code> to prevent data modification. (This is not a completely bulletproof test, since such functions could still call <code class="literal">VOLATILE</code> functions that modify the database. If you do that, you will find that the <code class="literal">STABLE</code> or <code class="literal">IMMUTABLE</code> function does not notice the database changes applied by the called function, since they are hidden from its snapshot.)</p>
  </div>
</div>
<div xmlns="http://www.w3.org/TR/xhtml1/transitional" class="navfooter">
  <hr />
  <table width="100%" summary="Navigation footer">
    <tr>
      <td width="40%" align="left"><a accesskey="p" href="xfunc-overload.html" title="37.6.&nbsp;Function Overloading">Prev</a>&nbsp;</td>
      <td width="20%" align="center"><a accesskey="u" href="extend.html" title="Chapter&nbsp;37.&nbsp;Extending SQL">Up</a></td>
      <td width="40%" align="right">&nbsp;<a accesskey="n" href="xfunc-pl.html" title="37.8.&nbsp;Procedural Language Functions">Next</a></td>
    </tr>
    <tr>
      <td width="40%" align="left" valign="top">37.6.&nbsp;Function Overloading&nbsp;</td>
      <td width="20%" align="center"><a accesskey="h" href="index.html" title="PostgreSQL 13.20 Documentation">Home</a></td>
      <td width="40%" align="right" valign="top">&nbsp;37.8.&nbsp;Procedural Language Functions</td>
    </tr>
  </table>
</div>

          </div>
          
            <div id="docComments">
              <h2>Submit correction</h2>
              <p>
              If you see anything in the documentation that is not correct, does not match
              your experience with the particular feature or requires further clarification,
              please use
              <a href="/account/comments/new/13/xfunc-volatility.html/" rel="nofollow">this form</a>
              to report a documentation issue.
              </p>
            </div>
          
        </div> 
      </div>
    </div>
    
    
    
    
    
    
  </body>
</html>
