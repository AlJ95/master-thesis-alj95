<!doctype html>
<html lang="en">
 <head>
  <title>PostgreSQL: Documentation: 13: PREPARE TRANSACTION</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta http-equiv="Content-Type" content="text/xhtml; charset=utf-8" />
   
  <meta name="theme-color" content="#336791"/>
  <meta name="copyright" content="The PostgreSQL Global Development Group" />
  <meta property="og:url" content="https://www.postgresql.org/docs/13/sql-prepare-transaction.html" />
  <meta property="og:type" content="article" />
  <meta property="article:published_time" content="2025-02-20T14:13:26" />
  <meta property="og:image" content="https://www.postgresql.org/media/img/about/press/elephant.png" />
  <meta property="og:title" content="PREPARE TRANSACTION" />
  <meta property="og:description" content="PREPARE TRANSACTION PREPARE TRANSACTION — prepare the current transaction for two-phase commit Synopsis PREPARE TRANSACTION transaction_id Description PREPARE TRANSACTION prepares …" />
  <meta property="og:site_name" content="PostgreSQL Documentation" />


  

  
  
  
  
  

  

  
  </head>
  <body>
    <div class="container-fluid">
      <div class="row justify-content-md-center">
        <div class="col">
          
          
        </div>
      </div>
      <div class="row justify-content-center pg-shout-box">
        <div class="col text-white text-center">February 20, 2025: <a href="/about/news/postgresql-174-168-1512-1417-and-1320-released-3018/">
  PostgreSQL 17.4, 16.8, 15.12, 14.17, and 13.20 Released!
</a>

</div>
      </div>
    </div>
    <div class="container-fluid margin">
      <div class="row">
        <div id="pgContentWrap" class="col-11">
          <div class="row">
            <div class="col-md-6 mb-2">
              <div class="row">
                <div class="col">
                  <div>
                    <a href="/docs/" title="Documentation">Documentation</a> &rarr; <a href="/docs/13/index.html">PostgreSQL 13</a>
                  </div>
                </div>
              </div>
              
                <div class="row">
                  <div class="col">
                    Supported Versions:
                      
                        
                        
                          <a href="/docs/current/sql-prepare-transaction.html" title="PostgreSQL 17 - PREPARE TRANSACTION" >Current</a>
                          (<a href="/docs/17/sql-prepare-transaction.html" title="PostgreSQL 17 - PREPARE TRANSACTION" >17</a>)
                        
                      
                         / 
                        
                          <a href="/docs/16/sql-prepare-transaction.html" title="PostgreSQL 16 - PREPARE TRANSACTION" >16</a>
                        
                      
                         / 
                        
                          <a href="/docs/15/sql-prepare-transaction.html" title="PostgreSQL 15 - PREPARE TRANSACTION" >15</a>
                        
                      
                         / 
                        
                          <a href="/docs/14/sql-prepare-transaction.html" title="PostgreSQL 14 - PREPARE TRANSACTION" >14</a>
                        
                      
                         / 
                        
                          <a href="/docs/13/sql-prepare-transaction.html" title="PostgreSQL 13 - PREPARE TRANSACTION" class="docs-version-selected">13</a>
                        
                      
                  </div>
                </div>
              
              
                <div class="row">
                  <div class="col">
                    Development Versions:
                    
                      
                      <a href="/docs/devel/sql-prepare-transaction.html" title="PostgreSQL devel - PREPARE TRANSACTION"  rel="nofollow">devel</a>
                    
                  </div>
                </div>
              
              
                <div class="row">
                  <div class="col-12">
                    Unsupported versions:
                    
                      
                      <a href="/docs/12/sql-prepare-transaction.html" title="PostgreSQL 12 - PREPARE TRANSACTION"  rel="nofollow">12</a>
                    
                       / 
                      <a href="/docs/11/sql-prepare-transaction.html" title="PostgreSQL 11 - PREPARE TRANSACTION"  rel="nofollow">11</a>
                    
                       / 
                      <a href="/docs/10/sql-prepare-transaction.html" title="PostgreSQL 10 - PREPARE TRANSACTION"  rel="nofollow">10</a>
                    
                       / 
                      <a href="/docs/9.6/sql-prepare-transaction.html" title="PostgreSQL 9.6 - PREPARE TRANSACTION"  rel="nofollow">9.6</a>
                    
                       / 
                      <a href="/docs/9.5/sql-prepare-transaction.html" title="PostgreSQL 9.5 - PREPARE TRANSACTION"  rel="nofollow">9.5</a>
                    
                       / 
                      <a href="/docs/9.4/sql-prepare-transaction.html" title="PostgreSQL 9.4 - PREPARE TRANSACTION"  rel="nofollow">9.4</a>
                    
                       / 
                      <a href="/docs/9.3/sql-prepare-transaction.html" title="PostgreSQL 9.3 - PREPARE TRANSACTION"  rel="nofollow">9.3</a>
                    
                       / 
                      <a href="/docs/9.2/sql-prepare-transaction.html" title="PostgreSQL 9.2 - PREPARE TRANSACTION"  rel="nofollow">9.2</a>
                    
                       / 
                      <a href="/docs/9.1/sql-prepare-transaction.html" title="PostgreSQL 9.1 - PREPARE TRANSACTION"  rel="nofollow">9.1</a>
                    
                       / 
                      <a href="/docs/9.0/sql-prepare-transaction.html" title="PostgreSQL 9.0 - PREPARE TRANSACTION"  rel="nofollow">9.0</a>
                    
                       / 
                      <a href="/docs/8.4/sql-prepare-transaction.html" title="PostgreSQL 8.4 - PREPARE TRANSACTION"  rel="nofollow">8.4</a>
                    
                       / 
                      <a href="/docs/8.3/sql-prepare-transaction.html" title="PostgreSQL 8.3 - PREPARE TRANSACTION"  rel="nofollow">8.3</a>
                    
                       / 
                      <a href="/docs/8.2/sql-prepare-transaction.html" title="PostgreSQL 8.2 - PREPARE TRANSACTION"  rel="nofollow">8.2</a>
                    
                       / 
                      <a href="/docs/8.1/sql-prepare-transaction.html" title="PostgreSQL 8.1 - PREPARE TRANSACTION"  rel="nofollow">8.1</a>
                    
                  </div>
                </div>
              
            </div>
            <div class="col-md-6 col-lg-5 offset-lg-1">
              <form id="docSearchForm" role="search" method="get" action="/search/">
                <input type="hidden" name="u" value="/docs/13/" />
                <div class="input-group">
                  <input type="text" id="q" name="q" class="form-control" placeholder="Search the documentation for..."/>
                  <span class="input-group-btn">
                    <button class="btn btn-default" type="submit"><i class="fas fa-search"></i></button>
                  </span>
                </div>
              </form>
            </div>
          </div>

          <div id="docContent">
            <div xmlns="http://www.w3.org/TR/xhtml1/transitional" class="navheader">
  <table width="100%" summary="Navigation header">
    <tr>
      <th colspan="5" align="center">PREPARE TRANSACTION</th>
    </tr>
    <tr>
      <td width="10%" align="left"><a accesskey="p" href="sql-prepare.html" title="PREPARE">Prev</a>&nbsp;</td>
      <td width="10%" align="left"><a accesskey="u" href="sql-commands.html" title="SQL Commands">Up</a></td>
      <th width="60%" align="center">SQL Commands</th>
      <td width="10%" align="right"><a accesskey="h" href="index.html" title="PostgreSQL 13.20 Documentation">Home</a></td>
      <td width="10%" align="right">&nbsp;<a accesskey="n" href="sql-reassign-owned.html" title="REASSIGN OWNED">Next</a></td>
    </tr>
  </table>
  <hr />
</div>
<div class="refentry" id="SQL-PREPARE-TRANSACTION">
  <div class="titlepage"></div><a id="id-1.9.3.159.1" class="indexterm" name="id-1.9.3.159.1"></a>
  <div class="refnamediv">
    <h2><span class="refentrytitle">PREPARE TRANSACTION</span></h2>
    <p>PREPARE TRANSACTION — prepare the current transaction for two-phase commit</p>
  </div>
  <div class="refsynopsisdiv">
    <h2>Synopsis</h2>
    <pre class="synopsis">
PREPARE TRANSACTION <em class="replaceable"><code>transaction_id</code></em>
</pre>
  </div>
  <div class="refsect1" id="id-1.9.3.159.5">
    <h2>Description</h2>
    <p><code class="command">PREPARE TRANSACTION</code> prepares the current transaction for two-phase commit. After this command, the transaction is no longer associated with the current session; instead, its state is fully stored on disk, and there is a very high probability that it can be committed successfully, even if a database crash occurs before the commit is requested.</p>
    <p>Once prepared, a transaction can later be committed or rolled back with <a class="xref" href="sql-commit-prepared.html" title="COMMIT PREPARED"><span class="refentrytitle">COMMIT PREPARED</span></a> or <a class="xref" href="sql-rollback-prepared.html" title="ROLLBACK PREPARED"><span class="refentrytitle">ROLLBACK PREPARED</span></a>, respectively. Those commands can be issued from any session, not only the one that executed the original transaction.</p>
    <p>From the point of view of the issuing session, <code class="command">PREPARE TRANSACTION</code> is not unlike a <code class="command">ROLLBACK</code> command: after executing it, there is no active current transaction, and the effects of the prepared transaction are no longer visible. (The effects will become visible again if the transaction is committed.)</p>
    <p>If the <code class="command">PREPARE TRANSACTION</code> command fails for any reason, it becomes a <code class="command">ROLLBACK</code>: the current transaction is canceled.</p>
  </div>
  <div class="refsect1" id="id-1.9.3.159.6">
    <h2>Parameters</h2>
    <div class="variablelist">
      <dl class="variablelist">
        <dt><span class="term"><em class="replaceable"><code>transaction_id</code></em></span></dt>
        <dd>
          <p>An arbitrary identifier that later identifies this transaction for <code class="command">COMMIT PREPARED</code> or <code class="command">ROLLBACK PREPARED</code>. The identifier must be written as a string literal, and must be less than 200 bytes long. It must not be the same as the identifier used for any currently prepared transaction.</p>
        </dd>
      </dl>
    </div>
  </div>
  <div class="refsect1" id="id-1.9.3.159.7">
    <h2>Notes</h2>
    <p><code class="command">PREPARE TRANSACTION</code> is not intended for use in applications or interactive sessions. Its purpose is to allow an external transaction manager to perform atomic global transactions across multiple databases or other transactional resources. Unless you're writing a transaction manager, you probably shouldn't be using <code class="command">PREPARE TRANSACTION</code>.</p>
    <p>This command must be used inside a transaction block. Use <a class="xref" href="sql-begin.html" title="BEGIN"><span class="refentrytitle">BEGIN</span></a> to start one.</p>
    <p>It is not currently allowed to <code class="command">PREPARE</code> a transaction that has executed any operations involving temporary tables or the session's temporary namespace, created any cursors <code class="literal">WITH HOLD</code>, or executed <code class="command">LISTEN</code>, <code class="command">UNLISTEN</code>, or <code class="command">NOTIFY</code>. Those features are too tightly tied to the current session to be useful in a transaction to be prepared.</p>
    <p>If the transaction modified any run-time parameters with <code class="command">SET</code> (without the <code class="literal">LOCAL</code> option), those effects persist after <code class="command">PREPARE TRANSACTION</code>, and will not be affected by any later <code class="command">COMMIT PREPARED</code> or <code class="command">ROLLBACK PREPARED</code>. Thus, in this one respect <code class="command">PREPARE TRANSACTION</code> acts more like <code class="command">COMMIT</code> than <code class="command">ROLLBACK</code>.</p>
    <p>All currently available prepared transactions are listed in the <a class="link" href="view-pg-prepared-xacts.html" title="51.77.&nbsp;pg_prepared_xacts"><code class="structname">pg_prepared_xacts</code></a> system view.</p>
    <div class="caution">
      <h3 class="title">Caution</h3>
      <p>It is unwise to leave transactions in the prepared state for a long time. This will interfere with the ability of <code class="command">VACUUM</code> to reclaim storage, and in extreme cases could cause the database to shut down to prevent transaction ID wraparound (see <a class="xref" href="routine-vacuuming.html#VACUUM-FOR-WRAPAROUND" title="24.1.5.&nbsp;Preventing Transaction ID Wraparound Failures">Section&nbsp;24.1.5</a>). Keep in mind also that the transaction continues to hold whatever locks it held. The intended usage of the feature is that a prepared transaction will normally be committed or rolled back as soon as an external transaction manager has verified that other databases are also prepared to commit.</p>
      <p>If you have not set up an external transaction manager to track prepared transactions and ensure they get closed out promptly, it is best to keep the prepared-transaction feature disabled by setting <a class="xref" href="runtime-config-resource.html#GUC-MAX-PREPARED-TRANSACTIONS">max_prepared_transactions</a> to zero. This will prevent accidental creation of prepared transactions that might then be forgotten and eventually cause problems.</p>
    </div>
  </div>
  <div class="refsect1" id="SQL-PREPARE-TRANSACTION-EXAMPLES">
    <h2>Examples</h2>
    <p>Prepare the current transaction for two-phase commit, using <code class="literal">foobar</code> as the transaction identifier:</p>
    <pre class="programlisting">
PREPARE TRANSACTION 'foobar';
</pre>
  </div>
  <div class="refsect1" id="id-1.9.3.159.9">
    <h2>Compatibility</h2>
    <p><code class="command">PREPARE TRANSACTION</code> is a <span class="productname">PostgreSQL</span> extension. It is intended for use by external transaction management systems, some of which are covered by standards (such as X/Open XA), but the SQL side of those systems is not standardized.</p>
  </div>
  <div class="refsect1" id="id-1.9.3.159.10">
    <h2>See Also</h2><span class="simplelist"><a class="xref" href="sql-commit-prepared.html" title="COMMIT PREPARED"><span class="refentrytitle">COMMIT PREPARED</span></a>, <a class="xref" href="sql-rollback-prepared.html" title="ROLLBACK PREPARED"><span class="refentrytitle">ROLLBACK PREPARED</span></a></span>
  </div>
</div>
<div xmlns="http://www.w3.org/TR/xhtml1/transitional" class="navfooter">
  <hr />
  <table width="100%" summary="Navigation footer">
    <tr>
      <td width="40%" align="left"><a accesskey="p" href="sql-prepare.html" title="PREPARE">Prev</a>&nbsp;</td>
      <td width="20%" align="center"><a accesskey="u" href="sql-commands.html" title="SQL Commands">Up</a></td>
      <td width="40%" align="right">&nbsp;<a accesskey="n" href="sql-reassign-owned.html" title="REASSIGN OWNED">Next</a></td>
    </tr>
    <tr>
      <td width="40%" align="left" valign="top">PREPARE&nbsp;</td>
      <td width="20%" align="center"><a accesskey="h" href="index.html" title="PostgreSQL 13.20 Documentation">Home</a></td>
      <td width="40%" align="right" valign="top">&nbsp;REASSIGN OWNED</td>
    </tr>
  </table>
</div>

          </div>
          
            <div id="docComments">
              <h2>Submit correction</h2>
              <p>
              If you see anything in the documentation that is not correct, does not match
              your experience with the particular feature or requires further clarification,
              please use
              <a href="/account/comments/new/13/sql-prepare-transaction.html/" rel="nofollow">this form</a>
              to report a documentation issue.
              </p>
            </div>
          
        </div> 
      </div>
    </div>
    
    
    
    
    
    
  </body>
</html>
