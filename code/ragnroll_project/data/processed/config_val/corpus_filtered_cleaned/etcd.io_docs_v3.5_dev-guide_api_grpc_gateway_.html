<!doctype html><html itemscope itemtype=http://schema.org/WebPage lang=en class=no-js><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Why gRPC gateway | etcd</title>
<meta name=description content="Why you should consider using the gRPC gateway"><meta property="og:url" content="https://etcd.io/docs/v3.5/dev-guide/api_grpc_gateway/"><meta property="og:site_name" content="etcd"><meta property="og:title" content="Why gRPC gateway"><meta property="og:description" content="Why you should consider using the gRPC gateway"><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="docs"><meta property="article:modified_time" content="2021-08-19T16:37:01-04:00"><meta itemprop=name content="Why gRPC gateway"><meta itemprop=description content="Why you should consider using the gRPC gateway"><meta itemprop=dateModified content="2021-08-19T16:37:01-04:00"><meta itemprop=wordCount content="438"><meta name=twitter:card content="summary"><meta name=twitter:title content="Why gRPC gateway"><meta name=twitter:description content="Why you should consider using the gRPC gateway"></head><body class=td-page><div class="container-fluid td-outer"><div class=td-main><div class="row flex-xl-nowrap"><main class="col-12 col-md-9 col-xl-8 ps-md-5" role=main><div class=td-content><h1>Why gRPC gateway</h1><div class=lead>Why you should consider using the gRPC gateway</div><p>etcd v3 uses <a href=https://www.grpc.io/ target=_blank rel=noopener>gRPC</a> for its messaging protocol. The etcd project includes a gRPC-based <a href=https://github.com/etcd-io/etcd/tree/master/client/v3 target=_blank rel=noopener>Go client</a> and a command line utility, <a href=https://github.com/etcd-io/etcd/tree/master/etcdctl target=_blank rel=noopener>etcdctl</a>, for communicating with an etcd cluster through gRPC. For languages with no gRPC support, etcd provides a JSON <a href=https://github.com/grpc-ecosystem/grpc-gateway target=_blank rel=noopener>gRPC gateway</a>. This gateway serves a RESTful proxy that translates HTTP/JSON requests into gRPC messages.</p><h2 id=using-grpc-gateway>Using gRPC gateway</h2><p>The gateway accepts a <a href=https://developers.google.com/protocol-buffers/docs/proto3#json target=_blank rel=noopener>JSON mapping</a> for etcd&rsquo;s <a href=../api_reference_v3/>protocol buffer</a> message definitions. Note that <code>key</code> and <code>value</code> fields are defined as byte arrays and therefore must be base64 encoded in JSON. The following examples use <code>curl</code>, but any HTTP/JSON client should work all the same.</p><h3 id=notes>Notes</h3><p>gRPC gateway endpoint has changed since etcd v3.3:</p><ul><li>etcd v3.2 or before uses only <code>[CLIENT-URL]/v3alpha/*</code>.</li><li>etcd v3.3 uses <code>[CLIENT-URL]/v3beta/*</code> while keeping <code>[CLIENT-URL]/v3alpha/*</code>.</li><li>etcd v3.4 uses <code>[CLIENT-URL]/v3/*</code> while keeping <code>[CLIENT-URL]/v3beta/*</code>.<ul><li><strong><code>[CLIENT-URL]/v3alpha/*</code> is deprecated</strong>.</li></ul></li><li>etcd v3.5 or later uses only <code>[CLIENT-URL]/v3/*</code>.<ul><li><strong><code>[CLIENT-URL]/v3beta/*</code> is deprecated</strong>.</li></ul></li></ul><p>gRPC-gateway does not support authentication using TLS Common Name.</p><h3 id=put-and-get-keys>Put and get keys</h3><p>Use the <code>/v3/kv/range</code> and <code>/v3/kv/put</code> services to read and write keys:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#4e9a06>&lt;&lt;COMMENT
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>https://www.base64encode.org/
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>foo is &#39;Zm9v&#39; in Base64
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>bar is &#39;YmFy&#39;
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>COMMENT</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>curl -L http://localhost:2379/v3/kv/put <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>  -X POST -d <span style=color:#4e9a06>&#39;{&#34;key&#34;: &#34;Zm9v&#34;, &#34;value&#34;: &#34;YmFy&#34;}&#39;</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># {&#34;header&#34;:{&#34;cluster_id&#34;:&#34;12585971608760269493&#34;,&#34;member_id&#34;:&#34;13847567121247652255&#34;,&#34;revision&#34;:&#34;2&#34;,&#34;raft_term&#34;:&#34;3&#34;}}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>curl -L http://localhost:2379/v3/kv/range <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>  -X POST -d <span style=color:#4e9a06>&#39;{&#34;key&#34;: &#34;Zm9v&#34;}&#39;</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># {&#34;header&#34;:{&#34;cluster_id&#34;:&#34;12585971608760269493&#34;,&#34;member_id&#34;:&#34;13847567121247652255&#34;,&#34;revision&#34;:&#34;2&#34;,&#34;raft_term&#34;:&#34;3&#34;},&#34;kvs&#34;:[{&#34;key&#34;:&#34;Zm9v&#34;,&#34;create_revision&#34;:&#34;2&#34;,&#34;mod_revision&#34;:&#34;2&#34;,&#34;version&#34;:&#34;1&#34;,&#34;value&#34;:&#34;YmFy&#34;}],&#34;count&#34;:&#34;1&#34;}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># get all keys prefixed with &#34;foo&#34;</span>
</span></span><span style=display:flex><span>curl -L http://localhost:2379/v3/kv/range <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>  -X POST -d <span style=color:#4e9a06>&#39;{&#34;key&#34;: &#34;Zm9v&#34;, &#34;range_end&#34;: &#34;Zm9w&#34;}&#39;</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># {&#34;header&#34;:{&#34;cluster_id&#34;:&#34;12585971608760269493&#34;,&#34;member_id&#34;:&#34;13847567121247652255&#34;,&#34;revision&#34;:&#34;2&#34;,&#34;raft_term&#34;:&#34;3&#34;},&#34;kvs&#34;:[{&#34;key&#34;:&#34;Zm9v&#34;,&#34;create_revision&#34;:&#34;2&#34;,&#34;mod_revision&#34;:&#34;2&#34;,&#34;version&#34;:&#34;1&#34;,&#34;value&#34;:&#34;YmFy&#34;}],&#34;count&#34;:&#34;1&#34;}</span>
</span></span></code></pre></div><h3 id=watch-keys>Watch keys</h3><p>Use the <code>/v3/watch</code> service to watch keys:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>curl -N http://localhost:2379/v3/watch <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>  -X POST -d <span style=color:#4e9a06>&#39;{&#34;create_request&#34;: {&#34;key&#34;:&#34;Zm9v&#34;} }&#39;</span> <span style=color:#000;font-weight:700>&amp;</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># {&#34;result&#34;:{&#34;header&#34;:{&#34;cluster_id&#34;:&#34;12585971608760269493&#34;,&#34;member_id&#34;:&#34;13847567121247652255&#34;,&#34;revision&#34;:&#34;1&#34;,&#34;raft_term&#34;:&#34;2&#34;},&#34;created&#34;:true}}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>curl -L http://localhost:2379/v3/kv/put <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>  -X POST -d <span style=color:#4e9a06>&#39;{&#34;key&#34;: &#34;Zm9v&#34;, &#34;value&#34;: &#34;YmFy&#34;}&#39;</span> &gt;/dev/null 2&gt;<span style=color:#000;font-weight:700>&amp;</span><span style=color:#0000cf;font-weight:700>1</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># {&#34;result&#34;:{&#34;header&#34;:{&#34;cluster_id&#34;:&#34;12585971608760269493&#34;,&#34;member_id&#34;:&#34;13847567121247652255&#34;,&#34;revision&#34;:&#34;2&#34;,&#34;raft_term&#34;:&#34;2&#34;},&#34;events&#34;:[{&#34;kv&#34;:{&#34;key&#34;:&#34;Zm9v&#34;,&#34;create_revision&#34;:&#34;2&#34;,&#34;mod_revision&#34;:&#34;2&#34;,&#34;version&#34;:&#34;1&#34;,&#34;value&#34;:&#34;YmFy&#34;}}]}}</span>
</span></span></code></pre></div><h3 id=transactions>Transactions</h3><p>Issue a transaction with <code>/v3/kv/txn</code>:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#8f5902;font-style:italic># target CREATE</span>
</span></span><span style=display:flex><span>curl -L http://localhost:2379/v3/kv/txn <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>  -X POST <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>  -d <span style=color:#4e9a06>&#39;{&#34;compare&#34;:[{&#34;target&#34;:&#34;CREATE&#34;,&#34;key&#34;:&#34;Zm9v&#34;,&#34;createRevision&#34;:&#34;2&#34;}],&#34;success&#34;:[{&#34;requestPut&#34;:{&#34;key&#34;:&#34;Zm9v&#34;,&#34;value&#34;:&#34;YmFy&#34;}}]}&#39;</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># {&#34;header&#34;:{&#34;cluster_id&#34;:&#34;12585971608760269493&#34;,&#34;member_id&#34;:&#34;13847567121247652255&#34;,&#34;revision&#34;:&#34;3&#34;,&#34;raft_term&#34;:&#34;2&#34;},&#34;succeeded&#34;:true,&#34;responses&#34;:[{&#34;response_put&#34;:{&#34;header&#34;:{&#34;revision&#34;:&#34;3&#34;}}}]}</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#8f5902;font-style:italic># target VERSION</span>
</span></span><span style=display:flex><span>curl -L http://localhost:2379/v3/kv/txn <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>  -X POST <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>  -d <span style=color:#4e9a06>&#39;{&#34;compare&#34;:[{&#34;version&#34;:&#34;4&#34;,&#34;result&#34;:&#34;EQUAL&#34;,&#34;target&#34;:&#34;VERSION&#34;,&#34;key&#34;:&#34;Zm9v&#34;}],&#34;success&#34;:[{&#34;requestRange&#34;:{&#34;key&#34;:&#34;Zm9v&#34;}}]}&#39;</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># {&#34;header&#34;:{&#34;cluster_id&#34;:&#34;14841639068965178418&#34;,&#34;member_id&#34;:&#34;10276657743932975437&#34;,&#34;revision&#34;:&#34;6&#34;,&#34;raft_term&#34;:&#34;3&#34;},&#34;succeeded&#34;:true,&#34;responses&#34;:[{&#34;response_range&#34;:{&#34;header&#34;:{&#34;revision&#34;:&#34;6&#34;},&#34;kvs&#34;:[{&#34;key&#34;:&#34;Zm9v&#34;,&#34;create_revision&#34;:&#34;2&#34;,&#34;mod_revision&#34;:&#34;6&#34;,&#34;version&#34;:&#34;4&#34;,&#34;value&#34;:&#34;YmF6&#34;}],&#34;count&#34;:&#34;1&#34;}}]}</span>
</span></span></code></pre></div><h3 id=authentication>Authentication</h3><p>Set up authentication with the <code>/v3/auth</code> service:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#8f5902;font-style:italic># create root user</span>
</span></span><span style=display:flex><span>curl -L http://localhost:2379/v3/auth/user/add <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>  -X POST -d <span style=color:#4e9a06>&#39;{&#34;name&#34;: &#34;root&#34;, &#34;password&#34;: &#34;pass&#34;}&#39;</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># {&#34;header&#34;:{&#34;cluster_id&#34;:&#34;14841639068965178418&#34;,&#34;member_id&#34;:&#34;10276657743932975437&#34;,&#34;revision&#34;:&#34;1&#34;,&#34;raft_term&#34;:&#34;2&#34;}}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># create root role</span>
</span></span><span style=display:flex><span>curl -L http://localhost:2379/v3/auth/role/add <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>  -X POST -d <span style=color:#4e9a06>&#39;{&#34;name&#34;: &#34;root&#34;}&#39;</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># {&#34;header&#34;:{&#34;cluster_id&#34;:&#34;14841639068965178418&#34;,&#34;member_id&#34;:&#34;10276657743932975437&#34;,&#34;revision&#34;:&#34;1&#34;,&#34;raft_term&#34;:&#34;2&#34;}}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># grant root role</span>
</span></span><span style=display:flex><span>curl -L http://localhost:2379/v3/auth/user/grant <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>  -X POST -d <span style=color:#4e9a06>&#39;{&#34;user&#34;: &#34;root&#34;, &#34;role&#34;: &#34;root&#34;}&#39;</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># {&#34;header&#34;:{&#34;cluster_id&#34;:&#34;14841639068965178418&#34;,&#34;member_id&#34;:&#34;10276657743932975437&#34;,&#34;revision&#34;:&#34;1&#34;,&#34;raft_term&#34;:&#34;2&#34;}}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># enable auth</span>
</span></span><span style=display:flex><span>curl -L http://localhost:2379/v3/auth/enable -X POST -d <span style=color:#4e9a06>&#39;{}&#39;</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># {&#34;header&#34;:{&#34;cluster_id&#34;:&#34;14841639068965178418&#34;,&#34;member_id&#34;:&#34;10276657743932975437&#34;,&#34;revision&#34;:&#34;1&#34;,&#34;raft_term&#34;:&#34;2&#34;}}</span>
</span></span></code></pre></div><p>Authenticate with etcd for an authentication token using <code>/v3/auth/authenticate</code>:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#8f5902;font-style:italic># get the auth token for the root user</span>
</span></span><span style=display:flex><span>curl -L http://localhost:2379/v3/auth/authenticate <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>  -X POST -d <span style=color:#4e9a06>&#39;{&#34;name&#34;: &#34;root&#34;, &#34;password&#34;: &#34;pass&#34;}&#39;</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># {&#34;header&#34;:{&#34;cluster_id&#34;:&#34;14841639068965178418&#34;,&#34;member_id&#34;:&#34;10276657743932975437&#34;,&#34;revision&#34;:&#34;1&#34;,&#34;raft_term&#34;:&#34;2&#34;},&#34;token&#34;:&#34;sssvIpwfnLAcWAQH.9&#34;}</span>
</span></span></code></pre></div><p>Set the <code>Authorization</code> header to the authentication token to fetch a key using authentication credentials:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>curl -L http://localhost:2379/v3/kv/put <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>  -H <span style=color:#4e9a06>&#39;Authorization: sssvIpwfnLAcWAQH.9&#39;</span> <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>  -X POST -d <span style=color:#4e9a06>&#39;{&#34;key&#34;: &#34;Zm9v&#34;, &#34;value&#34;: &#34;YmFy&#34;}&#39;</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># {&#34;header&#34;:{&#34;cluster_id&#34;:&#34;14841639068965178418&#34;,&#34;member_id&#34;:&#34;10276657743932975437&#34;,&#34;revision&#34;:&#34;2&#34;,&#34;raft_term&#34;:&#34;2&#34;}}</span>
</span></span></code></pre></div><h2 id=swagger>Swagger</h2><p>Generated <a href=http://swagger.io/ target=_blank rel=noopener>Swagger</a> API definitions can be found at <a href=../apispec/swagger/rpc.swagger.json>rpc.swagger.json</a>.</p><div class=d-print-none><h2 class=feedback--title>Feedback</h2><p class=feedback--question>Was this page helpful?</p><button class="btn btn-primary mb-4 feedback--answer feedback--answer-yes">Yes</button>
<button class="btn btn-primary mb-4 feedback--answer feedback--answer-no">No</button><p class="feedback--response feedback--response-yes">Glad to hear it! Please <a href=https://github.com/etcd-io/website/issues/new>tell us how we can improve</a>.</p><p class="feedback--response feedback--response-no">Sorry to hear that. Please <a href=https://github.com/etcd-io/website/issues/new>tell us how we can improve</a>.</p></div><br><div class=td-page-meta__lastmod>Last modified August 19, 2021: <a href=https://github.com/etcd-io/website/commit/cb192bf87e7641b17d5b1838098a8c10e47927ad>fix v3.5 links (#457) (cb192bf)</a></div></div></main></div></div></div></body></html>