<!doctype html>
<html lang="en">
 <head>
  <title>PostgreSQL: Documentation: 13: 35.3. Running SQL Commands</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta http-equiv="Content-Type" content="text/xhtml; charset=utf-8" />
   
  <meta name="theme-color" content="#336791"/>
  <meta name="copyright" content="The PostgreSQL Global Development Group" />
  <meta property="og:url" content="https://www.postgresql.org/docs/13/ecpg-commands.html" />
  <meta property="og:type" content="article" />
  <meta property="article:published_time" content="2025-02-20T14:13:26" />
  <meta property="og:image" content="https://www.postgresql.org/media/img/about/press/elephant.png" />
  <meta property="og:title" content="35.3. Running SQL Commands" />
  <meta property="og:description" content="35.3.&amp;nbsp;Running SQL Commands 35.3.1. Executing SQL Statements 35.3.2. Using Cursors 35.3.3. Managing Transactions 35.3.4. Prepared Statements Any SQL command can …" />
  <meta property="og:site_name" content="PostgreSQL Documentation" />


  

  
  
  
  
  

  

  
  </head>
  <body>
    <div class="container-fluid">
      <div class="row justify-content-md-center">
        <div class="col">
          
          
        </div>
      </div>
      <div class="row justify-content-center pg-shout-box">
        <div class="col text-white text-center">February 20, 2025: <a href="/about/news/postgresql-174-168-1512-1417-and-1320-released-3018/">
  PostgreSQL 17.4, 16.8, 15.12, 14.17, and 13.20 Released!
</a>

</div>
      </div>
    </div>
    <div class="container-fluid margin">
      <div class="row">
        <div id="pgContentWrap" class="col-11">
          <div class="row">
            <div class="col-md-6 mb-2">
              <div class="row">
                <div class="col">
                  <div>
                    <a href="/docs/" title="Documentation">Documentation</a> &rarr; <a href="/docs/13/index.html">PostgreSQL 13</a>
                  </div>
                </div>
              </div>
              
                <div class="row">
                  <div class="col">
                    Supported Versions:
                      
                        
                        
                          <a href="/docs/current/ecpg-commands.html" title="PostgreSQL 17 - 35.3. Running SQL Commands" >Current</a>
                          (<a href="/docs/17/ecpg-commands.html" title="PostgreSQL 17 - 35.3. Running SQL Commands" >17</a>)
                        
                      
                         / 
                        
                          <a href="/docs/16/ecpg-commands.html" title="PostgreSQL 16 - 35.3. Running SQL Commands" >16</a>
                        
                      
                         / 
                        
                          <a href="/docs/15/ecpg-commands.html" title="PostgreSQL 15 - 35.3. Running SQL Commands" >15</a>
                        
                      
                         / 
                        
                          <a href="/docs/14/ecpg-commands.html" title="PostgreSQL 14 - 35.3. Running SQL Commands" >14</a>
                        
                      
                         / 
                        
                          <a href="/docs/13/ecpg-commands.html" title="PostgreSQL 13 - 35.3. Running SQL Commands" class="docs-version-selected">13</a>
                        
                      
                  </div>
                </div>
              
              
                <div class="row">
                  <div class="col">
                    Development Versions:
                    
                      
                      <a href="/docs/devel/ecpg-commands.html" title="PostgreSQL devel - 35.3. Running SQL Commands"  rel="nofollow">devel</a>
                    
                  </div>
                </div>
              
              
                <div class="row">
                  <div class="col-12">
                    Unsupported versions:
                    
                      
                      <a href="/docs/12/ecpg-commands.html" title="PostgreSQL 12 - 35.3. Running SQL Commands"  rel="nofollow">12</a>
                    
                       / 
                      <a href="/docs/11/ecpg-commands.html" title="PostgreSQL 11 - 35.3. Running SQL Commands"  rel="nofollow">11</a>
                    
                       / 
                      <a href="/docs/10/ecpg-commands.html" title="PostgreSQL 10 - 35.3. Running SQL Commands"  rel="nofollow">10</a>
                    
                       / 
                      <a href="/docs/9.6/ecpg-commands.html" title="PostgreSQL 9.6 - 35.3. Running SQL Commands"  rel="nofollow">9.6</a>
                    
                       / 
                      <a href="/docs/9.5/ecpg-commands.html" title="PostgreSQL 9.5 - 35.3. Running SQL Commands"  rel="nofollow">9.5</a>
                    
                       / 
                      <a href="/docs/9.4/ecpg-commands.html" title="PostgreSQL 9.4 - 35.3. Running SQL Commands"  rel="nofollow">9.4</a>
                    
                       / 
                      <a href="/docs/9.3/ecpg-commands.html" title="PostgreSQL 9.3 - 35.3. Running SQL Commands"  rel="nofollow">9.3</a>
                    
                       / 
                      <a href="/docs/9.2/ecpg-commands.html" title="PostgreSQL 9.2 - 35.3. Running SQL Commands"  rel="nofollow">9.2</a>
                    
                       / 
                      <a href="/docs/9.1/ecpg-commands.html" title="PostgreSQL 9.1 - 35.3. Running SQL Commands"  rel="nofollow">9.1</a>
                    
                       / 
                      <a href="/docs/9.0/ecpg-commands.html" title="PostgreSQL 9.0 - 35.3. Running SQL Commands"  rel="nofollow">9.0</a>
                    
                       / 
                      <a href="/docs/8.4/ecpg-commands.html" title="PostgreSQL 8.4 - 35.3. Running SQL Commands"  rel="nofollow">8.4</a>
                    
                       / 
                      <a href="/docs/8.3/ecpg-commands.html" title="PostgreSQL 8.3 - 35.3. Running SQL Commands"  rel="nofollow">8.3</a>
                    
                       / 
                      <a href="/docs/8.2/ecpg-commands.html" title="PostgreSQL 8.2 - 35.3. Running SQL Commands"  rel="nofollow">8.2</a>
                    
                       / 
                      <a href="/docs/8.1/ecpg-commands.html" title="PostgreSQL 8.1 - 35.3. Running SQL Commands"  rel="nofollow">8.1</a>
                    
                       / 
                      <a href="/docs/8.0/ecpg-commands.html" title="PostgreSQL 8.0 - 35.3. Running SQL Commands"  rel="nofollow">8.0</a>
                    
                       / 
                      <a href="/docs/7.4/ecpg-commands.html" title="PostgreSQL 7.4 - 35.3. Running SQL Commands"  rel="nofollow">7.4</a>
                    
                       / 
                      <a href="/docs/7.3/ecpg-commands.html" title="PostgreSQL 7.3 - 35.3. Running SQL Commands"  rel="nofollow">7.3</a>
                    
                  </div>
                </div>
              
            </div>
            <div class="col-md-6 col-lg-5 offset-lg-1">
              <form id="docSearchForm" role="search" method="get" action="/search/">
                <input type="hidden" name="u" value="/docs/13/" />
                <div class="input-group">
                  <input type="text" id="q" name="q" class="form-control" placeholder="Search the documentation for..."/>
                  <span class="input-group-btn">
                    <button class="btn btn-default" type="submit"><i class="fas fa-search"></i></button>
                  </span>
                </div>
              </form>
            </div>
          </div>

          <div id="docContent">
            <div xmlns="http://www.w3.org/TR/xhtml1/transitional" class="navheader">
  <table width="100%" summary="Navigation header">
    <tr>
      <th colspan="5" align="center">35.3.&nbsp;Running SQL Commands</th>
    </tr>
    <tr>
      <td width="10%" align="left"><a accesskey="p" href="ecpg-connect.html" title="35.2.&nbsp;Managing Database Connections">Prev</a>&nbsp;</td>
      <td width="10%" align="left"><a accesskey="u" href="ecpg.html" title="Chapter&nbsp;35.&nbsp;ECPG — Embedded SQL in C">Up</a></td>
      <th width="60%" align="center">Chapter&nbsp;35.&nbsp;<span xmlns="http://www.w3.org/1999/xhtml" class="application">ECPG</span> — Embedded <acronym xmlns="http://www.w3.org/1999/xhtml" class="acronym">SQL</acronym> in C</th>
      <td width="10%" align="right"><a accesskey="h" href="index.html" title="PostgreSQL 13.20 Documentation">Home</a></td>
      <td width="10%" align="right">&nbsp;<a accesskey="n" href="ecpg-variables.html" title="35.4.&nbsp;Using Host Variables">Next</a></td>
    </tr>
  </table>
  <hr />
</div>
<div class="sect1" id="ECPG-COMMANDS">
  <div class="titlepage">
    <div>
      <div>
        <h2 class="title" style="clear: both">35.3.&nbsp;Running SQL Commands</h2>
      </div>
    </div>
  </div>
  <div class="toc">
    <dl class="toc">
      <dt><span class="sect2"><a href="ecpg-commands.html#ECPG-EXECUTING">35.3.1. Executing SQL Statements</a></span></dt>
      <dt><span class="sect2"><a href="ecpg-commands.html#ECPG-CURSORS">35.3.2. Using Cursors</a></span></dt>
      <dt><span class="sect2"><a href="ecpg-commands.html#ECPG-TRANSACTIONS">35.3.3. Managing Transactions</a></span></dt>
      <dt><span class="sect2"><a href="ecpg-commands.html#ECPG-PREPARED">35.3.4. Prepared Statements</a></span></dt>
    </dl>
  </div>
  <p>Any SQL command can be run from within an embedded SQL application. Below are some examples of how to do that.</p>
  <div class="sect2" id="ECPG-EXECUTING">
    <div class="titlepage">
      <div>
        <div>
          <h3 class="title">35.3.1.&nbsp;Executing SQL Statements</h3>
        </div>
      </div>
    </div>
    <p>Creating a table:</p>
    <pre class="programlisting">
EXEC SQL CREATE TABLE foo (number integer, ascii char(16));
EXEC SQL CREATE UNIQUE INDEX num1 ON foo(number);
EXEC SQL COMMIT;
</pre>
    <p>Inserting rows:</p>
    <pre class="programlisting">
EXEC SQL INSERT INTO foo (number, ascii) VALUES (9999, 'doodad');
EXEC SQL COMMIT;
</pre>
    <p>Deleting rows:</p>
    <pre class="programlisting">
EXEC SQL DELETE FROM foo WHERE number = 9999;
EXEC SQL COMMIT;
</pre>
    <p>Updates:</p>
    <pre class="programlisting">
EXEC SQL UPDATE foo
    SET ascii = 'foobar'
    WHERE number = 9999;
EXEC SQL COMMIT;
</pre>
    <p><code class="literal">SELECT</code> statements that return a single result row can also be executed using <code class="literal">EXEC SQL</code> directly. To handle result sets with multiple rows, an application has to use a cursor; see <a class="xref" href="ecpg-commands.html#ECPG-CURSORS" title="35.3.2.&nbsp;Using Cursors">Section&nbsp;35.3.2</a> below. (As a special case, an application can fetch multiple rows at once into an array host variable; see <a class="xref" href="ecpg-variables.html#ECPG-VARIABLES-ARRAYS" title="35.4.4.3.1.&nbsp;Arrays">Section&nbsp;35.4.4.3.1</a>.)</p>
    <p>Single-row select:</p>
    <pre class="programlisting">
EXEC SQL SELECT foo INTO :FooBar FROM table1 WHERE ascii = 'doodad';
</pre>
    <p>Also, a configuration parameter can be retrieved with the <code class="literal">SHOW</code> command:</p>
    <pre class="programlisting">
EXEC SQL SHOW search_path INTO :var;
</pre>
    <p>The tokens of the form <code class="literal">:<em class="replaceable"><code>something</code></em></code> are <em class="firstterm">host variables</em>, that is, they refer to variables in the C program. They are explained in <a class="xref" href="ecpg-variables.html" title="35.4.&nbsp;Using Host Variables">Section&nbsp;35.4</a>.</p>
  </div>
  <div class="sect2" id="ECPG-CURSORS">
    <div class="titlepage">
      <div>
        <div>
          <h3 class="title">35.3.2.&nbsp;Using Cursors</h3>
        </div>
      </div>
    </div>
    <p>To retrieve a result set holding multiple rows, an application has to declare a cursor and fetch each row from the cursor. The steps to use a cursor are the following: declare a cursor, open it, fetch a row from the cursor, repeat, and finally close it.</p>
    <p>Select using cursors:</p>
    <pre class="programlisting">
EXEC SQL DECLARE foo_bar CURSOR FOR
    SELECT number, ascii FROM foo
    ORDER BY ascii;
EXEC SQL OPEN foo_bar;
EXEC SQL FETCH foo_bar INTO :FooBar, DooDad;
...
EXEC SQL CLOSE foo_bar;
EXEC SQL COMMIT;
</pre>
    <p>For more details about declaration of the cursor, see <a class="xref" href="ecpg-sql-declare.html" title="DECLARE">DECLARE</a>, and see <a class="xref" href="sql-fetch.html" title="FETCH"><span class="refentrytitle">FETCH</span></a> for <code class="literal">FETCH</code> command details.</p>
    <div class="note">
      <h3 class="title">Note</h3>
      <p>The ECPG <code class="command">DECLARE</code> command does not actually cause a statement to be sent to the PostgreSQL backend. The cursor is opened in the backend (using the backend's <code class="command">DECLARE</code> command) at the point when the <code class="command">OPEN</code> command is executed.</p>
    </div>
  </div>
  <div class="sect2" id="ECPG-TRANSACTIONS">
    <div class="titlepage">
      <div>
        <div>
          <h3 class="title">35.3.3.&nbsp;Managing Transactions</h3>
        </div>
      </div>
    </div>
    <p>In the default mode, statements are committed only when <code class="command">EXEC SQL COMMIT</code> is issued. The embedded SQL interface also supports autocommit of transactions (similar to <span class="application">psql</span>'s default behavior) via the <code class="option">-t</code> command-line option to <code class="command">ecpg</code> (see <a class="xref" href="app-ecpg.html" title="ecpg"><span class="refentrytitle"><span class="application">ecpg</span></span></a>) or via the <code class="literal">EXEC SQL SET AUTOCOMMIT TO ON</code> statement. In autocommit mode, each command is automatically committed unless it is inside an explicit transaction block. This mode can be explicitly turned off using <code class="literal">EXEC SQL SET AUTOCOMMIT TO OFF</code>.</p>
    <p>The following transaction management commands are available:</p>
    <div class="variablelist">
      <dl class="variablelist">
        <dt><span class="term"><code class="literal">EXEC SQL COMMIT</code></span></dt>
        <dd>
          <p>Commit an in-progress transaction.</p>
        </dd>
        <dt><span class="term"><code class="literal">EXEC SQL ROLLBACK</code></span></dt>
        <dd>
          <p>Roll back an in-progress transaction.</p>
        </dd>
        <dt><span class="term"><code class="literal">EXEC SQL PREPARE TRANSACTION</code> <em class="replaceable"><code>transaction_id</code></em></span></dt>
        <dd>
          <p>Prepare the current transaction for two-phase commit.</p>
        </dd>
        <dt><span class="term"><code class="literal">EXEC SQL COMMIT PREPARED</code> <em class="replaceable"><code>transaction_id</code></em></span></dt>
        <dd>
          <p>Commit a transaction that is in prepared state.</p>
        </dd>
        <dt><span class="term"><code class="literal">EXEC SQL ROLLBACK PREPARED</code> <em class="replaceable"><code>transaction_id</code></em></span></dt>
        <dd>
          <p>Roll back a transaction that is in prepared state.</p>
        </dd>
        <dt><span class="term"><code class="literal">EXEC SQL SET AUTOCOMMIT TO ON</code></span></dt>
        <dd>
          <p>Enable autocommit mode.</p>
        </dd>
        <dt><span class="term"><code class="literal">EXEC SQL SET AUTOCOMMIT TO OFF</code></span></dt>
        <dd>
          <p>Disable autocommit mode. This is the default.</p>
        </dd>
      </dl>
    </div>
  </div>
  <div class="sect2" id="ECPG-PREPARED">
    <div class="titlepage">
      <div>
        <div>
          <h3 class="title">35.3.4.&nbsp;Prepared Statements</h3>
        </div>
      </div>
    </div>
    <p>When the values to be passed to an SQL statement are not known at compile time, or the same statement is going to be used many times, then prepared statements can be useful.</p>
    <p>The statement is prepared using the command <code class="literal">PREPARE</code>. For the values that are not known yet, use the placeholder <span class="quote">“<span class="quote"><code class="literal">?</code></span>”</span>:</p>
    <pre class="programlisting">
EXEC SQL PREPARE stmt1 FROM "SELECT oid, datname FROM pg_database WHERE oid = ?";
</pre>
    <p>If a statement returns a single row, the application can call <code class="literal">EXECUTE</code> after <code class="literal">PREPARE</code> to execute the statement, supplying the actual values for the placeholders with a <code class="literal">USING</code> clause:</p>
    <pre class="programlisting">
EXEC SQL EXECUTE stmt1 INTO :dboid, :dbname USING 1;
</pre>
    <p>If a statement returns multiple rows, the application can use a cursor declared based on the prepared statement. To bind input parameters, the cursor must be opened with a <code class="literal">USING</code> clause:</p>
    <pre class="programlisting">
EXEC SQL PREPARE stmt1 FROM "SELECT oid,datname FROM pg_database WHERE oid &gt; ?";
EXEC SQL DECLARE foo_bar CURSOR FOR stmt1;

/* when end of result set reached, break out of while loop */
EXEC SQL WHENEVER NOT FOUND DO BREAK;

EXEC SQL OPEN foo_bar USING 100;
...
while (1)
{
    EXEC SQL FETCH NEXT FROM foo_bar INTO :dboid, :dbname;
    ...
}
EXEC SQL CLOSE foo_bar;
</pre>
    <p>When you don't need the prepared statement anymore, you should deallocate it:</p>
    <pre class="programlisting">
EXEC SQL DEALLOCATE PREPARE <em class="replaceable"><code>name</code></em>;
</pre>
    <p>For more details about <code class="literal">PREPARE</code>, see <a class="xref" href="ecpg-sql-prepare.html" title="PREPARE">PREPARE</a>. Also see <a class="xref" href="ecpg-dynamic.html" title="35.5.&nbsp;Dynamic SQL">Section&nbsp;35.5</a> for more details about using placeholders and input parameters.</p>
  </div>
</div>
<div xmlns="http://www.w3.org/TR/xhtml1/transitional" class="navfooter">
  <hr />
  <table width="100%" summary="Navigation footer">
    <tr>
      <td width="40%" align="left"><a accesskey="p" href="ecpg-connect.html" title="35.2.&nbsp;Managing Database Connections">Prev</a>&nbsp;</td>
      <td width="20%" align="center"><a accesskey="u" href="ecpg.html" title="Chapter&nbsp;35.&nbsp;ECPG — Embedded SQL in C">Up</a></td>
      <td width="40%" align="right">&nbsp;<a accesskey="n" href="ecpg-variables.html" title="35.4.&nbsp;Using Host Variables">Next</a></td>
    </tr>
    <tr>
      <td width="40%" align="left" valign="top">35.2.&nbsp;Managing Database Connections&nbsp;</td>
      <td width="20%" align="center"><a accesskey="h" href="index.html" title="PostgreSQL 13.20 Documentation">Home</a></td>
      <td width="40%" align="right" valign="top">&nbsp;35.4.&nbsp;Using Host Variables</td>
    </tr>
  </table>
</div>

          </div>
          
            <div id="docComments">
              <h2>Submit correction</h2>
              <p>
              If you see anything in the documentation that is not correct, does not match
              your experience with the particular feature or requires further clarification,
              please use
              <a href="/account/comments/new/13/ecpg-commands.html/" rel="nofollow">this form</a>
              to report a documentation issue.
              </p>
            </div>
          
        </div> 
      </div>
    </div>
    
    
    
    
    
    
  </body>
</html>
