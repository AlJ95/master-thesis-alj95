<!doctype html>
<html lang="en">
 <head>
  <title>PostgreSQL: Documentation: 13: F.32. pg_visibility</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta http-equiv="Content-Type" content="text/xhtml; charset=utf-8" />
   
  <meta name="theme-color" content="#336791"/>
  <meta name="copyright" content="The PostgreSQL Global Development Group" />
  <meta property="og:url" content="https://www.postgresql.org/docs/13/pgvisibility.html" />
  <meta property="og:type" content="article" />
  <meta property="article:published_time" content="2025-02-20T14:13:26" />
  <meta property="og:image" content="https://www.postgresql.org/media/img/about/press/elephant.png" />
  <meta property="og:title" content="F.32. pg_visibility" />
  <meta property="og:description" content="F.32.&amp;nbsp;pg_visibility F.32.1. Functions F.32.2. Author The pg_visibility module provides a means for examining the visibility map (VM) and page-level visibility …" />
  <meta property="og:site_name" content="PostgreSQL Documentation" />


  

  
  
  
  
  

  

  
  </head>
  <body>
    <div class="container-fluid">
      <div class="row justify-content-md-center">
        <div class="col">
          
          
        </div>
      </div>
      <div class="row justify-content-center pg-shout-box">
        <div class="col text-white text-center">February 20, 2025: <a href="/about/news/postgresql-174-168-1512-1417-and-1320-released-3018/">
  PostgreSQL 17.4, 16.8, 15.12, 14.17, and 13.20 Released!
</a>

</div>
      </div>
    </div>
    <div class="container-fluid margin">
      <div class="row">
        <div id="pgContentWrap" class="col-11">
          <div class="row">
            <div class="col-md-6 mb-2">
              <div class="row">
                <div class="col">
                  <div>
                    <a href="/docs/" title="Documentation">Documentation</a> &rarr; <a href="/docs/13/index.html">PostgreSQL 13</a>
                  </div>
                </div>
              </div>
              
                <div class="row">
                  <div class="col">
                    Supported Versions:
                      
                        
                        
                          <a href="/docs/current/pgvisibility.html" title="PostgreSQL 17 - F.32. pg_visibility" >Current</a>
                          (<a href="/docs/17/pgvisibility.html" title="PostgreSQL 17 - F.32. pg_visibility" >17</a>)
                        
                      
                         / 
                        
                          <a href="/docs/16/pgvisibility.html" title="PostgreSQL 16 - F.32. pg_visibility" >16</a>
                        
                      
                         / 
                        
                          <a href="/docs/15/pgvisibility.html" title="PostgreSQL 15 - F.32. pg_visibility" >15</a>
                        
                      
                         / 
                        
                          <a href="/docs/14/pgvisibility.html" title="PostgreSQL 14 - F.32. pg_visibility" >14</a>
                        
                      
                         / 
                        
                          <a href="/docs/13/pgvisibility.html" title="PostgreSQL 13 - F.32. pg_visibility" class="docs-version-selected">13</a>
                        
                      
                  </div>
                </div>
              
              
                <div class="row">
                  <div class="col">
                    Development Versions:
                    
                      
                      <a href="/docs/devel/pgvisibility.html" title="PostgreSQL devel - F.32. pg_visibility"  rel="nofollow">devel</a>
                    
                  </div>
                </div>
              
              
                <div class="row">
                  <div class="col-12">
                    Unsupported versions:
                    
                      
                      <a href="/docs/12/pgvisibility.html" title="PostgreSQL 12 - F.32. pg_visibility"  rel="nofollow">12</a>
                    
                       / 
                      <a href="/docs/11/pgvisibility.html" title="PostgreSQL 11 - F.32. pg_visibility"  rel="nofollow">11</a>
                    
                       / 
                      <a href="/docs/10/pgvisibility.html" title="PostgreSQL 10 - F.32. pg_visibility"  rel="nofollow">10</a>
                    
                       / 
                      <a href="/docs/9.6/pgvisibility.html" title="PostgreSQL 9.6 - F.32. pg_visibility"  rel="nofollow">9.6</a>
                    
                  </div>
                </div>
              
            </div>
            <div class="col-md-6 col-lg-5 offset-lg-1">
              <form id="docSearchForm" role="search" method="get" action="/search/">
                <input type="hidden" name="u" value="/docs/13/" />
                <div class="input-group">
                  <input type="text" id="q" name="q" class="form-control" placeholder="Search the documentation for..."/>
                  <span class="input-group-btn">
                    <button class="btn btn-default" type="submit"><i class="fas fa-search"></i></button>
                  </span>
                </div>
              </form>
            </div>
          </div>

          <div id="docContent">
            <div xmlns="http://www.w3.org/TR/xhtml1/transitional" class="navheader">
  <table width="100%" summary="Navigation header">
    <tr>
      <th colspan="5" align="center">F.32.&nbsp;pg_visibility</th>
    </tr>
    <tr>
      <td width="10%" align="left"><a accesskey="p" href="pgtrgm.html" title="F.31.&nbsp;pg_trgm">Prev</a>&nbsp;</td>
      <td width="10%" align="left"><a accesskey="u" href="contrib.html" title="Appendix&nbsp;F.&nbsp;Additional Supplied Modules">Up</a></td>
      <th width="60%" align="center">Appendix&nbsp;F.&nbsp;Additional Supplied Modules</th>
      <td width="10%" align="right"><a accesskey="h" href="index.html" title="PostgreSQL 13.20 Documentation">Home</a></td>
      <td width="10%" align="right">&nbsp;<a accesskey="n" href="postgres-fdw.html" title="F.33.&nbsp;postgres_fdw">Next</a></td>
    </tr>
  </table>
  <hr />
</div>
<div class="sect1" id="PGVISIBILITY">
  <div class="titlepage">
    <div>
      <div>
        <h2 class="title" style="clear: both">F.32.&nbsp;pg_visibility</h2>
      </div>
    </div>
  </div>
  <div class="toc">
    <dl class="toc">
      <dt><span class="sect2"><a href="pgvisibility.html#id-1.11.7.41.6">F.32.1. Functions</a></span></dt>
      <dt><span class="sect2"><a href="pgvisibility.html#id-1.11.7.41.7">F.32.2. Author</a></span></dt>
    </dl>
  </div><a id="id-1.11.7.41.2" class="indexterm" name="id-1.11.7.41.2"></a>
  <p>The <code class="filename">pg_visibility</code> module provides a means for examining the visibility map (VM) and page-level visibility information of a table. It also provides functions to check the integrity of a visibility map and to force it to be rebuilt.</p>
  <p>Three different bits are used to store information about page-level visibility. The all-visible bit in the visibility map indicates that every tuple in the corresponding page of the relation is visible to every current and future transaction. The all-frozen bit in the visibility map indicates that every tuple in the page is frozen; that is, no future vacuum will need to modify the page until such time as a tuple is inserted, updated, deleted, or locked on that page. The page header's <code class="literal">PD_ALL_VISIBLE</code> bit has the same meaning as the all-visible bit in the visibility map, but is stored within the data page itself rather than in a separate data structure. These two bits will normally agree, but the page's all-visible bit can sometimes be set while the visibility map bit is clear after a crash recovery. The reported values can also disagree because of a change that occurs after <code class="literal">pg_visibility</code> examines the visibility map and before it examines the data page. Any event that causes data corruption can also cause these bits to disagree.</p>
  <p>Functions that display information about <code class="literal">PD_ALL_VISIBLE</code> bits are much more costly than those that only consult the visibility map, because they must read the relation's data blocks rather than only the (much smaller) visibility map. Functions that check the relation's data blocks are similarly expensive.</p>
  <div class="sect2" id="id-1.11.7.41.6">
    <div class="titlepage">
      <div>
        <div>
          <h3 class="title">F.32.1.&nbsp;Functions</h3>
        </div>
      </div>
    </div>
    <div class="variablelist">
      <dl class="variablelist">
        <dt><span class="term"><code class="function">pg_visibility_map(relation regclass, blkno bigint, all_visible OUT boolean, all_frozen OUT boolean) returns record</code></span></dt>
        <dd>
          <p>Returns the all-visible and all-frozen bits in the visibility map for the given block of the given relation.</p>
        </dd>
        <dt><span class="term"><code class="function">pg_visibility(relation regclass, blkno bigint, all_visible OUT boolean, all_frozen OUT boolean, pd_all_visible OUT boolean) returns record</code></span></dt>
        <dd>
          <p>Returns the all-visible and all-frozen bits in the visibility map for the given block of the given relation, plus the <code class="literal">PD_ALL_VISIBLE</code> bit of that block.</p>
        </dd>
        <dt><span class="term"><code class="function">pg_visibility_map(relation regclass, blkno OUT bigint, all_visible OUT boolean, all_frozen OUT boolean) returns setof record</code></span></dt>
        <dd>
          <p>Returns the all-visible and all-frozen bits in the visibility map for each block of the given relation.</p>
        </dd>
        <dt><span class="term"><code class="function">pg_visibility(relation regclass, blkno OUT bigint, all_visible OUT boolean, all_frozen OUT boolean, pd_all_visible OUT boolean) returns setof record</code></span></dt>
        <dd>
          <p>Returns the all-visible and all-frozen bits in the visibility map for each block of the given relation, plus the <code class="literal">PD_ALL_VISIBLE</code> bit of each block.</p>
        </dd>
        <dt><span class="term"><code class="function">pg_visibility_map_summary(relation regclass, all_visible OUT bigint, all_frozen OUT bigint) returns record</code></span></dt>
        <dd>
          <p>Returns the number of all-visible pages and the number of all-frozen pages in the relation according to the visibility map.</p>
        </dd>
        <dt><span class="term"><code class="function">pg_check_frozen(relation regclass, t_ctid OUT tid) returns setof tid</code></span></dt>
        <dd>
          <p>Returns the TIDs of non-frozen tuples stored in pages marked all-frozen in the visibility map. If this function returns a non-empty set of TIDs, the visibility map is corrupt.</p>
        </dd>
        <dt><span class="term"><code class="function">pg_check_visible(relation regclass, t_ctid OUT tid) returns setof tid</code></span></dt>
        <dd>
          <p>Returns the TIDs of non-all-visible tuples stored in pages marked all-visible in the visibility map. If this function returns a non-empty set of TIDs, the visibility map is corrupt.</p>
        </dd>
        <dt><span class="term"><code class="function">pg_truncate_visibility_map(relation regclass) returns void</code></span></dt>
        <dd>
          <p>Truncates the visibility map for the given relation. This function is useful if you believe that the visibility map for the relation is corrupt and wish to force rebuilding it. The first <code class="command">VACUUM</code> executed on the given relation after this function is executed will scan every page in the relation and rebuild the visibility map. (Until that is done, queries will treat the visibility map as containing all zeroes.)</p>
        </dd>
      </dl>
    </div>
    <p>By default, these functions are executable only by superusers and members of the <code class="literal">pg_stat_scan_tables</code> role, with the exception of <code class="function">pg_truncate_visibility_map(relation regclass)</code> which can only be executed by superusers.</p>
  </div>
  <div class="sect2" id="id-1.11.7.41.7">
    <div class="titlepage">
      <div>
        <div>
          <h3 class="title">F.32.2.&nbsp;Author</h3>
        </div>
      </div>
    </div>
    <p>Robert Haas <code class="email">&lt;<a class="email" href="mailto:rhaas@postgresql.org">rhaas@postgresql.org</a>&gt;</code></p>
  </div>
</div>
<div xmlns="http://www.w3.org/TR/xhtml1/transitional" class="navfooter">
  <hr />
  <table width="100%" summary="Navigation footer">
    <tr>
      <td width="40%" align="left"><a accesskey="p" href="pgtrgm.html" title="F.31.&nbsp;pg_trgm">Prev</a>&nbsp;</td>
      <td width="20%" align="center"><a accesskey="u" href="contrib.html" title="Appendix&nbsp;F.&nbsp;Additional Supplied Modules">Up</a></td>
      <td width="40%" align="right">&nbsp;<a accesskey="n" href="postgres-fdw.html" title="F.33.&nbsp;postgres_fdw">Next</a></td>
    </tr>
    <tr>
      <td width="40%" align="left" valign="top">F.31.&nbsp;pg_trgm&nbsp;</td>
      <td width="20%" align="center"><a accesskey="h" href="index.html" title="PostgreSQL 13.20 Documentation">Home</a></td>
      <td width="40%" align="right" valign="top">&nbsp;F.33.&nbsp;postgres_fdw</td>
    </tr>
  </table>
</div>

          </div>
          
            <div id="docComments">
              <h2>Submit correction</h2>
              <p>
              If you see anything in the documentation that is not correct, does not match
              your experience with the particular feature or requires further clarification,
              please use
              <a href="/account/comments/new/13/pgvisibility.html/" rel="nofollow">this form</a>
              to report a documentation issue.
              </p>
            </div>
          
        </div> 
      </div>
    </div>
    
    
    
    
    
    
  </body>
</html>
