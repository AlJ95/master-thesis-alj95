<!doctype html>
<html lang="en">
 <head>
  <title>PostgreSQL: Documentation: 13: 53.4. Miscellaneous Coding Conventions</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta http-equiv="Content-Type" content="text/xhtml; charset=utf-8" />
   
  <meta name="theme-color" content="#336791"/>
  <meta name="copyright" content="The PostgreSQL Global Development Group" />
  <meta property="og:url" content="https://www.postgresql.org/docs/13/source-conventions.html" />
  <meta property="og:type" content="article" />
  <meta property="article:published_time" content="2025-02-20T14:13:26" />
  <meta property="og:image" content="https://www.postgresql.org/media/img/about/press/elephant.png" />
  <meta property="og:title" content="53.4. Miscellaneous Coding Conventions" />
  <meta property="og:description" content="53.4.&amp;nbsp;Miscellaneous Coding Conventions C Standard Code in PostgreSQL should only rely on language features available in the C99 standard. That …" />
  <meta property="og:site_name" content="PostgreSQL Documentation" />


  

  
  
  
  
  

  

  
  </head>
  <body>
    <div class="container-fluid">
      <div class="row justify-content-md-center">
        <div class="col">
          
          
        </div>
      </div>
      <div class="row justify-content-center pg-shout-box">
        <div class="col text-white text-center">February 20, 2025: <a href="/about/news/postgresql-174-168-1512-1417-and-1320-released-3018/">
  PostgreSQL 17.4, 16.8, 15.12, 14.17, and 13.20 Released!
</a>

</div>
      </div>
    </div>
    <div class="container-fluid margin">
      <div class="row">
        <div id="pgContentWrap" class="col-11">
          <div class="row">
            <div class="col-md-6 mb-2">
              <div class="row">
                <div class="col">
                  <div>
                    <a href="/docs/" title="Documentation">Documentation</a> &rarr; <a href="/docs/13/index.html">PostgreSQL 13</a>
                  </div>
                </div>
              </div>
              
                <div class="row">
                  <div class="col">
                    Supported Versions:
                      
                        
                        
                          <a href="/docs/current/source-conventions.html" title="PostgreSQL 17 - 53.4. Miscellaneous Coding Conventions" >Current</a>
                          (<a href="/docs/17/source-conventions.html" title="PostgreSQL 17 - 53.4. Miscellaneous Coding Conventions" >17</a>)
                        
                      
                         / 
                        
                          <a href="/docs/16/source-conventions.html" title="PostgreSQL 16 - 53.4. Miscellaneous Coding Conventions" >16</a>
                        
                      
                         / 
                        
                          <a href="/docs/15/source-conventions.html" title="PostgreSQL 15 - 53.4. Miscellaneous Coding Conventions" >15</a>
                        
                      
                         / 
                        
                          <a href="/docs/14/source-conventions.html" title="PostgreSQL 14 - 53.4. Miscellaneous Coding Conventions" >14</a>
                        
                      
                         / 
                        
                          <a href="/docs/13/source-conventions.html" title="PostgreSQL 13 - 53.4. Miscellaneous Coding Conventions" class="docs-version-selected">13</a>
                        
                      
                  </div>
                </div>
              
              
                <div class="row">
                  <div class="col">
                    Development Versions:
                    
                      
                      <a href="/docs/devel/source-conventions.html" title="PostgreSQL devel - 53.4. Miscellaneous Coding Conventions"  rel="nofollow">devel</a>
                    
                  </div>
                </div>
              
              
                <div class="row">
                  <div class="col-12">
                    Unsupported versions:
                    
                      
                      <a href="/docs/12/source-conventions.html" title="PostgreSQL 12 - 53.4. Miscellaneous Coding Conventions"  rel="nofollow">12</a>
                    
                       / 
                      <a href="/docs/11/source-conventions.html" title="PostgreSQL 11 - 53.4. Miscellaneous Coding Conventions"  rel="nofollow">11</a>
                    
                       / 
                      <a href="/docs/10/source-conventions.html" title="PostgreSQL 10 - 53.4. Miscellaneous Coding Conventions"  rel="nofollow">10</a>
                    
                       / 
                      <a href="/docs/9.6/source-conventions.html" title="PostgreSQL 9.6 - 53.4. Miscellaneous Coding Conventions"  rel="nofollow">9.6</a>
                    
                  </div>
                </div>
              
            </div>
            <div class="col-md-6 col-lg-5 offset-lg-1">
              <form id="docSearchForm" role="search" method="get" action="/search/">
                <input type="hidden" name="u" value="/docs/13/" />
                <div class="input-group">
                  <input type="text" id="q" name="q" class="form-control" placeholder="Search the documentation for..."/>
                  <span class="input-group-btn">
                    <button class="btn btn-default" type="submit"><i class="fas fa-search"></i></button>
                  </span>
                </div>
              </form>
            </div>
          </div>

          <div id="docContent">
            <div xmlns="http://www.w3.org/TR/xhtml1/transitional" class="navheader">
  <table width="100%" summary="Navigation header">
    <tr>
      <th colspan="5" align="center">53.4.&nbsp;Miscellaneous Coding Conventions</th>
    </tr>
    <tr>
      <td width="10%" align="left"><a accesskey="p" href="error-style-guide.html" title="53.3.&nbsp;Error Message Style Guide">Prev</a>&nbsp;</td>
      <td width="10%" align="left"><a accesskey="u" href="source.html" title="Chapter&nbsp;53.&nbsp;PostgreSQL Coding Conventions">Up</a></td>
      <th width="60%" align="center">Chapter&nbsp;53.&nbsp;PostgreSQL Coding Conventions</th>
      <td width="10%" align="right"><a accesskey="h" href="index.html" title="PostgreSQL 13.20 Documentation">Home</a></td>
      <td width="10%" align="right">&nbsp;<a accesskey="n" href="nls.html" title="Chapter&nbsp;54.&nbsp;Native Language Support">Next</a></td>
    </tr>
  </table>
  <hr />
</div>
<div class="sect1" id="SOURCE-CONVENTIONS">
  <div class="titlepage">
    <div>
      <div>
        <h2 class="title" style="clear: both">53.4.&nbsp;Miscellaneous Coding Conventions</h2>
      </div>
    </div>
  </div>
  <div class="simplesect" id="id-1.10.6.5.2">
    <div class="titlepage">
      <div>
        <div>
          <h3 class="title">C Standard</h3>
        </div>
      </div>
    </div>
    <p>Code in <span class="productname">PostgreSQL</span> should only rely on language features available in the C99 standard. That means a conforming C99 compiler has to be able to compile postgres, at least aside from a few platform dependent pieces.</p>
    <p>A few features included in the C99 standard are, at this time, not permitted to be used in core <span class="productname">PostgreSQL</span> code. This currently includes variable length arrays, intermingled declarations and code, <code class="literal">//</code> comments, universal character names. Reasons for that include portability and historical practices.</p>
    <p>Features from later revisions of the C standard or compiler specific features can be used, if a fallback is provided.</p>
    <p>For example <code class="literal">_Static_assert()</code> and <code class="literal">__builtin_constant_p</code> are currently used, even though they are from newer revisions of the C standard and a <span class="productname">GCC</span> extension respectively. If not available we respectively fall back to using a C99 compatible replacement that performs the same checks, but emits rather cryptic messages and do not use <code class="literal">__builtin_constant_p</code>.</p>
  </div>
  <div class="simplesect" id="id-1.10.6.5.3">
    <div class="titlepage">
      <div>
        <div>
          <h3 class="title">Function-Like Macros and Inline Functions</h3>
        </div>
      </div>
    </div>
    <p>Both macros with arguments and <code class="literal">static inline</code> functions may be used. The latter are preferable if there are multiple-evaluation hazards when written as a macro, as e.g., the case with</p>
    <pre class="programlisting">
#define Max(x, y)       ((x) &gt; (y) ? (x) : (y))
</pre>
    <p>or when the macro would be very long. In other cases it's only possible to use macros, or at least easier. For example because expressions of various types need to be passed to the macro.</p>
    <p>When the definition of an inline function references symbols (i.e., variables, functions) that are only available as part of the backend, the function may not be visible when included from frontend code.</p>
    <pre class="programlisting">
#ifndef FRONTEND
static inline MemoryContext
MemoryContextSwitchTo(MemoryContext context)
{
    MemoryContext old = CurrentMemoryContext;

    CurrentMemoryContext = context;
    return old;
}
#endif   /* FRONTEND */
</pre>
    <p>In this example <code class="literal">CurrentMemoryContext</code>, which is only available in the backend, is referenced and the function thus hidden with a <code class="literal">#ifndef FRONTEND</code>. This rule exists because some compilers emit references to symbols contained in inline functions even if the function is not used.</p>
  </div>
  <div class="simplesect" id="id-1.10.6.5.4">
    <div class="titlepage">
      <div>
        <div>
          <h3 class="title">Writing Signal Handlers</h3>
        </div>
      </div>
    </div>
    <p>To be suitable to run inside a signal handler code has to be written very carefully. The fundamental problem is that, unless blocked, a signal handler can interrupt code at any time. If code inside the signal handler uses the same state as code outside chaos may ensue. As an example consider what happens if a signal handler tries to acquire a lock that's already held in the interrupted code.</p>
    <p>Barring special arrangements code in signal handlers may only call async-signal safe functions (as defined in POSIX) and access variables of type <code class="literal">volatile sig_atomic_t</code>. A few functions in <code class="command">postgres</code> are also deemed signal safe, importantly <code class="function">SetLatch()</code>.</p>
    <p>In most cases signal handlers should do nothing more than note that a signal has arrived, and wake up code running outside of the handler using a latch. An example of such a handler is the following:</p>
    <pre class="programlisting">
static void
handle_sighup(SIGNAL_ARGS)
{
    int         save_errno = errno;

    got_SIGHUP = true;
    SetLatch(MyLatch);

    errno = save_errno;
}
</pre>
    <p><code class="varname">errno</code> is saved and restored because <code class="function">SetLatch()</code> might change it. If that were not done interrupted code that's currently inspecting <code class="varname">errno</code> might see the wrong value.</p>
  </div>
  <div class="simplesect" id="id-1.10.6.5.5">
    <div class="titlepage">
      <div>
        <div>
          <h3 class="title">Calling Function Pointers</h3>
        </div>
      </div>
    </div>
    <p>For clarity, it is preferred to explicitly dereference a function pointer when calling the pointed-to function if the pointer is a simple variable, for example:</p>
    <pre class="programlisting">
(*emit_log_hook) (edata);
</pre>
    <p>(even though <code class="literal">emit_log_hook(edata)</code> would also work). When the function pointer is part of a structure, then the extra punctuation can and usually should be omitted, for example:</p>
    <pre class="programlisting">
paramInfo-&gt;paramFetch(paramInfo, paramId);
</pre>
  </div>
</div>
<div xmlns="http://www.w3.org/TR/xhtml1/transitional" class="navfooter">
  <hr />
  <table width="100%" summary="Navigation footer">
    <tr>
      <td width="40%" align="left"><a accesskey="p" href="error-style-guide.html" title="53.3.&nbsp;Error Message Style Guide">Prev</a>&nbsp;</td>
      <td width="20%" align="center"><a accesskey="u" href="source.html" title="Chapter&nbsp;53.&nbsp;PostgreSQL Coding Conventions">Up</a></td>
      <td width="40%" align="right">&nbsp;<a accesskey="n" href="nls.html" title="Chapter&nbsp;54.&nbsp;Native Language Support">Next</a></td>
    </tr>
    <tr>
      <td width="40%" align="left" valign="top">53.3.&nbsp;Error Message Style Guide&nbsp;</td>
      <td width="20%" align="center"><a accesskey="h" href="index.html" title="PostgreSQL 13.20 Documentation">Home</a></td>
      <td width="40%" align="right" valign="top">&nbsp;Chapter&nbsp;54.&nbsp;Native Language Support</td>
    </tr>
  </table>
</div>

          </div>
          
            <div id="docComments">
              <h2>Submit correction</h2>
              <p>
              If you see anything in the documentation that is not correct, does not match
              your experience with the particular feature or requires further clarification,
              please use
              <a href="/account/comments/new/13/source-conventions.html/" rel="nofollow">this form</a>
              to report a documentation issue.
              </p>
            </div>
          
        </div> 
      </div>
    </div>
    
    
    
    
    
    
  </body>
</html>
