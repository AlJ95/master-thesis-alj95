<!doctype html><html itemscope itemtype=http://schema.org/WebPage lang=en class=no-js><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>etcd gateway | etcd</title>
<meta name=description content="etcd gateway, when to use it, and how to set it up"><meta property="og:url" content="https://etcd.io/docs/v3.5/op-guide/gateway/"><meta property="og:site_name" content="etcd"><meta property="og:title" content="etcd gateway"><meta property="og:description" content="etcd gateway, when to use it, and how to set it up"><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="docs"><meta property="article:modified_time" content="2023-01-21T15:34:10+13:00"><meta itemprop=name content="etcd gateway"><meta itemprop=description content="etcd gateway, when to use it, and how to set it up"><meta itemprop=dateModified content="2023-01-21T15:34:10+13:00"><meta itemprop=wordCount content="656"><meta name=twitter:card content="summary"><meta name=twitter:title content="etcd gateway"><meta name=twitter:description content="etcd gateway, when to use it, and how to set it up"></head><body class=td-page><div class="container-fluid td-outer"><div class=td-main><div class="row flex-xl-nowrap"><main class="col-12 col-md-9 col-xl-8 ps-md-5" role=main><div class=td-content><h1>etcd gateway</h1><div class=lead>etcd gateway, when to use it, and how to set it up</div><h2 id=what-is-etcd-gateway>What is etcd gateway</h2><p>etcd gateway is a simple TCP proxy that forwards network data to the etcd cluster. The gateway is stateless and transparent; it neither inspects client requests nor interferes with cluster responses. It does not terminate TLS connections, do TLS handshakes on behalf of its clients, or verify if the connection is secured.</p><p>The gateway supports multiple etcd server endpoints and works on a simple round-robin policy. It only routes to available endpoints and hides failures from its clients. Other retry policies, such as weighted round-robin, may be supported in the future.</p><h2 id=when-to-use-etcd-gateway>When to use etcd gateway</h2><p>Every application that accesses etcd must first have the address of an etcd cluster client endpoint. If multiple applications on the same server access the same etcd cluster, every application still needs to know the advertised client endpoints of the etcd cluster. If the etcd cluster is reconfigured to have different endpoints, every application may also need to update its endpoint list. This wide-scale reconfiguration is both tedious and error prone.</p><p>etcd gateway solves this problem by serving as a stable local endpoint. A typical etcd gateway configuration has each machine running a gateway listening on a local address and every etcd application connecting to its local gateway. The upshot is only the gateway needs to update its endpoints instead of updating each and every application.</p><p>In summary, to automatically propagate cluster endpoint changes, the etcd gateway runs on every machine serving multiple applications accessing the same etcd cluster.</p><h2 id=when-not-to-use-etcd-gateway>When not to use etcd gateway</h2><ul><li>Improving performance</li></ul><p>The gateway is not designed for improving etcd cluster performance. It does not provide caching, watch coalescing or batching. The etcd team is developing a caching proxy designed for improving cluster scalability.</p><ul><li>Running on a cluster management system</li></ul><p>Advanced cluster management systems like Kubernetes natively support service discovery. Applications can access an etcd cluster with a DNS name or a virtual IP address managed by the system. For example, kube-proxy is equivalent to etcd gateway.</p><h2 id=start-etcd-gateway>Start etcd gateway</h2><p>Consider an etcd cluster with the following static endpoints:</p><table><thead><tr><th>Name</th><th>Address</th><th>Hostname</th><th>Port</th></tr></thead><tbody><tr><td>infra0</td><td>10.0.1.10</td><td>infra0.example.com</td><td>2379</td></tr><tr><td>infra1</td><td>10.0.1.11</td><td>infra1.example.com</td><td>2379</td></tr><tr><td>infra2</td><td>10.0.1.12</td><td>infra2.example.com</td><td>2379</td></tr></tbody></table><p>Start the etcd gateway to use these static endpoints with the command:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ etcd gateway start --endpoints<span style=color:#ce5c00;font-weight:700>=</span>infra0.example.com:2379,infra1.example.com:2379,infra2.example.com:2379
</span></span><span style=display:flex><span>2016-08-16 11:21:18.867350 I <span style=color:#000;font-weight:700>|</span> tcpproxy: ready to proxy client requests to <span style=color:#ce5c00;font-weight:700>[</span>...<span style=color:#ce5c00;font-weight:700>]</span>
</span></span></code></pre></div><p>Alternatively, if using DNS for service discovery, consider the DNS SRV entries:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ dig +noall +answer SRV _etcd-client._tcp.example.com
</span></span><span style=display:flex><span>_etcd-client._tcp.example.com. <span style=color:#0000cf;font-weight:700>300</span> IN SRV <span style=color:#0000cf;font-weight:700>0</span> <span style=color:#0000cf;font-weight:700>0</span> <span style=color:#0000cf;font-weight:700>2379</span> infra0.example.com.
</span></span><span style=display:flex><span>_etcd-client._tcp.example.com. <span style=color:#0000cf;font-weight:700>300</span> IN SRV <span style=color:#0000cf;font-weight:700>0</span> <span style=color:#0000cf;font-weight:700>0</span> <span style=color:#0000cf;font-weight:700>2379</span> infra1.example.com.
</span></span><span style=display:flex><span>_etcd-client._tcp.example.com. <span style=color:#0000cf;font-weight:700>300</span> IN SRV <span style=color:#0000cf;font-weight:700>0</span> <span style=color:#0000cf;font-weight:700>0</span> <span style=color:#0000cf;font-weight:700>2379</span> infra2.example.com.
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ dig +noall +answer infra0.example.com infra1.example.com infra2.example.com
</span></span><span style=display:flex><span>infra0.example.com.  <span style=color:#0000cf;font-weight:700>300</span>  IN  A  10.0.1.10
</span></span><span style=display:flex><span>infra1.example.com.  <span style=color:#0000cf;font-weight:700>300</span>  IN  A  10.0.1.11
</span></span><span style=display:flex><span>infra2.example.com.  <span style=color:#0000cf;font-weight:700>300</span>  IN  A  10.0.1.12
</span></span></code></pre></div><p>Start the etcd gateway to fetch the endpoints from the DNS SRV entries with the command:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ etcd gateway start --discovery-srv<span style=color:#ce5c00;font-weight:700>=</span>example.com
</span></span><span style=display:flex><span>2016-08-16 11:21:18.867350 I <span style=color:#000;font-weight:700>|</span> tcpproxy: ready to proxy client requests to <span style=color:#ce5c00;font-weight:700>[</span>...<span style=color:#ce5c00;font-weight:700>]</span>
</span></span></code></pre></div><h2 id=configuration-flags>Configuration flags</h2><h3 id=etcd-cluster>etcd cluster</h3><h4 id=--endpoints>--endpoints</h4><ul><li>Comma-separated list of etcd server targets for forwarding client connections.</li><li>Default: <code>127.0.0.1:2379</code></li><li>Port must be included.</li><li>Invalid example: <code>https://127.0.0.1:2379</code> (gateway does not terminate TLS). Note that the gateway does not verify the HTTP schema or inspect the requests, it only forwards requests to the given endpoints.</li></ul><h4 id=--discovery-srv>--discovery-srv</h4><ul><li>DNS domain used to bootstrap cluster endpoints through SRV records.</li><li>Default: (not set)</li></ul><h3 id=network>Network</h3><h4 id=--listen-addr>--listen-addr</h4><ul><li>Interface and port to bind for accepting client requests.</li><li>Default: <code>127.0.0.1:23790</code></li></ul><h4 id=--retry-delay>--retry-delay</h4><ul><li>Duration of delay before retrying to connect to failed endpoints.</li><li>Default: 1m0s</li><li>Invalid example: &ldquo;123&rdquo; (expects time unit in format)</li></ul><h3 id=security>Security</h3><h4 id=--insecure-discovery>--insecure-discovery</h4><ul><li>Accept SRV records that are insecure or susceptible to man-in-the-middle attacks.</li><li>Default: <code>false</code></li></ul><h4 id=--trusted-ca-file>--trusted-ca-file</h4><ul><li>Path to the client TLS CA file for the etcd cluster to verify the endpoints returned from SRV discovery. Note that it is ONLY used for authenticating the discovered endpoints rather than creating connections for data transferring. The gateway never terminates TLS connections or create TLS connections on behalf of its clients.</li><li>Default: (not set)</li></ul><div class=d-print-none><h2 class=feedback--title>Feedback</h2><p class=feedback--question>Was this page helpful?</p><button class="btn btn-primary mb-4 feedback--answer feedback--answer-yes">Yes</button>
<button class="btn btn-primary mb-4 feedback--answer feedback--answer-no">No</button><p class="feedback--response feedback--response-yes">Glad to hear it! Please <a href=https://github.com/etcd-io/website/issues/new>tell us how we can improve</a>.</p><p class="feedback--response feedback--response-no">Sorry to hear that. Please <a href=https://github.com/etcd-io/website/issues/new>tell us how we can improve</a>.</p></div><br><div class=td-page-meta__lastmod>Last modified January 21, 2023: <a href=https://github.com/etcd-io/website/commit/c4ecad8110a8c46af9a5ac0673b2bd1d1f849dc3>Clarify port requirement for gateway endpoints (c4ecad8)</a></div></div></main></div></div></div></body></html>