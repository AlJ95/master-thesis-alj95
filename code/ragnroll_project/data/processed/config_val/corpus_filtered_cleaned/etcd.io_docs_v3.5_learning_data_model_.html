<!doctype html><html itemscope itemtype=http://schema.org/WebPage lang=en class=no-js><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Data model | etcd</title>
<meta name=description content="etcd data storage methodologies"><meta property="og:url" content="https://etcd.io/docs/v3.5/learning/data_model/"><meta property="og:site_name" content="etcd"><meta property="og:title" content="Data model"><meta property="og:description" content="etcd data storage methodologies"><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="docs"><meta property="article:modified_time" content="2023-02-26T15:42:13-08:00"><meta itemprop=name content="Data model"><meta itemprop=description content="etcd data storage methodologies"><meta itemprop=dateModified content="2023-02-26T15:42:13-08:00"><meta itemprop=wordCount content="566"><meta name=twitter:card content="summary"><meta name=twitter:title content="Data model"><meta name=twitter:description content="etcd data storage methodologies"></head><body class=td-page><div class="container-fluid td-outer"><div class=td-main><div class="row flex-xl-nowrap"><main class="col-12 col-md-9 col-xl-8 ps-md-5" role=main><div class=td-content><h1>Data model</h1><div class=lead>etcd data storage methodologies</div><p>etcd is designed to reliably store infrequently updated data and provide reliable watch queries. etcd exposes previous versions of key-value pairs to support inexpensive snapshots and watch history events (“time travel queries”). A persistent, multi-version, concurrency-control data model is a good fit for these use cases.</p><p>etcd stores data in a multiversion <a href=https://en.wikipedia.org/wiki/Persistent_data_structure target=_blank rel=noopener>persistent</a> key-value store. The persistent key-value store preserves the previous version of a key-value pair when its value is superseded with new data. The key-value store is effectively immutable; its operations do not update the structure in-place, but instead always generate a new updated structure. All past versions of keys are still accessible and watchable after modification. To prevent the data store from growing indefinitely over time and from maintaining old versions, the store may be compacted to shed the oldest versions of superseded data.</p><h3 id=logical-view>Logical view</h3><p>The store’s logical view is a flat binary key space. The key space has a lexically sorted index on byte string keys so range queries are inexpensive.</p><p>The key space maintains multiple <strong>revisions</strong>. When the store is created, the initial revision is 1. Each atomic mutative operation (e.g., a transaction operation may contain multiple operations) creates a new revision on the key space. All data held by previous revisions remains unchanged. Old versions of keys can still be accessed through previous revisions. Likewise, revisions are indexed as well; ranging over revisions with watchers is efficient. If the store is compacted to save space, revisions before the compact revision will be removed. Revisions are monotonically increasing over the lifetime of a cluster.</p><p>A key&rsquo;s life spans a generation, from creation to deletion. Each key may have one or multiple generations. Creating a key increments the <strong>version</strong> of that key, starting at 1 if the key does not exist at the current revision. Deleting a key generates a key tombstone, concluding the key’s current generation by resetting its version to 0. Each modification of a key increments its version; so, versions are monotonically increasing within a key&rsquo;s generation. Once a compaction happens, any generation ended before the compaction revision will be removed, and values set before the compaction revision except the latest one will be removed.</p><h3 id=physical-view>Physical view</h3><p>etcd stores the physical data as key-value pairs in a persistent <a href=https://en.wikipedia.org/wiki/B%2B_tree target=_blank rel=noopener>b+tree</a>. Each revision of the store’s state only contains the delta from its previous revision to be efficient. A single revision may correspond to multiple keys in the tree.</p><p>The key of key-value pair is a 3-tuple (major, sub, type). Major is the store revision holding the key. Sub differentiates among keys within the same revision. Type is an optional suffix for special value (e.g., <code>t</code> if the value contains a tombstone). The value of the key-value pair contains the modification from previous revision, thus one delta from previous revision. The b+tree is ordered by key in lexical byte-order. Ranged lookups over revision deltas are fast; this enables quickly finding modifications from one specific revision to another. Compaction removes out-of-date keys-value pairs.</p><p>etcd also keeps a secondary in-memory <a href=https://en.wikipedia.org/wiki/B-tree target=_blank rel=noopener>btree</a> index to speed up range queries over keys. The keys in the btree index are the keys of the store exposed to user. The value is a pointer to the modification of the persistent b+tree. Compaction removes dead pointers.</p><p>Overall, etcd gets the revision information from btree and then uses the revision as key to fetch value from b+tree(As shown below).</p><p align=center><kbd></kbd></p><div class=d-print-none><h2 class=feedback--title>Feedback</h2><p class=feedback--question>Was this page helpful?</p><button class="btn btn-primary mb-4 feedback--answer feedback--answer-yes">Yes</button>
<button class="btn btn-primary mb-4 feedback--answer feedback--answer-no">No</button><p class="feedback--response feedback--response-yes">Glad to hear it! Please <a href=https://github.com/etcd-io/website/issues/new>tell us how we can improve</a>.</p><p class="feedback--response feedback--response-no">Sorry to hear that. Please <a href=https://github.com/etcd-io/website/issues/new>tell us how we can improve</a>.</p></div><br><div class=td-page-meta__lastmod>Last modified February 26, 2023: <a href=https://github.com/etcd-io/website/commit/009fe6b1cfe50ed286b0c550bb293fa66b042233>Update data_model.md (009fe6b)</a></div></div></main></div></div></div></body></html>