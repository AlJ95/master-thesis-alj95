<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <title>Apache Hadoop 3.3.0 &#x2013; Native Libraries Guide</title>
    
    
        <meta name="Date-Revision-yyyymmdd" content="20200706" />
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
                </head>
  <body class="composite">
    <div id="banner">
                        <a href="http://hadoop.apache.org/" id="bannerLeft">
                                        
                </a>
                              <a href="http://www.apache.org/" id="bannerRight">
                                        
                </a>
            <div class="clear">
        <hr/>
      </div>
    </div>
    <div id="breadcrumbs">
            
                                   <div class="xleft">
                          <a href="http://www.apache.org/" class="externalLink">Apache</a>
        &gt;
                  <a href="http://hadoop.apache.org/" class="externalLink">Hadoop</a>
        &gt;
                  <a href="../index.html">Apache Hadoop Project Dist POM</a>
        &gt;
                  <a href="index.html">Apache Hadoop 3.3.0</a>
        &gt;
        Native Libraries Guide
        </div>
            <div class="xright">            <a href="http://wiki.apache.org/hadoop" class="externalLink">Wiki</a>
            |
                <a href="https://gitbox.apache.org/repos/asf/hadoop.git" class="externalLink">git</a>
            |
                <a href="http://hadoop.apache.org/" class="externalLink">Apache Hadoop</a>
              
                                   &nbsp;| Last Published: 2020-07-06
              &nbsp;| Version: 3.3.0
            </div>
      <div class="clear">
        <hr/>
      </div>
    </div>
    <div id="leftColumn">
      <div id="navcolumn">
             
                                                   <h5>General</h5>
                  <ul>
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
          </ul>
                       <h5>Common</h5>
                  <ul>
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
          </ul>
                       <h5>HDFS</h5>
                  <ul>
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
          </ul>
                       <h5>MapReduce</h5>
                  <ul>
                  
                  
                  
                  
                  
                  
                  
          </ul>
                       <h5>MapReduce REST APIs</h5>
                  <ul>
                  
                  
          </ul>
                       <h5>YARN</h5>
                  <ul>
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
          </ul>
                       <h5>YARN REST APIs</h5>
                  <ul>
                  
                  
                  
                  
                  
          </ul>
                       <h5>YARN Service</h5>
                  <ul>
                  
                  
                  
                  
                  
                  
          </ul>
                       <h5>Hadoop Compatible File Systems</h5>
                  <ul>
                  
                  
                  
                  
                  
                  
          </ul>
                       <h5>Auth</h5>
                  <ul>
                  
                  
                  
                  
          </ul>
                       <h5>Tools</h5>
                  <ul>
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
          </ul>
                       <h5>Reference</h5>
                  <ul>
                  
                  
                  
                  
          </ul>
                       <h5>Configuration</h5>
                  <ul>
                  
                  
                  
                  
                  
                  
          </ul>
                                 <a href="http://maven.apache.org/" title="Built by Maven" class="poweredBy">
          
        </a>
                       
                               </div>
    </div>
    <div id="bodyColumn">
      <div id="contentBox">
        
<h1>Native Libraries Guide</h1>
<ul>









</ul>

<div class="section">
<h2><a name="Overview"></a>Overview</h2>
<p>This guide describes the native hadoop library and includes a small discussion about native shared libraries.</p>
<p>Note: Depending on your environment, the term &#x201c;native libraries&#x201d; could refer to all *.so&#x2019;s you need to compile; and, the term &#x201c;native compression&#x201d; could refer to all *.so&#x2019;s you need to compile that are specifically related to compression. Currently, however, this document only addresses the native hadoop library (<tt>libhadoop.so</tt>). The document for libhdfs library (<tt>libhdfs.so</tt>) is <a href="../hadoop-hdfs/LibHdfs.html">here</a>.</p></div>
<div class="section">
<h2><a name="Native_Hadoop_Library"></a>Native Hadoop Library</h2>
<p>Hadoop has native implementations of certain components for performance reasons and for non-availability of Java implementations. These components are available in a single, dynamically-linked native library called the native hadoop library. On the *nix platforms the library is named <tt>libhadoop.so</tt>.</p></div>
<div class="section">
<h2><a name="Usage"></a>Usage</h2>
<p>It is fairly easy to use the native hadoop library:</p>
<ol style="list-style-type: decimal">

<li>Review the components.</li>
<li>Review the supported platforms.</li>
<li>Either download a hadoop release, which will include a pre-built version of the native hadoop library, or build your own version of the native hadoop library. Whether you download or build, the name for the library is the same: libhadoop.so</li>
<li>Install the compression codec development packages (&gt;zlib-1.2, &gt;gzip-1.2):
<ul>

<li>If you download the library, install one or more development packages - whichever compression codecs you want to use with your deployment.</li>
<li>If you build the library, it is mandatory to install both development packages.</li>
</ul>
</li>
<li>Check the runtime log files.</li>
</ol></div>
<div class="section">
<h2><a name="Components"></a>Components</h2>
<p>The native hadoop library includes various components:</p>
<ul>

<li>Compression Codecs (bzip2, lz4, snappy, zlib)</li>
<li>Native IO utilities for <a href="../hadoop-hdfs/ShortCircuitLocalReads.html">HDFS Short-Circuit Local Reads</a> and <a href="../hadoop-hdfs/CentralizedCacheManagement.html">Centralized Cache Management in HDFS</a></li>
<li>CRC32 checksum implementation</li>
</ul></div>
<div class="section">
<h2><a name="Supported_Platforms"></a>Supported Platforms</h2>
<p>The native hadoop library is supported on *nix platforms only. The library does not to work with Cygwin or the Mac OS X platform.</p>
<p>The native hadoop library is mainly used on the GNU/Linus platform and has been tested on these distributions:</p>
<ul>

<li>RHEL4/Fedora</li>
<li>Ubuntu</li>
<li>Gentoo</li>
</ul>
<p>On all the above distributions a 32/64 bit native hadoop library will work with a respective 32/64 bit jvm.</p></div>
<div class="section">
<h2><a name="Download"></a>Download</h2>
<p>The pre-built 32-bit i386-Linux native hadoop library is available as part of the hadoop distribution and is located in the <tt>lib/native</tt> directory. You can download the hadoop distribution from Hadoop Common Releases.</p>
<p>Be sure to install the zlib and/or gzip development packages - whichever compression codecs you want to use with your deployment.</p></div>
<div class="section">
<h2><a name="Build"></a>Build</h2>
<p>The native hadoop library is written in ANSI C and is built using the GNU autotools-chain (autoconf, autoheader, automake, autoscan, libtool). This means it should be straight-forward to build the library on any platform with a standards-compliant C compiler and the GNU autotools-chain (see the supported platforms).</p>
<p>The packages you need to install on the target platform are:</p>
<ul>

<li>C compiler (e.g. GNU C Compiler)</li>
<li>GNU Autools Chain: autoconf, automake, libtool</li>
<li>zlib-development package (stable version &gt;= 1.2.0)</li>
<li>openssl-development package(e.g. libssl-dev)</li>
</ul>
<p>Once you installed the prerequisite packages use the standard hadoop pom.xml file and pass along the native flag to build the native hadoop library:</p>

<div>
<div>
<pre class="source">   $ mvn package -Pdist,native -DskipTests -Dtar
</pre></div></div>

<p>You should see the newly-built library in:</p>

<div>
<div>
<pre class="source">   $ hadoop-dist/target/hadoop-3.3.0/lib/native
</pre></div></div>

<p>Please note the following:</p>
<ul>

<li>It is mandatory to install both the zlib and gzip development packages on the target platform in order to build the native hadoop library; however, for deployment it is sufficient to install just one package if you wish to use only one codec.</li>
<li>It is necessary to have the correct 32/64 libraries for zlib, depending on the 32/64 bit jvm for the target platform, in order to build and deploy the native hadoop library.</li>
</ul></div>
<div class="section">
<h2><a name="Runtime"></a>Runtime</h2>
<p>The bin/hadoop script ensures that the native hadoop library is on the library path via the system property: <tt>-Djava.library.path=&lt;path&gt;</tt></p>
<p>During runtime, check the hadoop log files for your MapReduce tasks.</p>
<ul>

<li>If everything is all right, then: <tt>DEBUG util.NativeCodeLoader - Trying to load the custom-built native-hadoop library...</tt> <tt>INFO util.NativeCodeLoader - Loaded the native-hadoop library</tt></li>
<li>If something goes wrong, then: <tt>INFO util.NativeCodeLoader - Unable to load native-hadoop library for your platform... using builtin-java classes where applicable</tt></li>
</ul></div>
<div class="section">
<h2><a name="Check"></a>Check</h2>
<p>NativeLibraryChecker is a tool to check whether native libraries are loaded correctly. You can launch NativeLibraryChecker as follows:</p>

<div>
<div>
<pre class="source">   $ hadoop checknative -a
   14/12/06 01:30:45 WARN bzip2.Bzip2Factory: Failed to load/initialize native-bzip2 library system-native, will use pure-Java version
   14/12/06 01:30:45 INFO zlib.ZlibFactory: Successfully loaded &amp; initialized native-zlib library
   Native library checking:
   hadoop: true /home/ozawa/hadoop/lib/native/libhadoop.so.1.0.0
   zlib:   true /lib/x86_64-linux-gnu/libz.so.1
   snappy: true /usr/lib/libsnappy.so.1
   zstd: true /usr/lib/libzstd.so.1
   lz4:    true revision:99
   bzip2:  false
</pre></div></div>
</div>
<div class="section">
<h2><a name="Native_Shared_Libraries"></a>Native Shared Libraries</h2>
<p>You can load any native shared library using DistributedCache for distributing and symlinking the library files.</p>
<p>This example shows you how to distribute a shared library, mylib.so, and load it from a MapReduce task.</p>
<ol style="list-style-type: decimal">

<li>First copy the library to the HDFS: <tt>bin/hadoop fs -copyFromLocal mylib.so.1 /libraries/mylib.so.1</tt></li>
<li>The job launching program should contain the following: <tt>DistributedCache.createSymlink(conf);</tt> <tt>DistributedCache.addCacheFile(&quot;hdfs://host:port/libraries/mylib.so. 1#mylib.so&quot;, conf);</tt></li>
<li>The MapReduce task can contain: <tt>System.loadLibrary(&quot;mylib.so&quot;);</tt></li>
</ol>
<p>Note: If you downloaded or built the native hadoop library, you don&#x2019;t need to use DistibutedCache to make the library available to your MapReduce tasks.</p></div>
      </div>
    </div>
    <div class="clear">
      <hr/>
    </div>
    <div id="footer">
      <div class="xright">
        &#169;            2008-2020
              Apache Software Foundation
            
                          - <a href="http://maven.apache.org/privacy-policy.html">Privacy Policy</a>.
        Apache Maven, Maven, Apache, the Apache feather logo, and the Apache Maven project logos are trademarks of The Apache Software Foundation.
      </div>
      <div class="clear">
        <hr/>
      </div>
    </div>
  </body>
</html>
