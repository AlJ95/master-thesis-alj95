<!doctype html>
<html lang="en">
 <head>
  <title>PostgreSQL: Documentation: 13: 71.3. Planner Statistics and Security</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta http-equiv="Content-Type" content="text/xhtml; charset=utf-8" />
   
  <meta name="theme-color" content="#336791"/>
  <meta name="copyright" content="The PostgreSQL Global Development Group" />
  <meta property="og:url" content="https://www.postgresql.org/docs/13/planner-stats-security.html" />
  <meta property="og:type" content="article" />
  <meta property="article:published_time" content="2025-02-20T14:13:26" />
  <meta property="og:image" content="https://www.postgresql.org/media/img/about/press/elephant.png" />
  <meta property="og:title" content="71.3. Planner Statistics and Security" />
  <meta property="og:description" content="71.3.&amp;nbsp;Planner Statistics and Security Access to the table pg_statistic is restricted to superusers, so that ordinary users cannot learn about …" />
  <meta property="og:site_name" content="PostgreSQL Documentation" />


  

  
  
  
  
  

  

  
  </head>
  <body>
    <div class="container-fluid">
      <div class="row justify-content-md-center">
        <div class="col">
          
          
        </div>
      </div>
      <div class="row justify-content-center pg-shout-box">
        <div class="col text-white text-center">February 20, 2025: <a href="/about/news/postgresql-174-168-1512-1417-and-1320-released-3018/">
  PostgreSQL 17.4, 16.8, 15.12, 14.17, and 13.20 Released!
</a>

</div>
      </div>
    </div>
    <div class="container-fluid margin">
      <div class="row">
        <div id="pgContentWrap" class="col-11">
          <div class="row">
            <div class="col-md-6 mb-2">
              <div class="row">
                <div class="col">
                  <div>
                    <a href="/docs/" title="Documentation">Documentation</a> &rarr; <a href="/docs/13/index.html">PostgreSQL 13</a>
                  </div>
                </div>
              </div>
              
                <div class="row">
                  <div class="col">
                    Supported Versions:
                      
                        
                        
                          <a href="/docs/current/planner-stats-security.html" title="PostgreSQL 17 - 71.3. Planner Statistics and Security" >Current</a>
                          (<a href="/docs/17/planner-stats-security.html" title="PostgreSQL 17 - 71.3. Planner Statistics and Security" >17</a>)
                        
                      
                         / 
                        
                          <a href="/docs/16/planner-stats-security.html" title="PostgreSQL 16 - 71.3. Planner Statistics and Security" >16</a>
                        
                      
                         / 
                        
                          <a href="/docs/15/planner-stats-security.html" title="PostgreSQL 15 - 71.3. Planner Statistics and Security" >15</a>
                        
                      
                         / 
                        
                          <a href="/docs/14/planner-stats-security.html" title="PostgreSQL 14 - 71.3. Planner Statistics and Security" >14</a>
                        
                      
                         / 
                        
                          <a href="/docs/13/planner-stats-security.html" title="PostgreSQL 13 - 71.3. Planner Statistics and Security" class="docs-version-selected">13</a>
                        
                      
                  </div>
                </div>
              
              
                <div class="row">
                  <div class="col">
                    Development Versions:
                    
                      
                      <a href="/docs/devel/planner-stats-security.html" title="PostgreSQL devel - 71.3. Planner Statistics and Security"  rel="nofollow">devel</a>
                    
                  </div>
                </div>
              
              
                <div class="row">
                  <div class="col-12">
                    Unsupported versions:
                    
                      
                      <a href="/docs/12/planner-stats-security.html" title="PostgreSQL 12 - 71.3. Planner Statistics and Security"  rel="nofollow">12</a>
                    
                       / 
                      <a href="/docs/11/planner-stats-security.html" title="PostgreSQL 11 - 71.3. Planner Statistics and Security"  rel="nofollow">11</a>
                    
                       / 
                      <a href="/docs/10/planner-stats-security.html" title="PostgreSQL 10 - 71.3. Planner Statistics and Security"  rel="nofollow">10</a>
                    
                       / 
                      <a href="/docs/9.6/planner-stats-security.html" title="PostgreSQL 9.6 - 71.3. Planner Statistics and Security"  rel="nofollow">9.6</a>
                    
                       / 
                      <a href="/docs/9.5/planner-stats-security.html" title="PostgreSQL 9.5 - 71.3. Planner Statistics and Security"  rel="nofollow">9.5</a>
                    
                       / 
                      <a href="/docs/9.4/planner-stats-security.html" title="PostgreSQL 9.4 - 71.3. Planner Statistics and Security"  rel="nofollow">9.4</a>
                    
                       / 
                      <a href="/docs/9.3/planner-stats-security.html" title="PostgreSQL 9.3 - 71.3. Planner Statistics and Security"  rel="nofollow">9.3</a>
                    
                       / 
                      <a href="/docs/9.2/planner-stats-security.html" title="PostgreSQL 9.2 - 71.3. Planner Statistics and Security"  rel="nofollow">9.2</a>
                    
                  </div>
                </div>
              
            </div>
            <div class="col-md-6 col-lg-5 offset-lg-1">
              <form id="docSearchForm" role="search" method="get" action="/search/">
                <input type="hidden" name="u" value="/docs/13/" />
                <div class="input-group">
                  <input type="text" id="q" name="q" class="form-control" placeholder="Search the documentation for..."/>
                  <span class="input-group-btn">
                    <button class="btn btn-default" type="submit"><i class="fas fa-search"></i></button>
                  </span>
                </div>
              </form>
            </div>
          </div>

          <div id="docContent">
            <div xmlns="http://www.w3.org/TR/xhtml1/transitional" class="navheader">
  <table width="100%" summary="Navigation header">
    <tr>
      <th colspan="5" align="center">71.3.&nbsp;Planner Statistics and Security</th>
    </tr>
    <tr>
      <td width="10%" align="left"><a accesskey="p" href="multivariate-statistics-examples.html" title="71.2.&nbsp;Multivariate Statistics Examples">Prev</a>&nbsp;</td>
      <td width="10%" align="left"><a accesskey="u" href="planner-stats-details.html" title="Chapter&nbsp;71.&nbsp;How the Planner Uses Statistics">Up</a></td>
      <th width="60%" align="center">Chapter&nbsp;71.&nbsp;How the Planner Uses Statistics</th>
      <td width="10%" align="right"><a accesskey="h" href="index.html" title="PostgreSQL 13.20 Documentation">Home</a></td>
      <td width="10%" align="right">&nbsp;<a accesskey="n" href="backup-manifest-format.html" title="Chapter&nbsp;72.&nbsp;Backup Manifest Format">Next</a></td>
    </tr>
  </table>
  <hr />
</div>
<div class="sect1" id="PLANNER-STATS-SECURITY">
  <div class="titlepage">
    <div>
      <div>
        <h2 class="title" style="clear: both">71.3.&nbsp;Planner Statistics and Security</h2>
      </div>
    </div>
  </div>
  <p>Access to the table <code class="structname">pg_statistic</code> is restricted to superusers, so that ordinary users cannot learn about the contents of the tables of other users from it. Some selectivity estimation functions will use a user-provided operator (either the operator appearing in the query or a related operator) to analyze the stored statistics. For example, in order to determine whether a stored most common value is applicable, the selectivity estimator will have to run the appropriate <code class="literal">=</code> operator to compare the constant in the query to the stored value. Thus the data in <code class="structname">pg_statistic</code> is potentially passed to user-defined operators. An appropriately crafted operator can intentionally leak the passed operands (for example, by logging them or writing them to a different table), or accidentally leak them by showing their values in error messages, in either case possibly exposing data from <code class="structname">pg_statistic</code> to a user who should not be able to see it.</p>
  <p>In order to prevent this, the following applies to all built-in selectivity estimation functions. When planning a query, in order to be able to use stored statistics, the current user must either have <code class="literal">SELECT</code> privilege on the table or the involved columns, or the operator used must be <code class="literal">LEAKPROOF</code> (more accurately, the function that the operator is based on). If not, then the selectivity estimator will behave as if no statistics are available, and the planner will proceed with default or fall-back assumptions.</p>
  <p>If a user does not have the required privilege on the table or columns, then in many cases the query will ultimately receive a permission-denied error, in which case this mechanism is invisible in practice. But if the user is reading from a security-barrier view, then the planner might wish to check the statistics of an underlying table that is otherwise inaccessible to the user. In that case, the operator should be leak-proof or the statistics will not be used. There is no direct feedback about that, except that the plan might be suboptimal. If one suspects that this is the case, one could try running the query as a more privileged user, to see if a different plan results.</p>
  <p>This restriction applies only to cases where the planner would need to execute a user-defined operator on one or more values from <code class="structname">pg_statistic</code>. Thus the planner is permitted to use generic statistical information, such as the fraction of null values or the number of distinct values in a column, regardless of access privileges.</p>
  <p>Selectivity estimation functions contained in third-party extensions that potentially operate on statistics with user-defined operators should follow the same security rules. Consult the PostgreSQL source code for guidance.</p>
</div>
<div xmlns="http://www.w3.org/TR/xhtml1/transitional" class="navfooter">
  <hr />
  <table width="100%" summary="Navigation footer">
    <tr>
      <td width="40%" align="left"><a accesskey="p" href="multivariate-statistics-examples.html" title="71.2.&nbsp;Multivariate Statistics Examples">Prev</a>&nbsp;</td>
      <td width="20%" align="center"><a accesskey="u" href="planner-stats-details.html" title="Chapter&nbsp;71.&nbsp;How the Planner Uses Statistics">Up</a></td>
      <td width="40%" align="right">&nbsp;<a accesskey="n" href="backup-manifest-format.html" title="Chapter&nbsp;72.&nbsp;Backup Manifest Format">Next</a></td>
    </tr>
    <tr>
      <td width="40%" align="left" valign="top">71.2.&nbsp;Multivariate Statistics Examples&nbsp;</td>
      <td width="20%" align="center"><a accesskey="h" href="index.html" title="PostgreSQL 13.20 Documentation">Home</a></td>
      <td width="40%" align="right" valign="top">&nbsp;Chapter&nbsp;72.&nbsp;Backup Manifest Format</td>
    </tr>
  </table>
</div>

          </div>
          
            <div id="docComments">
              <h2>Submit correction</h2>
              <p>
              If you see anything in the documentation that is not correct, does not match
              your experience with the particular feature or requires further clarification,
              please use
              <a href="/account/comments/new/13/planner-stats-security.html/" rel="nofollow">this form</a>
              to report a documentation issue.
              </p>
            </div>
          
        </div> 
      </div>
    </div>
    
    
    
    
    
    
  </body>
</html>
