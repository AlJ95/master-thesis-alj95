<!doctype html>
<html lang="en">
 <head>
  <title>PostgreSQL: Documentation: 13: 35.5. Dynamic SQL</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta http-equiv="Content-Type" content="text/xhtml; charset=utf-8" />
   
  <meta name="theme-color" content="#336791"/>
  <meta name="copyright" content="The PostgreSQL Global Development Group" />
  <meta property="og:url" content="https://www.postgresql.org/docs/13/ecpg-dynamic.html" />
  <meta property="og:type" content="article" />
  <meta property="article:published_time" content="2025-02-20T14:13:26" />
  <meta property="og:image" content="https://www.postgresql.org/media/img/about/press/elephant.png" />
  <meta property="og:title" content="35.5. Dynamic SQL" />
  <meta property="og:description" content="35.5.&amp;nbsp;Dynamic SQL 35.5.1. Executing Statements without a Result Set 35.5.2. Executing a Statement with Input Parameters 35.5.3. Executing a Statement …" />
  <meta property="og:site_name" content="PostgreSQL Documentation" />


  

  
  
  
  
  

  

  
  </head>
  <body>
    <div class="container-fluid">
      <div class="row justify-content-md-center">
        <div class="col">
          
          
        </div>
      </div>
      <div class="row justify-content-center pg-shout-box">
        <div class="col text-white text-center">February 20, 2025: <a href="/about/news/postgresql-174-168-1512-1417-and-1320-released-3018/">
  PostgreSQL 17.4, 16.8, 15.12, 14.17, and 13.20 Released!
</a>

</div>
      </div>
    </div>
    <div class="container-fluid margin">
      <div class="row">
        <div id="pgContentWrap" class="col-11">
          <div class="row">
            <div class="col-md-6 mb-2">
              <div class="row">
                <div class="col">
                  <div>
                    <a href="/docs/" title="Documentation">Documentation</a> &rarr; <a href="/docs/13/index.html">PostgreSQL 13</a>
                  </div>
                </div>
              </div>
              
                <div class="row">
                  <div class="col">
                    Supported Versions:
                      
                        
                        
                          <a href="/docs/current/ecpg-dynamic.html" title="PostgreSQL 17 - 35.5. Dynamic SQL" >Current</a>
                          (<a href="/docs/17/ecpg-dynamic.html" title="PostgreSQL 17 - 35.5. Dynamic SQL" >17</a>)
                        
                      
                         / 
                        
                          <a href="/docs/16/ecpg-dynamic.html" title="PostgreSQL 16 - 35.5. Dynamic SQL" >16</a>
                        
                      
                         / 
                        
                          <a href="/docs/15/ecpg-dynamic.html" title="PostgreSQL 15 - 35.5. Dynamic SQL" >15</a>
                        
                      
                         / 
                        
                          <a href="/docs/14/ecpg-dynamic.html" title="PostgreSQL 14 - 35.5. Dynamic SQL" >14</a>
                        
                      
                         / 
                        
                          <a href="/docs/13/ecpg-dynamic.html" title="PostgreSQL 13 - 35.5. Dynamic SQL" class="docs-version-selected">13</a>
                        
                      
                  </div>
                </div>
              
              
                <div class="row">
                  <div class="col">
                    Development Versions:
                    
                      
                      <a href="/docs/devel/ecpg-dynamic.html" title="PostgreSQL devel - 35.5. Dynamic SQL"  rel="nofollow">devel</a>
                    
                  </div>
                </div>
              
              
                <div class="row">
                  <div class="col-12">
                    Unsupported versions:
                    
                      
                      <a href="/docs/12/ecpg-dynamic.html" title="PostgreSQL 12 - 35.5. Dynamic SQL"  rel="nofollow">12</a>
                    
                       / 
                      <a href="/docs/11/ecpg-dynamic.html" title="PostgreSQL 11 - 35.5. Dynamic SQL"  rel="nofollow">11</a>
                    
                       / 
                      <a href="/docs/10/ecpg-dynamic.html" title="PostgreSQL 10 - 35.5. Dynamic SQL"  rel="nofollow">10</a>
                    
                       / 
                      <a href="/docs/9.6/ecpg-dynamic.html" title="PostgreSQL 9.6 - 35.5. Dynamic SQL"  rel="nofollow">9.6</a>
                    
                       / 
                      <a href="/docs/9.5/ecpg-dynamic.html" title="PostgreSQL 9.5 - 35.5. Dynamic SQL"  rel="nofollow">9.5</a>
                    
                       / 
                      <a href="/docs/9.4/ecpg-dynamic.html" title="PostgreSQL 9.4 - 35.5. Dynamic SQL"  rel="nofollow">9.4</a>
                    
                       / 
                      <a href="/docs/9.3/ecpg-dynamic.html" title="PostgreSQL 9.3 - 35.5. Dynamic SQL"  rel="nofollow">9.3</a>
                    
                       / 
                      <a href="/docs/9.2/ecpg-dynamic.html" title="PostgreSQL 9.2 - 35.5. Dynamic SQL"  rel="nofollow">9.2</a>
                    
                       / 
                      <a href="/docs/9.1/ecpg-dynamic.html" title="PostgreSQL 9.1 - 35.5. Dynamic SQL"  rel="nofollow">9.1</a>
                    
                       / 
                      <a href="/docs/9.0/ecpg-dynamic.html" title="PostgreSQL 9.0 - 35.5. Dynamic SQL"  rel="nofollow">9.0</a>
                    
                       / 
                      <a href="/docs/8.4/ecpg-dynamic.html" title="PostgreSQL 8.4 - 35.5. Dynamic SQL"  rel="nofollow">8.4</a>
                    
                       / 
                      <a href="/docs/8.3/ecpg-dynamic.html" title="PostgreSQL 8.3 - 35.5. Dynamic SQL"  rel="nofollow">8.3</a>
                    
                       / 
                      <a href="/docs/8.2/ecpg-dynamic.html" title="PostgreSQL 8.2 - 35.5. Dynamic SQL"  rel="nofollow">8.2</a>
                    
                       / 
                      <a href="/docs/8.1/ecpg-dynamic.html" title="PostgreSQL 8.1 - 35.5. Dynamic SQL"  rel="nofollow">8.1</a>
                    
                       / 
                      <a href="/docs/8.0/ecpg-dynamic.html" title="PostgreSQL 8.0 - 35.5. Dynamic SQL"  rel="nofollow">8.0</a>
                    
                       / 
                      <a href="/docs/7.4/ecpg-dynamic.html" title="PostgreSQL 7.4 - 35.5. Dynamic SQL"  rel="nofollow">7.4</a>
                    
                  </div>
                </div>
              
            </div>
            <div class="col-md-6 col-lg-5 offset-lg-1">
              <form id="docSearchForm" role="search" method="get" action="/search/">
                <input type="hidden" name="u" value="/docs/13/" />
                <div class="input-group">
                  <input type="text" id="q" name="q" class="form-control" placeholder="Search the documentation for..."/>
                  <span class="input-group-btn">
                    <button class="btn btn-default" type="submit"><i class="fas fa-search"></i></button>
                  </span>
                </div>
              </form>
            </div>
          </div>

          <div id="docContent">
            <div xmlns="http://www.w3.org/TR/xhtml1/transitional" class="navheader">
  <table width="100%" summary="Navigation header">
    <tr>
      <th colspan="5" align="center">35.5.&nbsp;Dynamic SQL</th>
    </tr>
    <tr>
      <td width="10%" align="left"><a accesskey="p" href="ecpg-variables.html" title="35.4.&nbsp;Using Host Variables">Prev</a>&nbsp;</td>
      <td width="10%" align="left"><a accesskey="u" href="ecpg.html" title="Chapter&nbsp;35.&nbsp;ECPG — Embedded SQL in C">Up</a></td>
      <th width="60%" align="center">Chapter&nbsp;35.&nbsp;<span xmlns="http://www.w3.org/1999/xhtml" class="application">ECPG</span> — Embedded <acronym xmlns="http://www.w3.org/1999/xhtml" class="acronym">SQL</acronym> in C</th>
      <td width="10%" align="right"><a accesskey="h" href="index.html" title="PostgreSQL 13.20 Documentation">Home</a></td>
      <td width="10%" align="right">&nbsp;<a accesskey="n" href="ecpg-pgtypes.html" title="35.6.&nbsp;pgtypes Library">Next</a></td>
    </tr>
  </table>
  <hr />
</div>
<div class="sect1" id="ECPG-DYNAMIC">
  <div class="titlepage">
    <div>
      <div>
        <h2 class="title" style="clear: both">35.5.&nbsp;Dynamic SQL</h2>
      </div>
    </div>
  </div>
  <div class="toc">
    <dl class="toc">
      <dt><span class="sect2"><a href="ecpg-dynamic.html#ECPG-DYNAMIC-WITHOUT-RESULT">35.5.1. Executing Statements without a Result Set</a></span></dt>
      <dt><span class="sect2"><a href="ecpg-dynamic.html#ECPG-DYNAMIC-INPUT">35.5.2. Executing a Statement with Input Parameters</a></span></dt>
      <dt><span class="sect2"><a href="ecpg-dynamic.html#ECPG-DYNAMIC-WITH-RESULT">35.5.3. Executing a Statement with a Result Set</a></span></dt>
    </dl>
  </div>
  <p>In many cases, the particular SQL statements that an application has to execute are known at the time the application is written. In some cases, however, the SQL statements are composed at run time or provided by an external source. In these cases you cannot embed the SQL statements directly into the C source code, but there is a facility that allows you to call arbitrary SQL statements that you provide in a string variable.</p>
  <div class="sect2" id="ECPG-DYNAMIC-WITHOUT-RESULT">
    <div class="titlepage">
      <div>
        <div>
          <h3 class="title">35.5.1.&nbsp;Executing Statements without a Result Set</h3>
        </div>
      </div>
    </div>
    <p>The simplest way to execute an arbitrary SQL statement is to use the command <code class="command">EXECUTE IMMEDIATE</code>. For example:</p>
    <pre class="programlisting">
EXEC SQL BEGIN DECLARE SECTION;
const char *stmt = "CREATE TABLE test1 (...);";
EXEC SQL END DECLARE SECTION;

EXEC SQL EXECUTE IMMEDIATE :stmt;
</pre>
    <p><code class="command">EXECUTE IMMEDIATE</code> can be used for SQL statements that do not return a result set (e.g., DDL, <code class="command">INSERT</code>, <code class="command">UPDATE</code>, <code class="command">DELETE</code>). You cannot execute statements that retrieve data (e.g., <code class="command">SELECT</code>) this way. The next section describes how to do that.</p>
  </div>
  <div class="sect2" id="ECPG-DYNAMIC-INPUT">
    <div class="titlepage">
      <div>
        <div>
          <h3 class="title">35.5.2.&nbsp;Executing a Statement with Input Parameters</h3>
        </div>
      </div>
    </div>
    <p>A more powerful way to execute arbitrary SQL statements is to prepare them once and execute the prepared statement as often as you like. It is also possible to prepare a generalized version of a statement and then execute specific versions of it by substituting parameters. When preparing the statement, write question marks where you want to substitute parameters later. For example:</p>
    <pre class="programlisting">
EXEC SQL BEGIN DECLARE SECTION;
const char *stmt = "INSERT INTO test1 VALUES(?, ?);";
EXEC SQL END DECLARE SECTION;

EXEC SQL PREPARE mystmt FROM :stmt;
 ...
EXEC SQL EXECUTE mystmt USING 42, 'foobar';
</pre>
    <p>When you don't need the prepared statement anymore, you should deallocate it:</p>
    <pre class="programlisting">
EXEC SQL DEALLOCATE PREPARE <em class="replaceable"><code>name</code></em>;
</pre>
  </div>
  <div class="sect2" id="ECPG-DYNAMIC-WITH-RESULT">
    <div class="titlepage">
      <div>
        <div>
          <h3 class="title">35.5.3.&nbsp;Executing a Statement with a Result Set</h3>
        </div>
      </div>
    </div>
    <p>To execute an SQL statement with a single result row, <code class="command">EXECUTE</code> can be used. To save the result, add an <code class="literal">INTO</code> clause.</p>
    <pre class="programlisting">
EXEC SQL BEGIN DECLARE SECTION;
const char *stmt = "SELECT a, b, c FROM test1 WHERE a &gt; ?";
int v1, v2;
VARCHAR v3[50];
EXEC SQL END DECLARE SECTION;

EXEC SQL PREPARE mystmt FROM :stmt;
 ...
EXEC SQL EXECUTE mystmt INTO :v1, :v2, :v3 USING 37;

</pre>
    <p>An <code class="command">EXECUTE</code> command can have an <code class="literal">INTO</code> clause, a <code class="literal">USING</code> clause, both, or neither.</p>
    <p>If a query is expected to return more than one result row, a cursor should be used, as in the following example. (See <a class="xref" href="ecpg-commands.html#ECPG-CURSORS" title="35.3.2.&nbsp;Using Cursors">Section&nbsp;35.3.2</a> for more details about the cursor.)</p>
    <pre class="programlisting">
EXEC SQL BEGIN DECLARE SECTION;
char dbaname[128];
char datname[128];
char *stmt = "SELECT u.usename as dbaname, d.datname "
             "  FROM pg_database d, pg_user u "
             "  WHERE d.datdba = u.usesysid";
EXEC SQL END DECLARE SECTION;

EXEC SQL CONNECT TO testdb AS con1 USER testuser;
EXEC SQL SELECT pg_catalog.set_config('search_path', '', false); EXEC SQL COMMIT;

EXEC SQL PREPARE stmt1 FROM :stmt;

EXEC SQL DECLARE cursor1 CURSOR FOR stmt1;
EXEC SQL OPEN cursor1;

EXEC SQL WHENEVER NOT FOUND DO BREAK;

while (1)
{
    EXEC SQL FETCH cursor1 INTO :dbaname,:datname;
    printf("dbaname=%s, datname=%s\n", dbaname, datname);
}

EXEC SQL CLOSE cursor1;

EXEC SQL COMMIT;
EXEC SQL DISCONNECT ALL;
</pre>
  </div>
</div>
<div xmlns="http://www.w3.org/TR/xhtml1/transitional" class="navfooter">
  <hr />
  <table width="100%" summary="Navigation footer">
    <tr>
      <td width="40%" align="left"><a accesskey="p" href="ecpg-variables.html" title="35.4.&nbsp;Using Host Variables">Prev</a>&nbsp;</td>
      <td width="20%" align="center"><a accesskey="u" href="ecpg.html" title="Chapter&nbsp;35.&nbsp;ECPG — Embedded SQL in C">Up</a></td>
      <td width="40%" align="right">&nbsp;<a accesskey="n" href="ecpg-pgtypes.html" title="35.6.&nbsp;pgtypes Library">Next</a></td>
    </tr>
    <tr>
      <td width="40%" align="left" valign="top">35.4.&nbsp;Using Host Variables&nbsp;</td>
      <td width="20%" align="center"><a accesskey="h" href="index.html" title="PostgreSQL 13.20 Documentation">Home</a></td>
      <td width="40%" align="right" valign="top">&nbsp;35.6.&nbsp;pgtypes Library</td>
    </tr>
  </table>
</div>

          </div>
          
            <div id="docComments">
              <h2>Submit correction</h2>
              <p>
              If you see anything in the documentation that is not correct, does not match
              your experience with the particular feature or requires further clarification,
              please use
              <a href="/account/comments/new/13/ecpg-dynamic.html/" rel="nofollow">this form</a>
              to report a documentation issue.
              </p>
            </div>
          
        </div> 
      </div>
    </div>
    
    
    
    
    
    
  </body>
</html>
