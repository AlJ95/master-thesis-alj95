<!doctype html><html itemscope itemtype=http://schema.org/WebPage lang=en class=no-js><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Role-based access control | etcd</title>
<meta name=description content="A basic authentication and role-based access control guide"><meta property="og:url" content="https://etcd.io/docs/v3.5/op-guide/authentication/rbac/"><meta property="og:site_name" content="etcd"><meta property="og:title" content="Role-based access control"><meta property="og:description" content="A basic authentication and role-based access control guide"><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="docs"><meta property="article:modified_time" content="2023-04-17T20:13:59+09:00"><meta itemprop=name content="Role-based access control"><meta itemprop=description content="A basic authentication and role-based access control guide"><meta itemprop=dateModified content="2023-04-17T20:13:59+09:00"><meta itemprop=wordCount content="987"><meta name=twitter:card content="summary"><meta name=twitter:title content="Role-based access control"><meta name=twitter:description content="A basic authentication and role-based access control guide"></head><body class=td-page><div class="container-fluid td-outer"><div class=td-main><div class="row flex-xl-nowrap"><main class="col-12 col-md-9 col-xl-8 ps-md-5" role=main><div class=td-content><h1>Role-based access control</h1><div class=lead>A basic authentication and role-based access control guide</div><h2 id=overview>Overview</h2><p>Authentication was added in etcd 2.1. The etcd v3 API slightly modified the authentication feature&rsquo;s API and user interface to better fit the new data model. This guide is intended to help users set up basic authentication and role-based access control in etcd v3.</p><h2 id=special-users-and-roles>Special users and roles</h2><p>There is one special user, <code>root</code>, and one special role, <code>root</code>.</p><h3 id=user-root>User <code>root</code></h3><p>The <code>root</code> user, which has full access to etcd, must be created before activating authentication. The idea behind the <code>root</code> user is for administrative purposes: managing roles and ordinary users. The <code>root</code> user must have the <code>root</code> role and is allowed to change anything inside etcd.</p><h3 id=role-root>Role <code>root</code></h3><p>The role <code>root</code> may be granted to any user, in addition to the root user. A user with the <code>root</code> role has both global read-write access and permission to update the cluster&rsquo;s authentication configuration. Furthermore, the <code>root</code> role grants privileges for general cluster maintenance, including modifying cluster membership, defragmenting the store, and taking snapshots.</p><h2 id=working-with-users>Working with users</h2><p>The <code>user</code> subcommand for <code>etcdctl</code> handles all things having to do with user accounts.</p><p>A listing of users can be found with:</p><pre tabindex=0><code>$ etcdctl user list
</code></pre><p>Creating a user is as easy as</p><pre tabindex=0><code>$ etcdctl user add myusername
</code></pre><p>Creating a new user will prompt for a new password. The password can be supplied from standard input when an option <code>--interactive=false</code> is given. <code>--new-user-password</code> can also be used for supplying the password.</p><p>Roles can be granted and revoked for a user with:</p><pre tabindex=0><code>$ etcdctl user grant-role myusername foo
$ etcdctl user revoke-role myusername bar
</code></pre><p>The user&rsquo;s settings can be inspected with:</p><pre tabindex=0><code>$ etcdctl user get myusername
</code></pre><p>And the password for a user can be changed with</p><pre tabindex=0><code>$ etcdctl user passwd myusername
</code></pre><p>Changing the password will prompt again for a new password. The password can be supplied from standard input when an option <code>--interactive=false</code> is given.</p><p>Delete an account with:</p><pre tabindex=0><code>$ etcdctl user delete myusername
</code></pre><h2 id=working-with-roles>Working with roles</h2><p>The <code>role</code> subcommand for <code>etcdctl</code> handles all things having to do with access controls for particular roles, as were granted to individual users.</p><p>List roles with:</p><pre tabindex=0><code>$ etcdctl role list
</code></pre><p>Create a new role with:</p><pre tabindex=0><code>$ etcdctl role add myrolename
</code></pre><p>A role has no password; it merely defines a new set of access rights.</p><p>Roles are granted access to a single key or a range of keys.</p><p>The range can be specified as an interval [start-key, end-key) where start-key should be lexically less than end-key in an alphabetical manner.</p><p>Access can be granted as either read, write, or both, as in the following examples:</p><pre tabindex=0><code># Give read access to a key /foo
$ etcdctl role grant-permission myrolename read /foo

# Give read access to keys with a prefix /foo/. The prefix is equal to the range [/foo/, /foo0)
$ etcdctl role grant-permission myrolename --prefix=true read /foo/

# Give write-only access to the key at /foo/bar
$ etcdctl role grant-permission myrolename write /foo/bar

# Give full access to keys in a range of [key1, key5)
$ etcdctl role grant-permission myrolename readwrite key1 key5

# Give full access to keys with a prefix /pub/
$ etcdctl role grant-permission myrolename --prefix=true readwrite /pub/
</code></pre><p>To see what&rsquo;s granted, we can look at the role at any time:</p><pre tabindex=0><code>$ etcdctl role get myrolename
</code></pre><p>Revocation of permissions is done the same logical way:</p><pre tabindex=0><code>$ etcdctl role revoke-permission myrolename /foo/bar
</code></pre><p>As is removing a role entirely:</p><pre tabindex=0><code>$ etcdctl role delete myrolename
</code></pre><h2 id=enabling-authentication>Enabling authentication</h2><p>The minimal steps to enabling auth are as follows. The administrator can set up users and roles before or after enabling authentication, as a matter of preference.</p><p>Make sure the root user is created:</p><pre tabindex=0><code>$ etcdctl user add root
Password of root:
</code></pre><p>Enable authentication:</p><pre tabindex=0><code>$ etcdctl auth enable
</code></pre><p>After this, etcd is running with authentication enabled. To disable it for any reason, use the reciprocal command:</p><pre tabindex=0><code>$ etcdctl --user root:rootpw auth disable
</code></pre><h2 id=using-etcdctl-to-authenticate>Using <code>etcdctl</code> to authenticate</h2><p><code>etcdctl</code> supports a similar flag as <code>curl</code> for authentication.</p><pre tabindex=0><code>$ etcdctl --user user:password get foo
</code></pre><p>The password can be taken from a prompt:</p><pre tabindex=0><code>$ etcdctl --user user get foo
</code></pre><p>The password can also be taken from a command line flag <code>--password</code>:</p><pre tabindex=0><code>$ etcdctl --user user --password password get foo
</code></pre><p>Creating a user which cannot be authenticated with password is also possible like below:</p><pre tabindex=0><code>$ etcdctl user add myusername --no-password
</code></pre><p>Such a user can only be <a href=#using-tls-common-name>authenticated with TLS Common Name</a>.</p><p>Otherwise, all <code>etcdctl</code> commands remain the same. Users and roles can still be created and modified, but require authentication by a user with the root role.</p><h2 id=using-tls-common-name>Using TLS Common Name</h2><p>As of version v3.2 if an etcd server is launched with the option <code>--client-cert-auth=true</code>, the field of Common Name (CN) in the client&rsquo;s TLS cert will be used as an etcd user. In this case, the common name authenticates the user and the client does not need a password. Note that if both of 1. <code>--client-cert-auth=true</code> is passed and CN is provided by the client, and 2. username and password are provided by the client, the username and password based authentication is prioritized. Note that this feature cannot be used with gRPC-proxy and gRPC-gateway. This is because gRPC-proxy terminates TLS from its client so all the clients share a cert of the proxy. gRPC-gateway uses a TLS connection internally for transforming HTTP request to gRPC request so it shares the same limitation. Therefore the clients cannot provide their CN to the server correctly. gRPC-proxy will cause an error and stop if a given cert has non empty CN. gRPC-proxy returns an error which indicates that the client has an non empty CN in its cert.</p><h2 id=notes-on-password-strength>Notes on password strength</h2><p>The <code>etcdctl</code> and etcd API do not enforce a specific password length during user creation or user password update operations. It is the responsibility of the administrator to enforce these requirements. For avoiding security risks related to password strength, <a href=#using-tls-common-name>TLS Common Name based authentication</a> and users created with <code>--no-password</code> option can be utilized.</p><div class=d-print-none><h2 class=feedback--title>Feedback</h2><p class=feedback--question>Was this page helpful?</p><button class="btn btn-primary mb-4 feedback--answer feedback--answer-yes">Yes</button>
<button class="btn btn-primary mb-4 feedback--answer feedback--answer-no">No</button><p class="feedback--response feedback--response-yes">Glad to hear it! Please <a href=https://github.com/etcd-io/website/issues/new>tell us how we can improve</a>.</p><p class="feedback--response feedback--response-no">Sorry to hear that. Please <a href=https://github.com/etcd-io/website/issues/new>tell us how we can improve</a>.</p></div><br><div class=td-page-meta__lastmod>Last modified April 17, 2023: <a href=https://github.com/etcd-io/website/commit/26fb46dd29c5063e8c77158d0a921e9a9eb084ec>Update the RBAC page (26fb46d)</a></div></div></main></div></div></div></body></html>