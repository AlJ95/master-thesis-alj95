<!doctype html>
<html lang="en">
 <head>
  <title>PostgreSQL: Documentation: 13: pg_archivecleanup</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta http-equiv="Content-Type" content="text/xhtml; charset=utf-8" />
   
  <meta name="theme-color" content="#336791"/>
  <meta name="copyright" content="The PostgreSQL Global Development Group" />
  <meta property="og:url" content="https://www.postgresql.org/docs/13/pgarchivecleanup.html" />
  <meta property="og:type" content="article" />
  <meta property="article:published_time" content="2025-02-20T14:13:26" />
  <meta property="og:image" content="https://www.postgresql.org/media/img/about/press/elephant.png" />
  <meta property="og:title" content="pg_archivecleanup" />
  <meta property="og:description" content="pg_archivecleanup pg_archivecleanup — clean up PostgreSQL WAL archive files Synopsis pg_archivecleanup [option...] archivelocation oldestkeptwalfile Description pg_archivecleanup is designed to be …" />
  <meta property="og:site_name" content="PostgreSQL Documentation" />


  

  
  
  
  
  

  

  
  </head>
  <body>
    <div class="container-fluid">
      <div class="row justify-content-md-center">
        <div class="col">
          
          
        </div>
      </div>
      <div class="row justify-content-center pg-shout-box">
        <div class="col text-white text-center">February 20, 2025: <a href="/about/news/postgresql-174-168-1512-1417-and-1320-released-3018/">
  PostgreSQL 17.4, 16.8, 15.12, 14.17, and 13.20 Released!
</a>

</div>
      </div>
    </div>
    <div class="container-fluid margin">
      <div class="row">
        <div id="pgContentWrap" class="col-11">
          <div class="row">
            <div class="col-md-6 mb-2">
              <div class="row">
                <div class="col">
                  <div>
                    <a href="/docs/" title="Documentation">Documentation</a> &rarr; <a href="/docs/13/index.html">PostgreSQL 13</a>
                  </div>
                </div>
              </div>
              
                <div class="row">
                  <div class="col">
                    Supported Versions:
                      
                        
                        
                          <a href="/docs/current/pgarchivecleanup.html" title="PostgreSQL 17 - pg_archivecleanup" >Current</a>
                          (<a href="/docs/17/pgarchivecleanup.html" title="PostgreSQL 17 - pg_archivecleanup" >17</a>)
                        
                      
                         / 
                        
                          <a href="/docs/16/pgarchivecleanup.html" title="PostgreSQL 16 - pg_archivecleanup" >16</a>
                        
                      
                         / 
                        
                          <a href="/docs/15/pgarchivecleanup.html" title="PostgreSQL 15 - pg_archivecleanup" >15</a>
                        
                      
                         / 
                        
                          <a href="/docs/14/pgarchivecleanup.html" title="PostgreSQL 14 - pg_archivecleanup" >14</a>
                        
                      
                         / 
                        
                          <a href="/docs/13/pgarchivecleanup.html" title="PostgreSQL 13 - pg_archivecleanup" class="docs-version-selected">13</a>
                        
                      
                  </div>
                </div>
              
              
                <div class="row">
                  <div class="col">
                    Development Versions:
                    
                      
                      <a href="/docs/devel/pgarchivecleanup.html" title="PostgreSQL devel - pg_archivecleanup"  rel="nofollow">devel</a>
                    
                  </div>
                </div>
              
              
                <div class="row">
                  <div class="col-12">
                    Unsupported versions:
                    
                      
                      <a href="/docs/12/pgarchivecleanup.html" title="PostgreSQL 12 - pg_archivecleanup"  rel="nofollow">12</a>
                    
                       / 
                      <a href="/docs/11/pgarchivecleanup.html" title="PostgreSQL 11 - pg_archivecleanup"  rel="nofollow">11</a>
                    
                       / 
                      <a href="/docs/10/pgarchivecleanup.html" title="PostgreSQL 10 - pg_archivecleanup"  rel="nofollow">10</a>
                    
                       / 
                      <a href="/docs/9.6/pgarchivecleanup.html" title="PostgreSQL 9.6 - pg_archivecleanup"  rel="nofollow">9.6</a>
                    
                       / 
                      <a href="/docs/9.5/pgarchivecleanup.html" title="PostgreSQL 9.5 - pg_archivecleanup"  rel="nofollow">9.5</a>
                    
                       / 
                      <a href="/docs/9.4/pgarchivecleanup.html" title="PostgreSQL 9.4 - pg_archivecleanup"  rel="nofollow">9.4</a>
                    
                       / 
                      <a href="/docs/9.3/pgarchivecleanup.html" title="PostgreSQL 9.3 - pg_archivecleanup"  rel="nofollow">9.3</a>
                    
                       / 
                      <a href="/docs/9.2/pgarchivecleanup.html" title="PostgreSQL 9.2 - pg_archivecleanup"  rel="nofollow">9.2</a>
                    
                       / 
                      <a href="/docs/9.1/pgarchivecleanup.html" title="PostgreSQL 9.1 - pg_archivecleanup"  rel="nofollow">9.1</a>
                    
                       / 
                      <a href="/docs/9.0/pgarchivecleanup.html" title="PostgreSQL 9.0 - pg_archivecleanup"  rel="nofollow">9.0</a>
                    
                  </div>
                </div>
              
            </div>
            <div class="col-md-6 col-lg-5 offset-lg-1">
              <form id="docSearchForm" role="search" method="get" action="/search/">
                <input type="hidden" name="u" value="/docs/13/" />
                <div class="input-group">
                  <input type="text" id="q" name="q" class="form-control" placeholder="Search the documentation for..."/>
                  <span class="input-group-btn">
                    <button class="btn btn-default" type="submit"><i class="fas fa-search"></i></button>
                  </span>
                </div>
              </form>
            </div>
          </div>

          <div id="docContent">
            <div xmlns="http://www.w3.org/TR/xhtml1/transitional" class="navheader">
  <table width="100%" summary="Navigation header">
    <tr>
      <th colspan="5" align="center"><span xmlns="http://www.w3.org/1999/xhtml" class="application">pg_archivecleanup</span></th>
    </tr>
    <tr>
      <td width="10%" align="left"><a accesskey="p" href="app-initdb.html" title="initdb">Prev</a>&nbsp;</td>
      <td width="10%" align="left"><a accesskey="u" href="reference-server.html" title="PostgreSQL Server Applications">Up</a></td>
      <th width="60%" align="center">PostgreSQL Server Applications</th>
      <td width="10%" align="right"><a accesskey="h" href="index.html" title="PostgreSQL 13.20 Documentation">Home</a></td>
      <td width="10%" align="right">&nbsp;<a accesskey="n" href="app-pgchecksums.html" title="pg_checksums">Next</a></td>
    </tr>
  </table>
  <hr />
</div>
<div class="refentry" id="PGARCHIVECLEANUP">
  <div class="titlepage"></div><a id="id-1.9.5.4.1" class="indexterm" name="id-1.9.5.4.1"></a>
  <div class="refnamediv">
    <h2><span class="refentrytitle"><span class="application">pg_archivecleanup</span></span></h2>
    <p>pg_archivecleanup — clean up <span class="productname">PostgreSQL</span> WAL archive files</p>
  </div>
  <div class="refsynopsisdiv">
    <h2>Synopsis</h2>
    <div class="cmdsynopsis">
      <p id="id-1.9.5.4.4.1"><code class="command">pg_archivecleanup</code> [<em class="replaceable"><code>option</code></em>...] <em class="replaceable"><code>archivelocation</code></em> <em class="replaceable"><code>oldestkeptwalfile</code></em></p>
    </div>
  </div>
  <div class="refsect1" id="id-1.9.5.4.5">
    <h2>Description</h2>
    <p><span class="application">pg_archivecleanup</span> is designed to be used as an <code class="literal">archive_cleanup_command</code> to clean up WAL file archives when running as a standby server (see <a class="xref" href="warm-standby.html" title="26.2.&nbsp;Log-Shipping Standby Servers">Section&nbsp;26.2</a>). <span class="application">pg_archivecleanup</span> can also be used as a standalone program to clean WAL file archives.</p>
    <p>To configure a standby server to use <span class="application">pg_archivecleanup</span>, put this into its <code class="filename">postgresql.conf</code> configuration file:</p>
    <pre class="programlisting">
archive_cleanup_command = 'pg_archivecleanup <em class="replaceable"><code>archivelocation</code></em> %r'
</pre>
    <p>where <em class="replaceable"><code>archivelocation</code></em> is the directory from which WAL segment files should be removed.</p>
    <p>When used within <a class="xref" href="runtime-config-wal.html#GUC-ARCHIVE-CLEANUP-COMMAND">archive_cleanup_command</a>, all WAL files logically preceding the value of the <code class="literal">%r</code> argument will be removed from <em class="replaceable"><code>archivelocation</code></em>. This minimizes the number of files that need to be retained, while preserving crash-restart capability. Use of this parameter is appropriate if the <em class="replaceable"><code>archivelocation</code></em> is a transient staging area for this particular standby server, but <span class="emphasis"><em>not</em></span> when the <em class="replaceable"><code>archivelocation</code></em> is intended as a long-term WAL archive area, or when multiple standby servers are recovering from the same archive location.</p>
    <p>When used as a standalone program all WAL files logically preceding the <em class="replaceable"><code>oldestkeptwalfile</code></em> will be removed from <em class="replaceable"><code>archivelocation</code></em>. In this mode, if you specify a <code class="filename">.partial</code> or <code class="filename">.backup</code> file name, then only the file prefix will be used as the <em class="replaceable"><code>oldestkeptwalfile</code></em>. This treatment of <code class="filename">.backup</code> file name allows you to remove all WAL files archived prior to a specific base backup without error. For example, the following example will remove all files older than WAL file name <code class="filename">000000010000003700000010</code>:</p>
    <pre class="programlisting">
pg_archivecleanup -d archive 000000010000003700000010.00000020.backup

pg_archivecleanup:  keep WAL file "archive/000000010000003700000010" and later
pg_archivecleanup:  removing file "archive/00000001000000370000000F"
pg_archivecleanup:  removing file "archive/00000001000000370000000E"
</pre>
    <p><span class="application">pg_archivecleanup</span> assumes that <em class="replaceable"><code>archivelocation</code></em> is a directory readable and writable by the server-owning user.</p>
  </div>
  <div class="refsect1" id="id-1.9.5.4.6">
    <h2>Options</h2>
    <p><span class="application">pg_archivecleanup</span> accepts the following command-line arguments:</p>
    <div class="variablelist">
      <dl class="variablelist">
        <dt><span class="term"><code class="option">-d</code></span></dt>
        <dd>
          <p>Print lots of debug logging output on <code class="filename">stderr</code>.</p>
        </dd>
        <dt><span class="term"><code class="option">-n</code></span></dt>
        <dd>
          <p>Print the names of the files that would have been removed on <code class="filename">stdout</code> (performs a dry run).</p>
        </dd>
        <dt><span class="term"><code class="option">-V</code><br /></span><span class="term"><code class="option">--version</code></span></dt>
        <dd>
          <p>Print the <span class="application">pg_archivecleanup</span> version and exit.</p>
        </dd>
        <dt><span class="term"><code class="option">-x</code> <em class="replaceable"><code>extension</code></em></span></dt>
        <dd>
          <p>Provide an extension that will be stripped from all file names before deciding if they should be deleted. This is typically useful for cleaning up archives that have been compressed during storage, and therefore have had an extension added by the compression program. For example: <code class="literal">-x .gz</code>.</p>
        </dd>
        <dt><span class="term"><code class="option">-?</code><br /></span><span class="term"><code class="option">--help</code></span></dt>
        <dd>
          <p>Show help about <span class="application">pg_archivecleanup</span> command line arguments, and exit.</p>
        </dd>
      </dl>
    </div>
  </div>
  <div class="refsect1" id="id-1.9.5.4.7">
    <h2>Environment</h2>
    <p>The environment variable <code class="envar">PG_COLOR</code> specifies whether to use color in diagnostic messages. Possible values are <code class="literal">always</code>, <code class="literal">auto</code> and <code class="literal">never</code>.</p>
  </div>
  <div class="refsect1" id="id-1.9.5.4.8">
    <h2>Notes</h2>
    <p><span class="application">pg_archivecleanup</span> is designed to work with <span class="productname">PostgreSQL</span> 8.0 and later when used as a standalone utility, or with <span class="productname">PostgreSQL</span> 9.0 and later when used as an archive cleanup command.</p>
    <p><span class="application">pg_archivecleanup</span> is written in C and has an easy-to-modify source code, with specifically designated sections to modify for your own needs</p>
  </div>
  <div class="refsect1" id="id-1.9.5.4.9">
    <h2>Examples</h2>
    <p>On Linux or Unix systems, you might use:</p>
    <pre class="programlisting">
archive_cleanup_command = 'pg_archivecleanup -d /mnt/standby/archive %r 2&gt;&gt;cleanup.log'
</pre>
    <p>where the archive directory is physically located on the standby server, so that the <code class="varname">archive_command</code> is accessing it across NFS, but the files are local to the standby. This will:</p>
    <div class="itemizedlist">
      <ul class="itemizedlist" style="list-style-type: disc;">
        <li class="listitem">
          <p>produce debugging output in <code class="filename">cleanup.log</code></p>
        </li>
        <li class="listitem">
          <p>remove no-longer-needed files from the archive directory</p>
        </li>
      </ul>
    </div>
  </div>
  <div class="refsect1" id="id-1.9.5.4.10">
    <h2>See Also</h2><span class="simplelist"><a class="xref" href="pgstandby.html" title="pg_standby"><span class="refentrytitle"><span class="application">pg_standby</span></span></a></span>
  </div>
</div>
<div xmlns="http://www.w3.org/TR/xhtml1/transitional" class="navfooter">
  <hr />
  <table width="100%" summary="Navigation footer">
    <tr>
      <td width="40%" align="left"><a accesskey="p" href="app-initdb.html" title="initdb">Prev</a>&nbsp;</td>
      <td width="20%" align="center"><a accesskey="u" href="reference-server.html" title="PostgreSQL Server Applications">Up</a></td>
      <td width="40%" align="right">&nbsp;<a accesskey="n" href="app-pgchecksums.html" title="pg_checksums">Next</a></td>
    </tr>
    <tr>
      <td width="40%" align="left" valign="top">initdb&nbsp;</td>
      <td width="20%" align="center"><a accesskey="h" href="index.html" title="PostgreSQL 13.20 Documentation">Home</a></td>
      <td width="40%" align="right" valign="top">&nbsp;<span xmlns="http://www.w3.org/1999/xhtml" class="application">pg_checksums</span></td>
    </tr>
  </table>
</div>

          </div>
          
            <div id="docComments">
              <h2>Submit correction</h2>
              <p>
              If you see anything in the documentation that is not correct, does not match
              your experience with the particular feature or requires further clarification,
              please use
              <a href="/account/comments/new/13/pgarchivecleanup.html/" rel="nofollow">this form</a>
              to report a documentation issue.
              </p>
            </div>
          
        </div> 
      </div>
    </div>
    
    
    
    
    
    
  </body>
</html>
