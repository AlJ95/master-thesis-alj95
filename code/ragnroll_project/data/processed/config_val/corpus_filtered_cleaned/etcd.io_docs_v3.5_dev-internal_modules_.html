<!doctype html><html itemscope itemtype=http://schema.org/WebPage lang=en class=no-js><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Golang modules | etcd</title>
<meta name=description content="Organization of the etcd project's golang modules"><meta property="og:url" content="https://etcd.io/docs/v3.5/dev-internal/modules/"><meta property="og:site_name" content="etcd"><meta property="og:title" content="Golang modules"><meta property="og:description" content="Organization of the etcd project's golang modules"><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="docs"><meta property="article:modified_time" content="2021-06-14T17:16:50+00:00"><meta itemprop=name content="Golang modules"><meta itemprop=description content="Organization of the etcd project's golang modules"><meta itemprop=dateModified content="2021-06-14T17:16:50+00:00"><meta itemprop=wordCount content="439"><meta name=twitter:card content="summary"><meta name=twitter:title content="Golang modules"><meta name=twitter:description content="Organization of the etcd project's golang modules"></head><body class=td-page><div class="container-fluid td-outer"><div class=td-main><div class="row flex-xl-nowrap"><main class="col-12 col-md-9 col-xl-8 ps-md-5" role=main><div class=td-content><h1>Golang modules</h1><div class=lead>Organization of the etcd project&rsquo;s golang modules</div><p>The etcd project (since version 3.5) is organized into multiple
<a href=https://golang.org/ref/mod target=_blank rel=noopener>golang modules</a> hosted in a <a href=https://golang.org/ref/mod#vcs-dir target=_blank rel=noopener>single repository</a>.</p><p></p><p>There are following modules:</p><ul><li><p><strong>go.etcd.io/etcd/api/v3</strong> - contains API definitions
(like protos & proto-generated libraries) that defines communication protocol
between etcd clients and server.</p></li><li><p><strong>go.etcd.io/etcd/pkg/v3</strong> - collection of utility packages used by etcd
without being specific to etcd itself. A package belongs here
only if it could possibly be moved out into its own repository in the future.
Please avoid adding here code that has a lot of dependencies on its own, as
they automatically becoming dependencies of the client library
(that we want to keep lightweight).</p></li><li><p><strong>go.etcd.io/etcd/client/v3</strong> - client library used to contact etcd over
the network (grpc). Recommended for all new usage of etcd.</p></li><li><p><strong>go.etcd.io/etcd/client/v2</strong> - legacy client library used to contact etcd
over HTTP protocol. Deprecated. All new usage should depend on /v3 library.</p></li><li><p><strong>go.etcd.io/etcd/raft/v3</strong> - implementation of distributed consensus
protocol. Should have no etcd specific code.</p></li><li><p><strong>go.etcd.io/etcd/server/v3</strong> - etcd implementation.
The code in this package is etcd internal and should not be consumed
by external projects. The package layout and API can change within the minor versions.</p></li><li><p><strong>go.etcd.io/etcd/etcdctl/v3</strong> - a command line tool to access and manage etcd.</p></li><li><p><strong>go.etcd.io/etcd/tests/v3</strong> - a module that contains all integration tests of etcd.
Notice: All unit-tests (fast and not requiring cross-module dependencies)
should be kept in the local modules to the code under the test.</p></li><li><p><strong>go.etcd.io/bbolt</strong> - implementation of persistent b-tree.
Hosted in a separate repository: <a href=https://github.com/etcd-io/bbolt target=_blank rel=noopener>https://github.com/etcd-io/bbolt</a>.</p></li></ul><h3 id=operations>Operations</h3><ol><li><p>All etcd modules should be released in the same versions, e.g.
<code>go.etcd.io/etcd/client/v3@v3.5.10</code> must depend on <code>go.etcd.io/etcd/api/v3@v3.5.10</code>.</p><p>The consistent updating of versions can by performed using:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>% <span style=color:#000>DRY_RUN</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#204a87>false</span> <span style=color:#000>TARGET_VERSION</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;v3.5.10&#34;</span> ./scripts/release_mod.sh update_versions
</span></span></code></pre></div></li><li><p>The released modules should be tagged according to <a href=https://golang.org/ref/mod#vcs-version target=_blank rel=noopener>https://golang.org/ref/mod#vcs-version</a> rules,
i.e. each module should get its own tag.
The tagging can be performed using:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>% <span style=color:#000>DRY_RUN</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#204a87>false</span> <span style=color:#000>REMOTE_REPO</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;origin&#34;</span> ./scripts/release_mod.sh push_mod_tags
</span></span></code></pre></div></li><li><p>All etcd modules should depend on the same versions of underlying dependencies.
This can be verified using:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>% <span style=color:#000>PASSES</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;dep&#34;</span> ./test.sh
</span></span></code></pre></div></li><li><p>The go.mod files must not contain dependencies not being used and must
conform to <code>go mod tidy</code> format.
This is being verified by:</p><pre tabindex=0><code>% PASSES=&#34;mod_tidy&#34; ./test.sh
</code></pre></li><li><p>To trigger actions across all modules (e.g. auto-format all files), please
use/expand the following script:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>% ./scripts/fix.sh
</span></span></code></pre></div></li></ol><h3 id=future>Future</h3><p>As a North Star, we would like to evaluate etcd modules towards following model:</p><p></p><p>This assumes:</p><ul><li>Splitting etcdmigrate/etcdadm out of etcdctl binary.
Thanks to this etcdctl would become clearly a command-line wrapper
around network client API,
while etcdmigrate/etcdadm would support direct physical operations on the
etcd storage files.</li><li>Splitting etcd-proxy out of ./etcd binary, as it contains more experimental code
so carries additional risk & dependencies.</li><li>Deprecation of support for v2 protocol.</li></ul><div class=d-print-none><h2 class=feedback--title>Feedback</h2><p class=feedback--question>Was this page helpful?</p><button class="btn btn-primary mb-4 feedback--answer feedback--answer-yes">Yes</button>
<button class="btn btn-primary mb-4 feedback--answer feedback--answer-no">No</button><p class="feedback--response feedback--response-yes">Glad to hear it! Please <a href=https://github.com/etcd-io/website/issues/new>tell us how we can improve</a>.</p><p class="feedback--response feedback--response-no">Sorry to hear that. Please <a href=https://github.com/etcd-io/website/issues/new>tell us how we can improve</a>.</p></div><br><div class=td-page-meta__lastmod>Last modified June 14, 2021: <a href=https://github.com/etcd-io/website/commit/138926b5de44b5116fdbe63830eeaf73596e4c2c>Renaming content/en/next folder to content/en/v3.5. Updating redirects, links, and config as needed. (#363) (138926b)</a></div></div></main></div></div></div></body></html>