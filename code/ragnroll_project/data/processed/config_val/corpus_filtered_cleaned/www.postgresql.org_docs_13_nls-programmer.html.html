<!doctype html>
<html lang="en">
 <head>
  <title>PostgreSQL: Documentation: 13: 54.2. For the Programmer</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta http-equiv="Content-Type" content="text/xhtml; charset=utf-8" />
   
  <meta name="theme-color" content="#336791"/>
  <meta name="copyright" content="The PostgreSQL Global Development Group" />
  <meta property="og:url" content="https://www.postgresql.org/docs/13/nls-programmer.html" />
  <meta property="og:type" content="article" />
  <meta property="article:published_time" content="2025-02-20T14:13:26" />
  <meta property="og:image" content="https://www.postgresql.org/media/img/about/press/elephant.png" />
  <meta property="og:title" content="54.2. For the Programmer" />
  <meta property="og:description" content="54.2.&amp;nbsp;For the Programmer 54.2.1. Mechanics 54.2.2. Message-Writing Guidelines 54.2.1.&amp;nbsp;Mechanics This section describes how to implement native language support in a …" />
  <meta property="og:site_name" content="PostgreSQL Documentation" />


  

  
  
  
  
  

  

  
  </head>
  <body>
    <div class="container-fluid">
      <div class="row justify-content-md-center">
        <div class="col">
          
          
        </div>
      </div>
      <div class="row justify-content-center pg-shout-box">
        <div class="col text-white text-center">February 20, 2025: <a href="/about/news/postgresql-174-168-1512-1417-and-1320-released-3018/">
  PostgreSQL 17.4, 16.8, 15.12, 14.17, and 13.20 Released!
</a>

</div>
      </div>
    </div>
    <div class="container-fluid margin">
      <div class="row">
        <div id="pgContentWrap" class="col-11">
          <div class="row">
            <div class="col-md-6 mb-2">
              <div class="row">
                <div class="col">
                  <div>
                    <a href="/docs/" title="Documentation">Documentation</a> &rarr; <a href="/docs/13/index.html">PostgreSQL 13</a>
                  </div>
                </div>
              </div>
              
                <div class="row">
                  <div class="col">
                    Supported Versions:
                      
                        
                        
                          <a href="/docs/current/nls-programmer.html" title="PostgreSQL 17 - 54.2. For the Programmer" >Current</a>
                          (<a href="/docs/17/nls-programmer.html" title="PostgreSQL 17 - 54.2. For the Programmer" >17</a>)
                        
                      
                         / 
                        
                          <a href="/docs/16/nls-programmer.html" title="PostgreSQL 16 - 54.2. For the Programmer" >16</a>
                        
                      
                         / 
                        
                          <a href="/docs/15/nls-programmer.html" title="PostgreSQL 15 - 54.2. For the Programmer" >15</a>
                        
                      
                         / 
                        
                          <a href="/docs/14/nls-programmer.html" title="PostgreSQL 14 - 54.2. For the Programmer" >14</a>
                        
                      
                         / 
                        
                          <a href="/docs/13/nls-programmer.html" title="PostgreSQL 13 - 54.2. For the Programmer" class="docs-version-selected">13</a>
                        
                      
                  </div>
                </div>
              
              
                <div class="row">
                  <div class="col">
                    Development Versions:
                    
                      
                      <a href="/docs/devel/nls-programmer.html" title="PostgreSQL devel - 54.2. For the Programmer"  rel="nofollow">devel</a>
                    
                  </div>
                </div>
              
              
                <div class="row">
                  <div class="col-12">
                    Unsupported versions:
                    
                      
                      <a href="/docs/12/nls-programmer.html" title="PostgreSQL 12 - 54.2. For the Programmer"  rel="nofollow">12</a>
                    
                       / 
                      <a href="/docs/11/nls-programmer.html" title="PostgreSQL 11 - 54.2. For the Programmer"  rel="nofollow">11</a>
                    
                       / 
                      <a href="/docs/10/nls-programmer.html" title="PostgreSQL 10 - 54.2. For the Programmer"  rel="nofollow">10</a>
                    
                       / 
                      <a href="/docs/9.6/nls-programmer.html" title="PostgreSQL 9.6 - 54.2. For the Programmer"  rel="nofollow">9.6</a>
                    
                       / 
                      <a href="/docs/9.5/nls-programmer.html" title="PostgreSQL 9.5 - 54.2. For the Programmer"  rel="nofollow">9.5</a>
                    
                       / 
                      <a href="/docs/9.4/nls-programmer.html" title="PostgreSQL 9.4 - 54.2. For the Programmer"  rel="nofollow">9.4</a>
                    
                       / 
                      <a href="/docs/9.3/nls-programmer.html" title="PostgreSQL 9.3 - 54.2. For the Programmer"  rel="nofollow">9.3</a>
                    
                       / 
                      <a href="/docs/9.2/nls-programmer.html" title="PostgreSQL 9.2 - 54.2. For the Programmer"  rel="nofollow">9.2</a>
                    
                       / 
                      <a href="/docs/9.1/nls-programmer.html" title="PostgreSQL 9.1 - 54.2. For the Programmer"  rel="nofollow">9.1</a>
                    
                       / 
                      <a href="/docs/9.0/nls-programmer.html" title="PostgreSQL 9.0 - 54.2. For the Programmer"  rel="nofollow">9.0</a>
                    
                       / 
                      <a href="/docs/8.4/nls-programmer.html" title="PostgreSQL 8.4 - 54.2. For the Programmer"  rel="nofollow">8.4</a>
                    
                       / 
                      <a href="/docs/8.3/nls-programmer.html" title="PostgreSQL 8.3 - 54.2. For the Programmer"  rel="nofollow">8.3</a>
                    
                       / 
                      <a href="/docs/8.2/nls-programmer.html" title="PostgreSQL 8.2 - 54.2. For the Programmer"  rel="nofollow">8.2</a>
                    
                       / 
                      <a href="/docs/8.1/nls-programmer.html" title="PostgreSQL 8.1 - 54.2. For the Programmer"  rel="nofollow">8.1</a>
                    
                       / 
                      <a href="/docs/8.0/nls-programmer.html" title="PostgreSQL 8.0 - 54.2. For the Programmer"  rel="nofollow">8.0</a>
                    
                       / 
                      <a href="/docs/7.4/nls-programmer.html" title="PostgreSQL 7.4 - 54.2. For the Programmer"  rel="nofollow">7.4</a>
                    
                       / 
                      <a href="/docs/7.3/nls-programmer.html" title="PostgreSQL 7.3 - 54.2. For the Programmer"  rel="nofollow">7.3</a>
                    
                       / 
                      <a href="/docs/7.2/nls-programmer.html" title="PostgreSQL 7.2 - 54.2. For the Programmer"  rel="nofollow">7.2</a>
                    
                  </div>
                </div>
              
            </div>
            <div class="col-md-6 col-lg-5 offset-lg-1">
              <form id="docSearchForm" role="search" method="get" action="/search/">
                <input type="hidden" name="u" value="/docs/13/" />
                <div class="input-group">
                  <input type="text" id="q" name="q" class="form-control" placeholder="Search the documentation for..."/>
                  <span class="input-group-btn">
                    <button class="btn btn-default" type="submit"><i class="fas fa-search"></i></button>
                  </span>
                </div>
              </form>
            </div>
          </div>

          <div id="docContent">
            <div xmlns="http://www.w3.org/TR/xhtml1/transitional" class="navheader">
  <table width="100%" summary="Navigation header">
    <tr>
      <th colspan="5" align="center">54.2.&nbsp;For the Programmer</th>
    </tr>
    <tr>
      <td width="10%" align="left"><a accesskey="p" href="nls-translator.html" title="54.1.&nbsp;For the Translator">Prev</a>&nbsp;</td>
      <td width="10%" align="left"><a accesskey="u" href="nls.html" title="Chapter&nbsp;54.&nbsp;Native Language Support">Up</a></td>
      <th width="60%" align="center">Chapter&nbsp;54.&nbsp;Native Language Support</th>
      <td width="10%" align="right"><a accesskey="h" href="index.html" title="PostgreSQL 13.20 Documentation">Home</a></td>
      <td width="10%" align="right">&nbsp;<a accesskey="n" href="plhandler.html" title="Chapter&nbsp;55.&nbsp;Writing a Procedural Language Handler">Next</a></td>
    </tr>
  </table>
  <hr />
</div>
<div class="sect1" id="NLS-PROGRAMMER">
  <div class="titlepage">
    <div>
      <div>
        <h2 class="title" style="clear: both">54.2.&nbsp;For the Programmer</h2>
      </div>
    </div>
  </div>
  <div class="toc">
    <dl class="toc">
      <dt><span class="sect2"><a href="nls-programmer.html#NLS-MECHANICS">54.2.1. Mechanics</a></span></dt>
      <dt><span class="sect2"><a href="nls-programmer.html#NLS-GUIDELINES">54.2.2. Message-Writing Guidelines</a></span></dt>
    </dl>
  </div>
  <div class="sect2" id="NLS-MECHANICS">
    <div class="titlepage">
      <div>
        <div>
          <h3 class="title">54.2.1.&nbsp;Mechanics</h3>
        </div>
      </div>
    </div>
    <p>This section describes how to implement native language support in a program or library that is part of the <span class="productname">PostgreSQL</span> distribution. Currently, it only applies to C programs.</p>
    <div class="procedure" id="id-1.10.7.3.2.3">
      <p class="title"><strong>Adding NLS Support to a Program</strong></p>
      <ol class="procedure" type="1">
        <li class="step">
          <p>Insert this code into the start-up sequence of the program:</p>
          <pre class="programlisting">
#ifdef ENABLE_NLS
#include &lt;locale.h&gt;
#endif

...

#ifdef ENABLE_NLS
setlocale(LC_ALL, "");
bindtextdomain("<em class="replaceable"><code>progname</code></em>", LOCALEDIR);
textdomain("<em class="replaceable"><code>progname</code></em>");
#endif
</pre>
          <p>(The <em class="replaceable"><code>progname</code></em> can actually be chosen freely.)</p>
        </li>
        <li class="step">
          <p>Wherever a message that is a candidate for translation is found, a call to <code class="function">gettext()</code> needs to be inserted. E.g.:</p>
          <pre class="programlisting">
fprintf(stderr, "panic level %d\n", lvl);
</pre>
          <p>would be changed to:</p>
          <pre class="programlisting">
fprintf(stderr, gettext("panic level %d\n"), lvl);
</pre>
          <p>(<code class="symbol">gettext</code> is defined as a no-op if NLS support is not configured.)</p>
          <p>This tends to add a lot of clutter. One common shortcut is to use:</p>
          <pre class="programlisting">
#define _(x) gettext(x)
</pre>
          <p>Another solution is feasible if the program does much of its communication through one or a few functions, such as <code class="function">ereport()</code> in the backend. Then you make this function call <code class="function">gettext</code> internally on all input strings.</p>
        </li>
        <li class="step">
          <p>Add a file <code class="filename">nls.mk</code> in the directory with the program sources. This file will be read as a makefile. The following variable assignments need to be made here:</p>
          <div class="variablelist">
            <dl class="variablelist">
              <dt><span class="term"><code class="varname">CATALOG_NAME</code></span></dt>
              <dd>
                <p>The program name, as provided in the <code class="function">textdomain()</code> call.</p>
              </dd>
              <dt><span class="term"><code class="varname">AVAIL_LANGUAGES</code></span></dt>
              <dd>
                <p>List of provided translations — initially empty.</p>
              </dd>
              <dt><span class="term"><code class="varname">GETTEXT_FILES</code></span></dt>
              <dd>
                <p>List of files that contain translatable strings, i.e., those marked with <code class="function">gettext</code> or an alternative solution. Eventually, this will include nearly all source files of the program. If this list gets too long you can make the first <span class="quote">“<span class="quote">file</span>”</span> be a <code class="literal">+</code> and the second word be a file that contains one file name per line.</p>
              </dd>
              <dt><span class="term"><code class="varname">GETTEXT_TRIGGERS</code></span></dt>
              <dd>
                <p>The tools that generate message catalogs for the translators to work on need to know what function calls contain translatable strings. By default, only <code class="function">gettext()</code> calls are known. If you used <code class="function">_</code> or other identifiers you need to list them here. If the translatable string is not the first argument, the item needs to be of the form <code class="literal">func:2</code> (for the second argument). If you have a function that supports pluralized messages, the item should look like <code class="literal">func:1,2</code> (identifying the singular and plural message arguments).</p>
              </dd>
            </dl>
          </div>
        </li>
      </ol>
    </div>
    <p>The build system will automatically take care of building and installing the message catalogs.</p>
  </div>
  <div class="sect2" id="NLS-GUIDELINES">
    <div class="titlepage">
      <div>
        <div>
          <h3 class="title">54.2.2.&nbsp;Message-Writing Guidelines</h3>
        </div>
      </div>
    </div>
    <p>Here are some guidelines for writing messages that are easily translatable.</p>
    <div class="itemizedlist">
      <ul class="itemizedlist" style="list-style-type: disc;">
        <li class="listitem">
          <p>Do not construct sentences at run-time, like:</p>
          <pre class="programlisting">
printf("Files were %s.\n", flag ? "copied" : "removed");
</pre>
          <p>The word order within the sentence might be different in other languages. Also, even if you remember to call <code class="function">gettext()</code> on each fragment, the fragments might not translate well separately. It's better to duplicate a little code so that each message to be translated is a coherent whole. Only numbers, file names, and such-like run-time variables should be inserted at run time into a message text.</p>
        </li>
        <li class="listitem">
          <p>For similar reasons, this won't work:</p>
          <pre class="programlisting">
printf("copied %d file%s", n, n!=1 ? "s" : "");
</pre>
          <p>because it assumes how the plural is formed. If you figured you could solve it like this:</p>
          <pre class="programlisting">
if (n==1)
    printf("copied 1 file");
else
    printf("copied %d files", n):
</pre>
          <p>then be disappointed. Some languages have more than two forms, with some peculiar rules. It's often best to design the message to avoid the issue altogether, for instance like this:</p>
          <pre class="programlisting">
printf("number of copied files: %d", n);
</pre>
          <p>If you really want to construct a properly pluralized message, there is support for this, but it's a bit awkward. When generating a primary or detail error message in <code class="function">ereport()</code>, you can write something like this:</p>
          <pre class="programlisting">
errmsg_plural("copied %d file",
              "copied %d files",
              n,
              n)
</pre>
          <p>The first argument is the format string appropriate for English singular form, the second is the format string appropriate for English plural form, and the third is the integer control value that determines which plural form to use. Subsequent arguments are formatted per the format string as usual. (Normally, the pluralization control value will also be one of the values to be formatted, so it has to be written twice.) In English it only matters whether <em class="replaceable"><code>n</code></em> is 1 or not 1, but in other languages there can be many different plural forms. The translator sees the two English forms as a group and has the opportunity to supply multiple substitute strings, with the appropriate one being selected based on the run-time value of <em class="replaceable"><code>n</code></em>.</p>
          <p>If you need to pluralize a message that isn't going directly to an <code class="function">errmsg</code> or <code class="function">errdetail</code> report, you have to use the underlying function <code class="function">ngettext</code>. See the gettext documentation.</p>
        </li>
        <li class="listitem">
          <p>If you want to communicate something to the translator, such as about how a message is intended to line up with other output, precede the occurrence of the string with a comment that starts with <code class="literal">translator</code>, e.g.:</p>
          <pre class="programlisting">
/* translator: This message is not what it seems to be. */
</pre>
          <p>These comments are copied to the message catalog files so that the translators can see them.</p>
        </li>
      </ul>
    </div>
  </div>
</div>
<div xmlns="http://www.w3.org/TR/xhtml1/transitional" class="navfooter">
  <hr />
  <table width="100%" summary="Navigation footer">
    <tr>
      <td width="40%" align="left"><a accesskey="p" href="nls-translator.html" title="54.1.&nbsp;For the Translator">Prev</a>&nbsp;</td>
      <td width="20%" align="center"><a accesskey="u" href="nls.html" title="Chapter&nbsp;54.&nbsp;Native Language Support">Up</a></td>
      <td width="40%" align="right">&nbsp;<a accesskey="n" href="plhandler.html" title="Chapter&nbsp;55.&nbsp;Writing a Procedural Language Handler">Next</a></td>
    </tr>
    <tr>
      <td width="40%" align="left" valign="top">54.1.&nbsp;For the Translator&nbsp;</td>
      <td width="20%" align="center"><a accesskey="h" href="index.html" title="PostgreSQL 13.20 Documentation">Home</a></td>
      <td width="40%" align="right" valign="top">&nbsp;Chapter&nbsp;55.&nbsp;Writing a Procedural Language Handler</td>
    </tr>
  </table>
</div>

          </div>
          
            <div id="docComments">
              <h2>Submit correction</h2>
              <p>
              If you see anything in the documentation that is not correct, does not match
              your experience with the particular feature or requires further clarification,
              please use
              <a href="/account/comments/new/13/nls-programmer.html/" rel="nofollow">this form</a>
              to report a documentation issue.
              </p>
            </div>
          
        </div> 
      </div>
    </div>
    
    
    
    
    
    
  </body>
</html>
