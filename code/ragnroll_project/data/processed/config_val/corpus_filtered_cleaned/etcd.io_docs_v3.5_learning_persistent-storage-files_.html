<!doctype html><html itemscope itemtype=http://schema.org/WebPage lang=en class=no-js><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>etcd persistent storage files | etcd</title>
<meta name=description content="Reference of the persistent storage format and files"><meta property="og:url" content="https://etcd.io/docs/v3.5/learning/persistent-storage-files/"><meta property="og:site_name" content="etcd"><meta property="og:title" content="etcd persistent storage files"><meta property="og:description" content="Reference of the persistent storage format and files"><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="docs"><meta property="article:modified_time" content="2025-01-03T23:06:06-08:00"><meta itemprop=name content="etcd persistent storage files"><meta itemprop=description content="Reference of the persistent storage format and files"><meta itemprop=dateModified content="2025-01-03T23:06:06-08:00"><meta itemprop=wordCount content="2476"><meta name=twitter:card content="summary"><meta name=twitter:title content="etcd persistent storage files"><meta name=twitter:description content="Reference of the persistent storage format and files"></head><body class=td-page><div class="container-fluid td-outer"><div class=td-main><div class="row flex-xl-nowrap"><main class="col-12 col-md-9 col-xl-8 ps-md-5" role=main><div class=td-content><h1>etcd persistent storage files</h1><div class=lead>Reference of the persistent storage format and files</div><p>This document explains the etcd persistent storage format: naming, content and tools that allow developers to inspect them. Going forward the document should be extended with changes to the storage model. This document is targeted at etcd developers to help with their data recovery needs.</p><h2 id=prerequisites>Prerequisites</h2><p>The following articles provide helpful background information for this document:</p><ul><li>etcd data model overview: <a href=https://etcd.io/docs/v3.5/learning/data_model target=_blank rel=noopener>https://etcd.io/docs/v3.5/learning/data_model</a></li><li>Raft overview: <a href=https://raft.github.io/raft.pdf target=_blank rel=noopener>https://raft.github.io/raft.pdf</a> (especially &ldquo;5.3 Log replication&rdquo; section).</li></ul><h2 id=overview>Overview</h2><h3 id=long-leaving-files>Long leaving files</h3><table><tr><th>File name</th><th>High level purpose</th></tr><tr><td><pre>./member/snap/db</pre></td><td><strong>bbolt <a href=https://en.wikipedia.org/wiki/B%2B_tree>b+tree</a></strong> that stores all the applied data, membership authorization information & metadata. Itâ€™s aware of what's the last applied WAL log index (<a href=https://github.com/etcd-io/etcd/blob/a1ff0d5373335665b3e5f4cb22a538ac63757cb6/server/etcdserver/cindex/cindex.go#L92>"consistent_index"</a>).</td></tr><tr><td><pre>./member/snap/0000000000000002-0000000000049425.snap
./member/snap/0000000000000002-0000000000061ace.snap</pre></td><td><p>Periodic <strong>snapshots of legacy v2 store</strong>, containing:<ul><li>basic membership information</li><li>etcd-version</li></ul></p><p>As of etcd v3, the content is redundant to the content of /snap/db files.</p><p>Periodically (<a href=https://github.com/etcd-io/etcd/blob/a4570a60e771402360755beb7d662bdbca1f87f2/server/etcdserver/server.go#L87>30s</a>) these files <a href=https://github.com/etcd-io/etcd/blob/aa97484166d2b3fb6afeb4390344e68b02afb566/server/etcdserver/server.go#L597>are purged</a>, and the last <code>--max-snapshots=5</code> are preserved.</p></td></tr><tr><td><pre>/member/snap/000000000007a178.snap.db</pre></td><td><p>A complete <strong>bbolt snapshot downloaded</strong> from the etcd leader if the replica was lagging too much.</p><p>Has the same type of content as (<code>./member/snap/db</code>) file.</p><p>The file is used in 2 scenarios:<ul><li>In response to the leader's request to recover from the snapshot.</li></ul></div><div class="td-footer__right col-6 col-sm-4 order-sm-3"><ul class=td-footer__links-list></ul></div><div class="td-footer__center col-12 col-sm-4 py-2 order-sm-2"><span class=td-footer__copyright>&copy;
2013&ndash;2025
<span class=td-footer__authors><p>etcd Authors</p><div class="row text-center text-white small"><div class="col-12 text-center py-2 order-sm-2"><a href=https://www.linuxfoundation.org/terms target=_blank rel=noopener>Terms</a> |
<a href=https://www.linuxfoundation.org/privacy target=_blank rel=noopener>Privacy</a> |
<a href=https://www.linuxfoundation.org/trademark-usage target=_blank rel=noopener>Trademarks</a> |
<a href=https://github.com/etcd-io/website/blob/main/LICENSE target=_blank rel=noopener>License</a></div></div></span></span><span class=td-footer__all_rights_reserved>All Rights Reserved</span></div></div></div></footer></div></body></html>