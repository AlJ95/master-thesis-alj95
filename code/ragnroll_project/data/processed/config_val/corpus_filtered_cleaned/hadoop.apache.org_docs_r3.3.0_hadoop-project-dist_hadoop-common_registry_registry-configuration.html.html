<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <title>Apache Hadoop 3.3.0 &#x2013; Registry Configuration</title>
    
    
        <meta name="Date-Revision-yyyymmdd" content="20200706" />
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
                </head>
  <body class="composite">
    <div id="banner">
                        <a href="http://hadoop.apache.org/" id="bannerLeft">
                                        
                </a>
                              <a href="http://www.apache.org/" id="bannerRight">
                                        
                </a>
            <div class="clear">
        <hr/>
      </div>
    </div>
    <div id="breadcrumbs">
            
                                   <div class="xleft">
                          <a href="http://www.apache.org/" class="externalLink">Apache</a>
        &gt;
                  <a href="http://hadoop.apache.org/" class="externalLink">Hadoop</a>
        &gt;
                  <a href="../../index.html">Apache Hadoop Project Dist POM</a>
        &gt;
                  <a href="../index.html">Apache Hadoop 3.3.0</a>
        &gt;
        Registry Configuration
        </div>
            <div class="xright">            <a href="http://wiki.apache.org/hadoop" class="externalLink">Wiki</a>
            |
                <a href="https://gitbox.apache.org/repos/asf/hadoop.git" class="externalLink">git</a>
            |
                <a href="http://hadoop.apache.org/" class="externalLink">Apache Hadoop</a>
              
                                   &nbsp;| Last Published: 2020-07-06
              &nbsp;| Version: 3.3.0
            </div>
      <div class="clear">
        <hr/>
      </div>
    </div>
    <div id="leftColumn">
      <div id="navcolumn">
             
                                                   <h5>General</h5>
                  <ul>
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
          </ul>
                       <h5>Common</h5>
                  <ul>
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
          </ul>
                       <h5>HDFS</h5>
                  <ul>
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
          </ul>
                       <h5>MapReduce</h5>
                  <ul>
                  
                  
                  
                  
                  
                  
                  
          </ul>
                       <h5>MapReduce REST APIs</h5>
                  <ul>
                  
                  
          </ul>
                       <h5>YARN</h5>
                  <ul>
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
          </ul>
                       <h5>YARN REST APIs</h5>
                  <ul>
                  
                  
                  
                  
                  
          </ul>
                       <h5>YARN Service</h5>
                  <ul>
                  
                  
                  
                  
                  
                  
          </ul>
                       <h5>Hadoop Compatible File Systems</h5>
                  <ul>
                  
                  
                  
                  
                  
                  
          </ul>
                       <h5>Auth</h5>
                  <ul>
                  
                  
                  
                  
          </ul>
                       <h5>Tools</h5>
                  <ul>
                  
                  
                  
                  
                  
                  
                  
                  
                  
                  
          </ul>
                       <h5>Reference</h5>
                  <ul>
                  
                  
                  
                  
          </ul>
                       <h5>Configuration</h5>
                  <ul>
                  
                  
                  
                  
                  
                  
          </ul>
                                 <a href="http://maven.apache.org/" title="Built by Maven" class="poweredBy">
          
        </a>
                       
                               </div>
    </div>
    <div id="bodyColumn">
      <div id="contentBox">
        
<h1>Registry Configuration</h1>
<p>The Hadoop service registry is built on top of Apache Zookeeper. It is configured by way of a Hadoop <tt>Configuration</tt> class: the instance used to create the service controls the behavior of the client.</p>
<p>This document lists the configuration parameters which control the registry client.</p>
<p>The default values of all these settings are defined in <tt>core-default.xml</tt>. The values in this file may not match those listed in this document. If this is the case, the values in <tt>core-default.xml</tt> MUST be considered normative.</p>
<div class="section">
<h2><a name="Changing_the_configuration_values"></a>Changing the configuration values</h2>
<p>Changes to the configuration values SHOULD be done in <tt>core-site.xml</tt>. This will ensure that client and non-YARN applications will pick up the values, so enabling them to read from and potentially write to the registry.</p></div>
<div class="section">
<h2><a name="Core_Settings"></a>Core Settings</h2>
<div class="section">
<h3><a name="Setting_the_Zookeeper_Quorum:_hadoop.registry.zk.quorum"></a>Setting the Zookeeper Quorum: <tt>hadoop.registry.zk.quorum</tt></h3>
<p>This is an essential setting: it identifies the lists of zookeeper hosts and the ports on which the ZK services are listening.</p>

<div>
<div>
<pre class="source">  &lt;property&gt;
    &lt;description&gt;
      A comma separated list of hostname:port pairs defining the
      zookeeper quorum binding for the registry
    &lt;/description&gt;
    &lt;name&gt;hadoop.registry.zk.quorum&lt;/name&gt;
    &lt;value&gt;localhost:2181&lt;/value&gt;
  &lt;/property&gt;
</pre></div></div>

<p>It takes a comma-separated list, such as <tt>zk1:2181 ,zk2:2181, zk3:2181</tt></p></div>
<div class="section">
<h3><a name="Setting_the_Zookeeper_Registry_Base_path:_hadoop.registry.zk.root"></a>Setting the Zookeeper Registry Base path: <tt>hadoop.registry.zk.root</tt></h3>
<p>This path sets the base zookeeper node for the registry</p>

<div>
<div>
<pre class="source">  &lt;property&gt;
    &lt;description&gt;
      The root zookeeper node for the registry
    &lt;/description&gt;
    &lt;name&gt;hadoop.registry.zk.root&lt;/name&gt;
    &lt;value&gt;/registry&lt;/value&gt;
  &lt;/property&gt;
</pre></div></div>

<p>The default value of <tt>/registry</tt> is normally sufficient. A different value may be needed for security reasons or because the <tt>/registry</tt> path is in use.</p>
<p>The root value is prepended to all registry paths so as to create the absolute path. For example:</p>
<ul>

<li><tt>/</tt> maps to <tt>/registry</tt></li>
<li><tt>/services</tt> maps to <tt>/registry/services</tt></li>
<li><tt>/users/yarn</tt> maps to <tt>/registry/users/yarn</tt></li>
</ul>
<p>A different value of <tt>hadoop.registry.zk.root</tt> would result in a different mapping to absolute zookeeper paths.</p></div></div>
<div class="section">
<h2><a name="Security_Options"></a>Security Options</h2>
<p>Registry security is enabled when the property <tt>hadoop.registry.secure</tt> is set to <tt>true</tt>. Once set, nodes are created with permissions, so that only a specific user <i>and the configured cluster &#x201c;superuser&#x201d; accounts</i> can write under their home path of <tt>${hadoop.registry.zk.root}/users</tt>. Only the superuser accounts will be able to manipulate the root path, including <tt>${hadoop.registry.zk.root}/services</tt> and <tt>${hadoop.registry.zk.root}/users</tt>.</p>
<p>All write operations on the registry (including deleting entries and paths) must be authenticated. Read operations are still permitted by unauthenticated callers.</p>
<p>The key settings for secure registry support are:</p>
<ul>

<li>enabling the secure mode:  <tt>hadoop.registry.secure</tt></li>
<li>listing the superuser zookeeper ACLs:  <tt>hadoop.registry.system.acls</tt></li>
<li>listing the kerberos realm for the principals: <tt>hadoop.registry.kerberos.realm</tt></li>
<li>identifying the JAAS context within the JAAS configuration which defines the user: <tt>hadoop.registry.jaas.context</tt></li>
</ul>
<div class="section">
<h3><a name="Enabling_security"></a>Enabling security</h3>

<div>
<div>
<pre class="source">  &lt;property&gt;
    &lt;description&gt;
      Key to set if the registry is secure. Turning it on
      changes the permissions policy from &quot;open access&quot;
      to restrictions on kerberos with the option of
      a user adding one or more auth key pairs down their
      own tree.
    &lt;/description&gt;
    &lt;name&gt;hadoop.registry.secure&lt;/name&gt;
    &lt;value&gt;false&lt;/value&gt;
  &lt;/property&gt;
</pre></div></div>
</div>
<div class="section">
<h3><a name="Identifying_the_client_JAAS_context"></a>Identifying the client JAAS context</h3>
<p>The registry clients must identify the JAAS context which they use to authenticate to the registry.</p>

<div>
<div>
<pre class="source">  &lt;property&gt;
    &lt;description&gt;
      Key to define the JAAS context. Used in secure mode
    &lt;/description&gt;
    &lt;name&gt;hadoop.registry.jaas.context&lt;/name&gt;
    &lt;value&gt;Client&lt;/value&gt;
  &lt;/property&gt;
</pre></div></div>

<p><i>Note</i> as the Resource Manager is simply another client of the registry, it too must have this context defined.</p></div>
<div class="section">
<h3><a name="Identifying_the_system_accounts_hadoop.registry.system.acls"></a>Identifying the system accounts <tt>hadoop.registry.system.acls</tt></h3>
<p>These are the the accounts which are given full access to the base of the registry. The Resource Manager needs this option to create the root paths.</p>
<p>Client applications writing to the registry access to the nodes it creates.</p>
<ol style="list-style-type: decimal">

<li>The property <tt>hadoop.registry.system.acls</tt> takes a comma-separated list of zookeeper <tt>ACLs</tt> which are given full access to created nodes; the permissions <tt>READ | WRITE | CREATE | DELETE | ADMIN</tt>.</li>
<li>Any zookeeper ACL scheme may be added to this, such as the <tt>digest:</tt> scheme.</li>
<li>The SASL scheme, <tt>sasl:</tt>, is used to identify which callers identified by sasl have full access. These are the superuser accounts.</li>
<li>They may be identified by elements such as <tt>sasl:yarn@REALM.COM</tt>.</li>
<li>To aid portability of SASL settings, especially the default value, any <tt>sasl:</tt> entry without the realm value &#x2014;that is, any entry that terminates in the <tt>@</tt> symbol&#x2014; has the current realm appended to it.</li>
<li>This realm is set to that of the current user.</li>
<li>It may be overridden by the property <tt>hadoop.registry.kerberos.realm</tt>.</li>
</ol>

<div>
<div>
<pre class="source">  &lt;property&gt;
    &lt;description&gt;
      A comma separated list of Zookeeper ACL identifiers with
      system access to the registry in a secure cluster.
      These are given full access to all entries.
      If there is an &quot;@&quot; at the end of a SASL entry it
      instructs the registry client to append the default kerberos domain.
    &lt;/description&gt;
    &lt;name&gt;hadoop.registry.system.acls&lt;/name&gt;
    &lt;value&gt;sasl:yarn@, sasl:mapred@, sasl:mapred@, sasl:hdfs@&lt;/value&gt;
  &lt;/property&gt;

  &lt;property&gt;
    &lt;description&gt;
      The kerberos realm: used to set the realm of
      system principals which do not declare their realm,
      and any other accounts that need the value.
      If empty, the default realm of the running process
      is used.
      If neither are known and the realm is needed, then the registry
      service/client will fail.
    &lt;/description&gt;
    &lt;name&gt;hadoop.registry.kerberos.realm&lt;/name&gt;
    &lt;value&gt;&lt;/value&gt;
  &lt;/property&gt;
</pre></div></div>

<p>Example: an <tt>hadoop.registry.system.acls</tt> entry of <tt>sasl:yarn@, sasl:admin@EXAMPLE.COM, sasl:system@REALM2</tt>, would, in a YARN cluster with the realm <tt>EXAMPLE.COM</tt>, add the following admin accounts to every node</p>
<ul>

<li><tt>sasl:yarn@EXAMPLE.COM</tt></li>
<li><tt>sasl:admin@EXAMPLE.COM</tt></li>
<li><tt>sasl:system@REALM2</tt></li>
</ul>
<p>The identity of a client application creating registry entries will be automatically included in the permissions of all entries created. If, for example, the account creating an entry was <tt>hbase</tt>, another entry would be created</p>
<ul>

<li><tt>sasl:hbase@EXAMPLE.COM</tt></li>
</ul>
<p><b>Important</b>: when setting the system ACLS, <i>it is critical to include the identity of the YARN Resource Manager</i>.</p>
<p>The RM needs to be able to create the root and user paths, and delete service records during application and container cleanup.</p></div></div>
<div class="section">
<h2><a name="Zookeeper_connection_management_options"></a>Zookeeper connection management options</h2>
<p>Some low level options manage the ZK connection &#x2014;more specifically, its failure handling.</p>
<p>The Zookeeper registry clients use Apache Curator to connect to Zookeeper, a library which detects timeouts and attempts to reconnect to one of the servers which forms the zookeeper quorum. It is only after a timeout is detected that a retry is triggered.</p>

<div>
<div>
<pre class="source">  &lt;property&gt;
    &lt;description&gt;
      Zookeeper session timeout in milliseconds
    &lt;/description&gt;
    &lt;name&gt;hadoop.registry.zk.session.timeout.ms&lt;/name&gt;
    &lt;value&gt;60000&lt;/value&gt;
  &lt;/property&gt;

  &lt;property&gt;
    &lt;description&gt;
      Zookeeper connection timeout in milliseconds
    &lt;/description&gt;
    &lt;name&gt;hadoop.registry.zk.connection.timeout.ms&lt;/name&gt;
    &lt;value&gt;15000&lt;/value&gt;
  &lt;/property&gt;

  &lt;property&gt;
    &lt;description&gt;
      Zookeeper connection retry count before failing
    &lt;/description&gt;
    &lt;name&gt;hadoop.registry.zk.retry.times&lt;/name&gt;
    &lt;value&gt;5&lt;/value&gt;
  &lt;/property&gt;

  &lt;property&gt;
    &lt;description&gt;
    &lt;/description&gt;
    &lt;name&gt;hadoop.registry.zk.retry.interval.ms&lt;/name&gt;
    &lt;value&gt;1000&lt;/value&gt;
  &lt;/property&gt;

  &lt;property&gt;
    &lt;description&gt;
      Zookeeper retry limit in milliseconds, during
      exponential backoff.
      This places a limit even
      if the retry times and interval limit, combined
      with the backoff policy, result in a long retry
      period
    &lt;/description&gt;
    &lt;name&gt;hadoop.registry.zk.retry.ceiling.ms&lt;/name&gt;
    &lt;value&gt;60000&lt;/value&gt;
  &lt;/property&gt;
</pre></div></div>

<p>The retry strategy used in the registry client is <a class="externalLink" href="https://curator.apache.org/apidocs/org/apache/curator/retry/BoundedExponentialBackoffRetry.html"><tt>BoundedExponentialBackoffRetry</tt></a>: This backs off exponentially on connection failures before eventually concluding that the quorum is unreachable and failing.</p></div>
<div class="section">
<h2><a name="Complete_Set_of_Configuration_Options"></a>Complete Set of Configuration Options</h2>

<div>
<div>
<pre class="source">  &lt;!-- YARN registry --&gt;

  &lt;property&gt;
    &lt;description&gt;
      A comma separated list of hostname:port pairs defining the
      zookeeper quorum binding for the registry
    &lt;/description&gt;
    &lt;name&gt;hadoop.registry.zk.quorum&lt;/name&gt;
    &lt;value&gt;localhost:2181&lt;/value&gt;
  &lt;/property&gt;

  &lt;property&gt;
    &lt;description&gt;
      The root zookeeper node for the registry
    &lt;/description&gt;
    &lt;name&gt;hadoop.registry.zk.root&lt;/name&gt;
    &lt;value&gt;/registry&lt;/value&gt;
  &lt;/property&gt;

  &lt;property&gt;
    &lt;description&gt;
      Key to set if the registry is secure. Turning it on
      changes the permissions policy from &quot;open access&quot;
      to restrictions on kerberos with the option of
      a user adding one or more auth key pairs down their
      own tree.
    &lt;/description&gt;
    &lt;name&gt;hadoop.registry.secure&lt;/name&gt;
    &lt;value&gt;false&lt;/value&gt;
  &lt;/property&gt;

  &lt;property&gt;
    &lt;description&gt;
      A comma separated list of Zookeeper ACL identifiers with
      system access to the registry in a secure cluster.

      These are given full access to all entries.

      If there is an &quot;@&quot; at the end of a SASL entry it
      instructs the registry client to append the default kerberos domain.
    &lt;/description&gt;
    &lt;name&gt;hadoop.registry.system.acls&lt;/name&gt;
    &lt;value&gt;sasl:yarn@, sasl:mapred@, sasl:mapred@, sasl:hdfs@&lt;/value&gt;
  &lt;/property&gt;

  &lt;property&gt;
    &lt;description&gt;
      The kerberos realm: used to set the realm of
      system principals which do not declare their realm,
      and any other accounts that need the value.

      If empty, the default realm of the running process
      is used.

      If neither are known and the realm is needed, then the registry
      service/client will fail.
    &lt;/description&gt;
    &lt;name&gt;hadoop.registry.kerberos.realm&lt;/name&gt;
    &lt;value&gt;&lt;/value&gt;
  &lt;/property&gt;

  &lt;property&gt;
    &lt;description&gt;
      Key to define the JAAS context. Used in secure
      mode
    &lt;/description&gt;
    &lt;name&gt;hadoop.registry.jaas.context&lt;/name&gt;
    &lt;value&gt;Client&lt;/value&gt;
  &lt;/property&gt;


  &lt;property&gt;
    &lt;description&gt;
      Zookeeper session timeout in milliseconds
    &lt;/description&gt;
    &lt;name&gt;hadoop.registry.zk.session.timeout.ms&lt;/name&gt;
    &lt;value&gt;60000&lt;/value&gt;
  &lt;/property&gt;

  &lt;property&gt;
    &lt;description&gt;
      Zookeeper session timeout in milliseconds
    &lt;/description&gt;
    &lt;name&gt;hadoop.registry.zk.connection.timeout.ms&lt;/name&gt;
    &lt;value&gt;15000&lt;/value&gt;
  &lt;/property&gt;

  &lt;property&gt;
    &lt;description&gt;
      Zookeeper connection retry count before failing
    &lt;/description&gt;
    &lt;name&gt;hadoop.registry.zk.retry.times&lt;/name&gt;
    &lt;value&gt;5&lt;/value&gt;
  &lt;/property&gt;

  &lt;property&gt;
    &lt;description&gt;
    &lt;/description&gt;
    &lt;name&gt;hadoop.registry.zk.retry.interval.ms&lt;/name&gt;
    &lt;value&gt;1000&lt;/value&gt;
  &lt;/property&gt;

  &lt;property&gt;
    &lt;description&gt;
      Zookeeper retry limit in milliseconds, during
      exponential backoff: {@value}

      This places a limit even
      if the retry times and interval limit, combined
      with the backoff policy, result in a long retry
      period
    &lt;/description&gt;
    &lt;name&gt;hadoop.registry.zk.retry.ceiling.ms&lt;/name&gt;
    &lt;value&gt;60000&lt;/value&gt;
  &lt;/property&gt;
</pre></div></div></div>
      </div>
    </div>
    <div class="clear">
      <hr/>
    </div>
    <div id="footer">
      <div class="xright">
        &#169;            2008-2020
              Apache Software Foundation
            
                          - <a href="http://maven.apache.org/privacy-policy.html">Privacy Policy</a>.
        Apache Maven, Maven, Apache, the Apache feather logo, and the Apache Maven project logos are trademarks of The Apache Software Foundation.
      </div>
      <div class="clear">
        <hr/>
      </div>
    </div>
  </body>
</html>
