<!doctype html>
<html lang="en">
 <head>
  <title>PostgreSQL: Documentation: 13: 35.2. Managing Database Connections</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta http-equiv="Content-Type" content="text/xhtml; charset=utf-8" />
   
  <meta name="theme-color" content="#336791"/>
  <meta name="copyright" content="The PostgreSQL Global Development Group" />
  <meta property="og:url" content="https://www.postgresql.org/docs/13/ecpg-connect.html" />
  <meta property="og:type" content="article" />
  <meta property="article:published_time" content="2025-02-20T14:13:26" />
  <meta property="og:image" content="https://www.postgresql.org/media/img/about/press/elephant.png" />
  <meta property="og:title" content="35.2. Managing Database Connections" />
  <meta property="og:description" content="35.2.&amp;nbsp;Managing Database Connections 35.2.1. Connecting to the Database Server 35.2.2. Choosing a Connection 35.2.3. Closing a Connection This section describes …" />
  <meta property="og:site_name" content="PostgreSQL Documentation" />


  

  
  
  
  
  

  

  
  </head>
  <body>
    <div class="container-fluid">
      <div class="row justify-content-md-center">
        <div class="col">
          
          
        </div>
      </div>
      <div class="row justify-content-center pg-shout-box">
        <div class="col text-white text-center">February 20, 2025: <a href="/about/news/postgresql-174-168-1512-1417-and-1320-released-3018/">
  PostgreSQL 17.4, 16.8, 15.12, 14.17, and 13.20 Released!
</a>

</div>
      </div>
    </div>
    <div class="container-fluid margin">
      <div class="row">
        <div id="pgContentWrap" class="col-11">
          <div class="row">
            <div class="col-md-6 mb-2">
              <div class="row">
                <div class="col">
                  <div>
                    <a href="/docs/" title="Documentation">Documentation</a> &rarr; <a href="/docs/13/index.html">PostgreSQL 13</a>
                  </div>
                </div>
              </div>
              
                <div class="row">
                  <div class="col">
                    Supported Versions:
                      
                        
                        
                          <a href="/docs/current/ecpg-connect.html" title="PostgreSQL 17 - 35.2. Managing Database Connections" >Current</a>
                          (<a href="/docs/17/ecpg-connect.html" title="PostgreSQL 17 - 35.2. Managing Database Connections" >17</a>)
                        
                      
                         / 
                        
                          <a href="/docs/16/ecpg-connect.html" title="PostgreSQL 16 - 35.2. Managing Database Connections" >16</a>
                        
                      
                         / 
                        
                          <a href="/docs/15/ecpg-connect.html" title="PostgreSQL 15 - 35.2. Managing Database Connections" >15</a>
                        
                      
                         / 
                        
                          <a href="/docs/14/ecpg-connect.html" title="PostgreSQL 14 - 35.2. Managing Database Connections" >14</a>
                        
                      
                         / 
                        
                          <a href="/docs/13/ecpg-connect.html" title="PostgreSQL 13 - 35.2. Managing Database Connections" class="docs-version-selected">13</a>
                        
                      
                  </div>
                </div>
              
              
                <div class="row">
                  <div class="col">
                    Development Versions:
                    
                      
                      <a href="/docs/devel/ecpg-connect.html" title="PostgreSQL devel - 35.2. Managing Database Connections"  rel="nofollow">devel</a>
                    
                  </div>
                </div>
              
              
                <div class="row">
                  <div class="col-12">
                    Unsupported versions:
                    
                      
                      <a href="/docs/12/ecpg-connect.html" title="PostgreSQL 12 - 35.2. Managing Database Connections"  rel="nofollow">12</a>
                    
                       / 
                      <a href="/docs/11/ecpg-connect.html" title="PostgreSQL 11 - 35.2. Managing Database Connections"  rel="nofollow">11</a>
                    
                       / 
                      <a href="/docs/10/ecpg-connect.html" title="PostgreSQL 10 - 35.2. Managing Database Connections"  rel="nofollow">10</a>
                    
                       / 
                      <a href="/docs/9.6/ecpg-connect.html" title="PostgreSQL 9.6 - 35.2. Managing Database Connections"  rel="nofollow">9.6</a>
                    
                       / 
                      <a href="/docs/9.5/ecpg-connect.html" title="PostgreSQL 9.5 - 35.2. Managing Database Connections"  rel="nofollow">9.5</a>
                    
                       / 
                      <a href="/docs/9.4/ecpg-connect.html" title="PostgreSQL 9.4 - 35.2. Managing Database Connections"  rel="nofollow">9.4</a>
                    
                       / 
                      <a href="/docs/9.3/ecpg-connect.html" title="PostgreSQL 9.3 - 35.2. Managing Database Connections"  rel="nofollow">9.3</a>
                    
                       / 
                      <a href="/docs/9.2/ecpg-connect.html" title="PostgreSQL 9.2 - 35.2. Managing Database Connections"  rel="nofollow">9.2</a>
                    
                       / 
                      <a href="/docs/9.1/ecpg-connect.html" title="PostgreSQL 9.1 - 35.2. Managing Database Connections"  rel="nofollow">9.1</a>
                    
                       / 
                      <a href="/docs/9.0/ecpg-connect.html" title="PostgreSQL 9.0 - 35.2. Managing Database Connections"  rel="nofollow">9.0</a>
                    
                       / 
                      <a href="/docs/8.4/ecpg-connect.html" title="PostgreSQL 8.4 - 35.2. Managing Database Connections"  rel="nofollow">8.4</a>
                    
                       / 
                      <a href="/docs/8.3/ecpg-connect.html" title="PostgreSQL 8.3 - 35.2. Managing Database Connections"  rel="nofollow">8.3</a>
                    
                       / 
                      <a href="/docs/8.2/ecpg-connect.html" title="PostgreSQL 8.2 - 35.2. Managing Database Connections"  rel="nofollow">8.2</a>
                    
                       / 
                      <a href="/docs/8.1/ecpg-connect.html" title="PostgreSQL 8.1 - 35.2. Managing Database Connections"  rel="nofollow">8.1</a>
                    
                       / 
                      <a href="/docs/8.0/ecpg-connect.html" title="PostgreSQL 8.0 - 35.2. Managing Database Connections"  rel="nofollow">8.0</a>
                    
                       / 
                      <a href="/docs/7.4/ecpg-connect.html" title="PostgreSQL 7.4 - 35.2. Managing Database Connections"  rel="nofollow">7.4</a>
                    
                       / 
                      <a href="/docs/7.3/ecpg-connect.html" title="PostgreSQL 7.3 - 35.2. Managing Database Connections"  rel="nofollow">7.3</a>
                    
                  </div>
                </div>
              
            </div>
            <div class="col-md-6 col-lg-5 offset-lg-1">
              <form id="docSearchForm" role="search" method="get" action="/search/">
                <input type="hidden" name="u" value="/docs/13/" />
                <div class="input-group">
                  <input type="text" id="q" name="q" class="form-control" placeholder="Search the documentation for..."/>
                  <span class="input-group-btn">
                    <button class="btn btn-default" type="submit"><i class="fas fa-search"></i></button>
                  </span>
                </div>
              </form>
            </div>
          </div>

          <div id="docContent">
            <div xmlns="http://www.w3.org/TR/xhtml1/transitional" class="navheader">
  <table width="100%" summary="Navigation header">
    <tr>
      <th colspan="5" align="center">35.2.&nbsp;Managing Database Connections</th>
    </tr>
    <tr>
      <td width="10%" align="left"><a accesskey="p" href="ecpg-concept.html" title="35.1.&nbsp;The Concept">Prev</a>&nbsp;</td>
      <td width="10%" align="left"><a accesskey="u" href="ecpg.html" title="Chapter&nbsp;35.&nbsp;ECPG — Embedded SQL in C">Up</a></td>
      <th width="60%" align="center">Chapter&nbsp;35.&nbsp;<span xmlns="http://www.w3.org/1999/xhtml" class="application">ECPG</span> — Embedded <acronym xmlns="http://www.w3.org/1999/xhtml" class="acronym">SQL</acronym> in C</th>
      <td width="10%" align="right"><a accesskey="h" href="index.html" title="PostgreSQL 13.20 Documentation">Home</a></td>
      <td width="10%" align="right">&nbsp;<a accesskey="n" href="ecpg-commands.html" title="35.3.&nbsp;Running SQL Commands">Next</a></td>
    </tr>
  </table>
  <hr />
</div>
<div class="sect1" id="ECPG-CONNECT">
  <div class="titlepage">
    <div>
      <div>
        <h2 class="title" style="clear: both">35.2.&nbsp;Managing Database Connections</h2>
      </div>
    </div>
  </div>
  <div class="toc">
    <dl class="toc">
      <dt><span class="sect2"><a href="ecpg-connect.html#ECPG-CONNECTING">35.2.1. Connecting to the Database Server</a></span></dt>
      <dt><span class="sect2"><a href="ecpg-connect.html#ECPG-SET-CONNECTION">35.2.2. Choosing a Connection</a></span></dt>
      <dt><span class="sect2"><a href="ecpg-connect.html#ECPG-DISCONNECT">35.2.3. Closing a Connection</a></span></dt>
    </dl>
  </div>
  <p>This section describes how to open, close, and switch database connections.</p>
  <div class="sect2" id="ECPG-CONNECTING">
    <div class="titlepage">
      <div>
        <div>
          <h3 class="title">35.2.1.&nbsp;Connecting to the Database Server</h3>
        </div>
      </div>
    </div>
    <p>One connects to a database using the following statement:</p>
    <pre class="programlisting">
EXEC SQL CONNECT TO <em class="replaceable"><code>target</code></em> [<span class="optional">AS <em class="replaceable"><code>connection-name</code></em></span>] [<span class="optional">USER <em class="replaceable"><code>user-name</code></em></span>];
</pre>
    <p>The <em class="replaceable"><code>target</code></em> can be specified in the following ways:</p>
    <div class="itemizedlist">
      <ul class="itemizedlist" style="list-style-type: disc;">
        <li class="listitem"><code class="literal"><em class="replaceable"><code>dbname</code></em>[<span class="optional">@<em class="replaceable"><code>hostname</code></em></span>][<span class="optional">:<em class="replaceable"><code>port</code></em></span>]</code></li>
        <li class="listitem"><code class="literal">tcp:postgresql://<em class="replaceable"><code>hostname</code></em>[<span class="optional">:<em class="replaceable"><code>port</code></em></span>][<span class="optional">/<em class="replaceable"><code>dbname</code></em></span>][<span class="optional">?<em class="replaceable"><code>options</code></em></span>]</code></li>
        <li class="listitem"><code class="literal">unix:postgresql://<em class="replaceable"><code>hostname</code></em>[<span class="optional">:<em class="replaceable"><code>port</code></em></span>][<span class="optional">/<em class="replaceable"><code>dbname</code></em></span>][<span class="optional">?<em class="replaceable"><code>options</code></em></span>]</code></li>
        <li class="listitem">an SQL string literal containing one of the above forms</li>
        <li class="listitem">a reference to a character variable containing one of the above forms (see examples)</li>
        <li class="listitem"><code class="literal">DEFAULT</code></li>
      </ul>
    </div>
    <p>If you specify the connection target literally (that is, not through a variable reference) and you don't quote the value, then the case-insensitivity rules of normal SQL are applied. In that case you can also double-quote the individual parameters separately as needed. In practice, it is probably less error-prone to use a (single-quoted) string literal or a variable reference. The connection target <code class="literal">DEFAULT</code> initiates a connection to the default database under the default user name. No separate user name or connection name can be specified in that case.</p>
    <p>There are also different ways to specify the user name:</p>
    <div class="itemizedlist">
      <ul class="itemizedlist" style="list-style-type: disc;">
        <li class="listitem"><code class="literal"><em class="replaceable"><code>username</code></em></code></li>
        <li class="listitem"><code class="literal"><em class="replaceable"><code>username</code></em>/<em class="replaceable"><code>password</code></em></code></li>
        <li class="listitem"><code class="literal"><em class="replaceable"><code>username</code></em> IDENTIFIED BY <em class="replaceable"><code>password</code></em></code></li>
        <li class="listitem"><code class="literal"><em class="replaceable"><code>username</code></em> USING <em class="replaceable"><code>password</code></em></code></li>
      </ul>
    </div>
    <p>As above, the parameters <em class="replaceable"><code>username</code></em> and <em class="replaceable"><code>password</code></em> can be an SQL identifier, an SQL string literal, or a reference to a character variable.</p>
    <p>If the connection target includes any <em class="replaceable"><code>options</code></em>, those consist of <code class="literal"><em class="replaceable"><code>keyword</code></em>=<em class="replaceable"><code>value</code></em></code> specifications separated by ampersands (<code class="literal">&amp;</code>). The allowed key words are the same ones recognized by <span class="application">libpq</span> (see <a class="xref" href="libpq-connect.html#LIBPQ-PARAMKEYWORDS" title="33.1.2.&nbsp;Parameter Key Words">Section&nbsp;33.1.2</a>). Spaces are ignored before any <em class="replaceable"><code>keyword</code></em> or <em class="replaceable"><code>value</code></em>, though not within or after one. Note that there is no way to write <code class="literal">&amp;</code> within a <em class="replaceable"><code>value</code></em>.</p>
    <p>The <em class="replaceable"><code>connection-name</code></em> is used to handle multiple connections in one program. It can be omitted if a program uses only one connection. The most recently opened connection becomes the current connection, which is used by default when an SQL statement is to be executed (see later in this chapter).</p>
    <p>If untrusted users have access to a database that has not adopted a <a class="link" href="ddl-schemas.html#DDL-SCHEMAS-PATTERNS" title="5.9.6.&nbsp;Usage Patterns">secure schema usage pattern</a>, begin each session by removing publicly-writable schemas from <code class="varname">search_path</code>. For example, add <code class="literal">options=-c search_path=</code> to <code class="literal"><em class="replaceable"><code>options</code></em></code>, or issue <code class="literal">EXEC SQL SELECT pg_catalog.set_config('search_path', '', false);</code> after connecting. This consideration is not specific to ECPG; it applies to every interface for executing arbitrary SQL commands.</p>
    <p>Here are some examples of <code class="command">CONNECT</code> statements:</p>
    <pre class="programlisting">
EXEC SQL CONNECT TO mydb@sql.mydomain.com;

EXEC SQL CONNECT TO unix:postgresql://sql.mydomain.com/mydb AS myconnection USER john;

EXEC SQL BEGIN DECLARE SECTION;
const char *target = "mydb@sql.mydomain.com";
const char *user = "john";
const char *passwd = "secret";
EXEC SQL END DECLARE SECTION;
 ...
EXEC SQL CONNECT TO :target USER :user USING :passwd;
/* or EXEC SQL CONNECT TO :target USER :user/:passwd; */
</pre>
    <p>The last form makes use of the variant referred to above as character variable reference. You will see in later sections how C variables can be used in SQL statements when you prefix them with a colon.</p>
    <p>Be advised that the format of the connection target is not specified in the SQL standard. So if you want to develop portable applications, you might want to use something based on the last example above to encapsulate the connection target string somewhere.</p>
  </div>
  <div class="sect2" id="ECPG-SET-CONNECTION">
    <div class="titlepage">
      <div>
        <div>
          <h3 class="title">35.2.2.&nbsp;Choosing a Connection</h3>
        </div>
      </div>
    </div>
    <p>SQL statements in embedded SQL programs are by default executed on the current connection, that is, the most recently opened one. If an application needs to manage multiple connections, then there are two ways to handle this.</p>
    <p>The first option is to explicitly choose a connection for each SQL statement, for example:</p>
    <pre class="programlisting">
EXEC SQL AT <em class="replaceable"><code>connection-name</code></em> SELECT ...;
</pre>
    <p>This option is particularly suitable if the application needs to use several connections in mixed order.</p>
    <p>If your application uses multiple threads of execution, they cannot share a connection concurrently. You must either explicitly control access to the connection (using mutexes) or use a connection for each thread.</p>
    <p>The second option is to execute a statement to switch the current connection. That statement is:</p>
    <pre class="programlisting">
EXEC SQL SET CONNECTION <em class="replaceable"><code>connection-name</code></em>;
</pre>
    <p>This option is particularly convenient if many statements are to be executed on the same connection.</p>
    <p>Here is an example program managing multiple database connections:</p>
    <pre class="programlisting">
#include &lt;stdio.h&gt;

EXEC SQL BEGIN DECLARE SECTION;
    char dbname[1024];
EXEC SQL END DECLARE SECTION;

int
main()
{
    EXEC SQL CONNECT TO testdb1 AS con1 USER testuser;
    EXEC SQL SELECT pg_catalog.set_config('search_path', '', false); EXEC SQL COMMIT;
    EXEC SQL CONNECT TO testdb2 AS con2 USER testuser;
    EXEC SQL SELECT pg_catalog.set_config('search_path', '', false); EXEC SQL COMMIT;
    EXEC SQL CONNECT TO testdb3 AS con3 USER testuser;
    EXEC SQL SELECT pg_catalog.set_config('search_path', '', false); EXEC SQL COMMIT;

    /* This query would be executed in the last opened database "testdb3". */
    EXEC SQL SELECT current_database() INTO :dbname;
    printf("current=%s (should be testdb3)\n", dbname);

    /* Using "AT" to run a query in "testdb2" */
    EXEC SQL AT con2 SELECT current_database() INTO :dbname;
    printf("current=%s (should be testdb2)\n", dbname);

    /* Switch the current connection to "testdb1". */
    EXEC SQL SET CONNECTION con1;

    EXEC SQL SELECT current_database() INTO :dbname;
    printf("current=%s (should be testdb1)\n", dbname);

    EXEC SQL DISCONNECT ALL;
    return 0;
}
</pre>
    <p>This example would produce this output:</p>
    <pre class="screen">
current=testdb3 (should be testdb3)
current=testdb2 (should be testdb2)
current=testdb1 (should be testdb1)
</pre>
  </div>
  <div class="sect2" id="ECPG-DISCONNECT">
    <div class="titlepage">
      <div>
        <div>
          <h3 class="title">35.2.3.&nbsp;Closing a Connection</h3>
        </div>
      </div>
    </div>
    <p>To close a connection, use the following statement:</p>
    <pre class="programlisting">
EXEC SQL DISCONNECT [<span class="optional"><em class="replaceable"><code>connection</code></em></span>];
</pre>
    <p>The <em class="replaceable"><code>connection</code></em> can be specified in the following ways:</p>
    <div class="itemizedlist">
      <ul class="itemizedlist" style="list-style-type: disc;">
        <li class="listitem"><code class="literal"><em class="replaceable"><code>connection-name</code></em></code></li>
        <li class="listitem"><code class="literal">CURRENT</code></li>
        <li class="listitem"><code class="literal">ALL</code></li>
      </ul>
    </div>
    <p>If no connection name is specified, the current connection is closed.</p>
    <p>It is good style that an application always explicitly disconnect from every connection it opened.</p>
  </div>
</div>
<div xmlns="http://www.w3.org/TR/xhtml1/transitional" class="navfooter">
  <hr />
  <table width="100%" summary="Navigation footer">
    <tr>
      <td width="40%" align="left"><a accesskey="p" href="ecpg-concept.html" title="35.1.&nbsp;The Concept">Prev</a>&nbsp;</td>
      <td width="20%" align="center"><a accesskey="u" href="ecpg.html" title="Chapter&nbsp;35.&nbsp;ECPG — Embedded SQL in C">Up</a></td>
      <td width="40%" align="right">&nbsp;<a accesskey="n" href="ecpg-commands.html" title="35.3.&nbsp;Running SQL Commands">Next</a></td>
    </tr>
    <tr>
      <td width="40%" align="left" valign="top">35.1.&nbsp;The Concept&nbsp;</td>
      <td width="20%" align="center"><a accesskey="h" href="index.html" title="PostgreSQL 13.20 Documentation">Home</a></td>
      <td width="40%" align="right" valign="top">&nbsp;35.3.&nbsp;Running SQL Commands</td>
    </tr>
  </table>
</div>

          </div>
          
            <div id="docComments">
              <h2>Submit correction</h2>
              <p>
              If you see anything in the documentation that is not correct, does not match
              your experience with the particular feature or requires further clarification,
              please use
              <a href="/account/comments/new/13/ecpg-connect.html/" rel="nofollow">this form</a>
              to report a documentation issue.
              </p>
            </div>
          
        </div> 
      </div>
    </div>
    
    
    
    
    
    
  </body>
</html>
