<!doctype html>
<html lang="en">
 <head>
  <title>PostgreSQL: Documentation: 13: 11.8. Partial Indexes</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta http-equiv="Content-Type" content="text/xhtml; charset=utf-8" />
   
  <meta name="theme-color" content="#336791"/>
  <meta name="copyright" content="The PostgreSQL Global Development Group" />
  <meta property="og:url" content="https://www.postgresql.org/docs/13/indexes-partial.html" />
  <meta property="og:type" content="article" />
  <meta property="article:published_time" content="2025-02-20T14:13:26" />
  <meta property="og:image" content="https://www.postgresql.org/media/img/about/press/elephant.png" />
  <meta property="og:title" content="11.8. Partial Indexes" />
  <meta property="og:description" content="11.8.&amp;nbsp;Partial Indexes A partial index is an index built over a subset of a table; the subset is defined by …" />
  <meta property="og:site_name" content="PostgreSQL Documentation" />


  

  
  
  
  
  

  

  
  </head>
  <body>
    <div class="container-fluid">
      <div class="row justify-content-md-center">
        <div class="col">
          
          
        </div>
      </div>
      <div class="row justify-content-center pg-shout-box">
        <div class="col text-white text-center">February 20, 2025: <a href="/about/news/postgresql-174-168-1512-1417-and-1320-released-3018/">
  PostgreSQL 17.4, 16.8, 15.12, 14.17, and 13.20 Released!
</a>

</div>
      </div>
    </div>
    <div class="container-fluid margin">
      <div class="row">
        <div id="pgContentWrap" class="col-11">
          <div class="row">
            <div class="col-md-6 mb-2">
              <div class="row">
                <div class="col">
                  <div>
                    <a href="/docs/" title="Documentation">Documentation</a> &rarr; <a href="/docs/13/index.html">PostgreSQL 13</a>
                  </div>
                </div>
              </div>
              
                <div class="row">
                  <div class="col">
                    Supported Versions:
                      
                        
                        
                          <a href="/docs/current/indexes-partial.html" title="PostgreSQL 17 - 11.8. Partial Indexes" >Current</a>
                          (<a href="/docs/17/indexes-partial.html" title="PostgreSQL 17 - 11.8. Partial Indexes" >17</a>)
                        
                      
                         / 
                        
                          <a href="/docs/16/indexes-partial.html" title="PostgreSQL 16 - 11.8. Partial Indexes" >16</a>
                        
                      
                         / 
                        
                          <a href="/docs/15/indexes-partial.html" title="PostgreSQL 15 - 11.8. Partial Indexes" >15</a>
                        
                      
                         / 
                        
                          <a href="/docs/14/indexes-partial.html" title="PostgreSQL 14 - 11.8. Partial Indexes" >14</a>
                        
                      
                         / 
                        
                          <a href="/docs/13/indexes-partial.html" title="PostgreSQL 13 - 11.8. Partial Indexes" class="docs-version-selected">13</a>
                        
                      
                  </div>
                </div>
              
              
                <div class="row">
                  <div class="col">
                    Development Versions:
                    
                      
                      <a href="/docs/devel/indexes-partial.html" title="PostgreSQL devel - 11.8. Partial Indexes"  rel="nofollow">devel</a>
                    
                  </div>
                </div>
              
              
                <div class="row">
                  <div class="col-12">
                    Unsupported versions:
                    
                      
                      <a href="/docs/12/indexes-partial.html" title="PostgreSQL 12 - 11.8. Partial Indexes"  rel="nofollow">12</a>
                    
                       / 
                      <a href="/docs/11/indexes-partial.html" title="PostgreSQL 11 - 11.8. Partial Indexes"  rel="nofollow">11</a>
                    
                       / 
                      <a href="/docs/10/indexes-partial.html" title="PostgreSQL 10 - 11.8. Partial Indexes"  rel="nofollow">10</a>
                    
                       / 
                      <a href="/docs/9.6/indexes-partial.html" title="PostgreSQL 9.6 - 11.8. Partial Indexes"  rel="nofollow">9.6</a>
                    
                       / 
                      <a href="/docs/9.5/indexes-partial.html" title="PostgreSQL 9.5 - 11.8. Partial Indexes"  rel="nofollow">9.5</a>
                    
                       / 
                      <a href="/docs/9.4/indexes-partial.html" title="PostgreSQL 9.4 - 11.8. Partial Indexes"  rel="nofollow">9.4</a>
                    
                       / 
                      <a href="/docs/9.3/indexes-partial.html" title="PostgreSQL 9.3 - 11.8. Partial Indexes"  rel="nofollow">9.3</a>
                    
                       / 
                      <a href="/docs/9.2/indexes-partial.html" title="PostgreSQL 9.2 - 11.8. Partial Indexes"  rel="nofollow">9.2</a>
                    
                       / 
                      <a href="/docs/9.1/indexes-partial.html" title="PostgreSQL 9.1 - 11.8. Partial Indexes"  rel="nofollow">9.1</a>
                    
                       / 
                      <a href="/docs/9.0/indexes-partial.html" title="PostgreSQL 9.0 - 11.8. Partial Indexes"  rel="nofollow">9.0</a>
                    
                       / 
                      <a href="/docs/8.4/indexes-partial.html" title="PostgreSQL 8.4 - 11.8. Partial Indexes"  rel="nofollow">8.4</a>
                    
                       / 
                      <a href="/docs/8.3/indexes-partial.html" title="PostgreSQL 8.3 - 11.8. Partial Indexes"  rel="nofollow">8.3</a>
                    
                       / 
                      <a href="/docs/8.2/indexes-partial.html" title="PostgreSQL 8.2 - 11.8. Partial Indexes"  rel="nofollow">8.2</a>
                    
                       / 
                      <a href="/docs/8.1/indexes-partial.html" title="PostgreSQL 8.1 - 11.8. Partial Indexes"  rel="nofollow">8.1</a>
                    
                       / 
                      <a href="/docs/8.0/indexes-partial.html" title="PostgreSQL 8.0 - 11.8. Partial Indexes"  rel="nofollow">8.0</a>
                    
                       / 
                      <a href="/docs/7.4/indexes-partial.html" title="PostgreSQL 7.4 - 11.8. Partial Indexes"  rel="nofollow">7.4</a>
                    
                       / 
                      <a href="/docs/7.3/indexes-partial.html" title="PostgreSQL 7.3 - 11.8. Partial Indexes"  rel="nofollow">7.3</a>
                    
                       / 
                      <a href="/docs/7.2/indexes-partial.html" title="PostgreSQL 7.2 - 11.8. Partial Indexes"  rel="nofollow">7.2</a>
                    
                  </div>
                </div>
              
            </div>
            <div class="col-md-6 col-lg-5 offset-lg-1">
              <form id="docSearchForm" role="search" method="get" action="/search/">
                <input type="hidden" name="u" value="/docs/13/" />
                <div class="input-group">
                  <input type="text" id="q" name="q" class="form-control" placeholder="Search the documentation for..."/>
                  <span class="input-group-btn">
                    <button class="btn btn-default" type="submit"><i class="fas fa-search"></i></button>
                  </span>
                </div>
              </form>
            </div>
          </div>

          <div id="docContent">
            <div xmlns="http://www.w3.org/TR/xhtml1/transitional" class="navheader">
  <table width="100%" summary="Navigation header">
    <tr>
      <th colspan="5" align="center">11.8.&nbsp;Partial Indexes</th>
    </tr>
    <tr>
      <td width="10%" align="left"><a accesskey="p" href="indexes-expressional.html" title="11.7.&nbsp;Indexes on Expressions">Prev</a>&nbsp;</td>
      <td width="10%" align="left"><a accesskey="u" href="indexes.html" title="Chapter&nbsp;11.&nbsp;Indexes">Up</a></td>
      <th width="60%" align="center">Chapter&nbsp;11.&nbsp;Indexes</th>
      <td width="10%" align="right"><a accesskey="h" href="index.html" title="PostgreSQL 13.20 Documentation">Home</a></td>
      <td width="10%" align="right">&nbsp;<a accesskey="n" href="indexes-index-only-scans.html" title="11.9.&nbsp;Index-Only Scans and Covering Indexes">Next</a></td>
    </tr>
  </table>
  <hr />
</div>
<div class="sect1" id="INDEXES-PARTIAL">
  <div class="titlepage">
    <div>
      <div>
        <h2 class="title" style="clear: both">11.8.&nbsp;Partial Indexes</h2>
      </div>
    </div>
  </div><a id="id-1.5.10.11.2" class="indexterm" name="id-1.5.10.11.2"></a>
  <p>A <em class="firstterm">partial index</em> is an index built over a subset of a table; the subset is defined by a conditional expression (called the <em class="firstterm">predicate</em> of the partial index). The index contains entries only for those table rows that satisfy the predicate. Partial indexes are a specialized feature, but there are several situations in which they are useful.</p>
  <p>One major reason for using a partial index is to avoid indexing common values. Since a query searching for a common value (one that accounts for more than a few percent of all the table rows) will not use the index anyway, there is no point in keeping those rows in the index at all. This reduces the size of the index, which will speed up those queries that do use the index. It will also speed up many table update operations because the index does not need to be updated in all cases. <a class="xref" href="indexes-partial.html#INDEXES-PARTIAL-EX1" title="Example&nbsp;11.1.&nbsp;Setting up a Partial Index to Exclude Common Values">Example&nbsp;11.1</a> shows a possible application of this idea.</p>
  <div class="example" id="INDEXES-PARTIAL-EX1">
    <p class="title"><strong>Example&nbsp;11.1.&nbsp;Setting up a Partial Index to Exclude Common Values</strong></p>
    <div class="example-contents">
      <p>Suppose you are storing web server access logs in a database. Most accesses originate from the IP address range of your organization but some are from elsewhere (say, employees on dial-up connections). If your searches by IP are primarily for outside accesses, you probably do not need to index the IP range that corresponds to your organization's subnet.</p>
      <p>Assume a table like this:</p>
      <pre class="programlisting">
CREATE TABLE access_log (
    url varchar,
    client_ip inet,
    ...
);
</pre>
      <p>To create a partial index that suits our example, use a command such as this:</p>
      <pre class="programlisting">
CREATE INDEX access_log_client_ip_ix ON access_log (client_ip)
WHERE NOT (client_ip &gt; inet '192.168.100.0' AND
           client_ip &lt; inet '192.168.100.255');
</pre>
      <p>A typical query that can use this index would be:</p>
      <pre class="programlisting">
SELECT *
FROM access_log
WHERE url = '/index.html' AND client_ip = inet '212.78.10.32';
</pre>
      <p>Here the query's IP address is covered by the partial index. The following query cannot use the partial index, as it uses an IP address that is excluded from the index:</p>
      <pre class="programlisting">
SELECT *
FROM access_log
WHERE url = '/index.html' AND client_ip = inet '192.168.100.23';
</pre>
      <p>Observe that this kind of partial index requires that the common values be predetermined, so such partial indexes are best used for data distributions that do not change. Such indexes can be recreated occasionally to adjust for new data distributions, but this adds maintenance effort.</p>
    </div>
  </div><br class="example-break" />
  <p>Another possible use for a partial index is to exclude values from the index that the typical query workload is not interested in; this is shown in <a class="xref" href="indexes-partial.html#INDEXES-PARTIAL-EX2" title="Example&nbsp;11.2.&nbsp;Setting up a Partial Index to Exclude Uninteresting Values">Example&nbsp;11.2</a>. This results in the same advantages as listed above, but it prevents the <span class="quote">“<span class="quote">uninteresting</span>”</span> values from being accessed via that index, even if an index scan might be profitable in that case. Obviously, setting up partial indexes for this kind of scenario will require a lot of care and experimentation.</p>
  <div class="example" id="INDEXES-PARTIAL-EX2">
    <p class="title"><strong>Example&nbsp;11.2.&nbsp;Setting up a Partial Index to Exclude Uninteresting Values</strong></p>
    <div class="example-contents">
      <p>If you have a table that contains both billed and unbilled orders, where the unbilled orders take up a small fraction of the total table and yet those are the most-accessed rows, you can improve performance by creating an index on just the unbilled rows. The command to create the index would look like this:</p>
      <pre class="programlisting">
CREATE INDEX orders_unbilled_index ON orders (order_nr)
    WHERE billed is not true;
</pre>
      <p>A possible query to use this index would be:</p>
      <pre class="programlisting">
SELECT * FROM orders WHERE billed is not true AND order_nr &lt; 10000;
</pre>
      <p>However, the index can also be used in queries that do not involve <code class="structfield">order_nr</code> at all, e.g.:</p>
      <pre class="programlisting">
SELECT * FROM orders WHERE billed is not true AND amount &gt; 5000.00;
</pre>
      <p>This is not as efficient as a partial index on the <code class="structfield">amount</code> column would be, since the system has to scan the entire index. Yet, if there are relatively few unbilled orders, using this partial index just to find the unbilled orders could be a win.</p>
      <p>Note that this query cannot use this index:</p>
      <pre class="programlisting">
SELECT * FROM orders WHERE order_nr = 3501;
</pre>
      <p>The order 3501 might be among the billed or unbilled orders.</p>
    </div>
  </div><br class="example-break" />
  <p><a class="xref" href="indexes-partial.html#INDEXES-PARTIAL-EX2" title="Example&nbsp;11.2.&nbsp;Setting up a Partial Index to Exclude Uninteresting Values">Example&nbsp;11.2</a> also illustrates that the indexed column and the column used in the predicate do not need to match. <span class="productname">PostgreSQL</span> supports partial indexes with arbitrary predicates, so long as only columns of the table being indexed are involved. However, keep in mind that the predicate must match the conditions used in the queries that are supposed to benefit from the index. To be precise, a partial index can be used in a query only if the system can recognize that the <code class="literal">WHERE</code> condition of the query mathematically implies the predicate of the index. <span class="productname">PostgreSQL</span> does not have a sophisticated theorem prover that can recognize mathematically equivalent expressions that are written in different forms. (Not only is such a general theorem prover extremely difficult to create, it would probably be too slow to be of any real use.) The system can recognize simple inequality implications, for example <span class="quote">“<span class="quote">x &lt; 1</span>”</span> implies <span class="quote">“<span class="quote">x &lt; 2</span>”</span>; otherwise the predicate condition must exactly match part of the query's <code class="literal">WHERE</code> condition or the index will not be recognized as usable. Matching takes place at query planning time, not at run time. As a result, parameterized query clauses do not work with a partial index. For example a prepared query with a parameter might specify <span class="quote">“<span class="quote">x &lt; ?</span>”</span> which will never imply <span class="quote">“<span class="quote">x &lt; 2</span>”</span> for all possible values of the parameter.</p>
  <p>A third possible use for partial indexes does not require the index to be used in queries at all. The idea here is to create a unique index over a subset of a table, as in <a class="xref" href="indexes-partial.html#INDEXES-PARTIAL-EX3" title="Example&nbsp;11.3.&nbsp;Setting up a Partial Unique Index">Example&nbsp;11.3</a>. This enforces uniqueness among the rows that satisfy the index predicate, without constraining those that do not.</p>
  <div class="example" id="INDEXES-PARTIAL-EX3">
    <p class="title"><strong>Example&nbsp;11.3.&nbsp;Setting up a Partial Unique Index</strong></p>
    <div class="example-contents">
      <p>Suppose that we have a table describing test outcomes. We wish to ensure that there is only one <span class="quote">“<span class="quote">successful</span>”</span> entry for a given subject and target combination, but there might be any number of <span class="quote">“<span class="quote">unsuccessful</span>”</span> entries. Here is one way to do it:</p>
      <pre class="programlisting">
CREATE TABLE tests (
    subject text,
    target text,
    success boolean,
    ...
);

CREATE UNIQUE INDEX tests_success_constraint ON tests (subject, target)
    WHERE success;
</pre>
      <p>This is a particularly efficient approach when there are few successful tests and many unsuccessful ones. It is also possible to allow only one null in a column by creating a unique partial index with an <code class="literal">IS NULL</code> restriction.</p>
    </div>
  </div><br class="example-break" />
  <p>Finally, a partial index can also be used to override the system's query plan choices. Also, data sets with peculiar distributions might cause the system to use an index when it really should not. In that case the index can be set up so that it is not available for the offending query. Normally, <span class="productname">PostgreSQL</span> makes reasonable choices about index usage (e.g., it avoids them when retrieving common values, so the earlier example really only saves index size, it is not required to avoid index usage), and grossly incorrect plan choices are cause for a bug report.</p>
  <p>Keep in mind that setting up a partial index indicates that you know at least as much as the query planner knows, in particular you know when an index might be profitable. Forming this knowledge requires experience and understanding of how indexes in <span class="productname">PostgreSQL</span> work. In most cases, the advantage of a partial index over a regular index will be minimal. There are cases where they are quite counterproductive, as in <a class="xref" href="indexes-partial.html#INDEXES-PARTIAL-EX4" title="Example&nbsp;11.4.&nbsp;Do Not Use Partial Indexes as a Substitute for Partitioning">Example&nbsp;11.4</a>.</p>
  <div class="example" id="INDEXES-PARTIAL-EX4">
    <p class="title"><strong>Example&nbsp;11.4.&nbsp;Do Not Use Partial Indexes as a Substitute for Partitioning</strong></p>
    <div class="example-contents">
      <p>You might be tempted to create a large set of non-overlapping partial indexes, for example</p>
      <pre class="programlisting">
CREATE INDEX mytable_cat_1 ON mytable (data) WHERE category = 1;
CREATE INDEX mytable_cat_2 ON mytable (data) WHERE category = 2;
CREATE INDEX mytable_cat_3 ON mytable (data) WHERE category = 3;
...
CREATE INDEX mytable_cat_<em class="replaceable"><code>N</code></em> ON mytable (data) WHERE category = <em class="replaceable"><code>N</code></em>;
</pre>
      <p>This is a bad idea! Almost certainly, you'll be better off with a single non-partial index, declared like</p>
      <pre class="programlisting">
CREATE INDEX mytable_cat_data ON mytable (category, data);
</pre>
      <p>(Put the category column first, for the reasons described in <a class="xref" href="indexes-multicolumn.html" title="11.3.&nbsp;Multicolumn Indexes">Section&nbsp;11.3</a>.) While a search in this larger index might have to descend through a couple more tree levels than a search in a smaller index, that's almost certainly going to be cheaper than the planner effort needed to select the appropriate one of the partial indexes. The core of the problem is that the system does not understand the relationship among the partial indexes, and will laboriously test each one to see if it's applicable to the current query.</p>
      <p>If your table is large enough that a single index really is a bad idea, you should look into using partitioning instead (see <a class="xref" href="ddl-partitioning.html" title="5.11.&nbsp;Table Partitioning">Section&nbsp;5.11</a>). With that mechanism, the system does understand that the tables and indexes are non-overlapping, so far better performance is possible.</p>
    </div>
  </div><br class="example-break" />
  <p>More information about partial indexes can be found in <a class="xref" href="biblio.html#STON89B">[ston89b]</a>, <a class="xref" href="biblio.html#OLSON93" title="Partial indexing in POSTGRES: research project">[olson93]</a>, and <a class="xref" href="biblio.html#SESHADRI95">[seshadri95]</a>.</p>
</div>
<div xmlns="http://www.w3.org/TR/xhtml1/transitional" class="navfooter">
  <hr />
  <table width="100%" summary="Navigation footer">
    <tr>
      <td width="40%" align="left"><a accesskey="p" href="indexes-expressional.html" title="11.7.&nbsp;Indexes on Expressions">Prev</a>&nbsp;</td>
      <td width="20%" align="center"><a accesskey="u" href="indexes.html" title="Chapter&nbsp;11.&nbsp;Indexes">Up</a></td>
      <td width="40%" align="right">&nbsp;<a accesskey="n" href="indexes-index-only-scans.html" title="11.9.&nbsp;Index-Only Scans and Covering Indexes">Next</a></td>
    </tr>
    <tr>
      <td width="40%" align="left" valign="top">11.7.&nbsp;Indexes on Expressions&nbsp;</td>
      <td width="20%" align="center"><a accesskey="h" href="index.html" title="PostgreSQL 13.20 Documentation">Home</a></td>
      <td width="40%" align="right" valign="top">&nbsp;11.9.&nbsp;Index-Only Scans and Covering Indexes</td>
    </tr>
  </table>
</div>

          </div>
          
            <div id="docComments">
              <h2>Submit correction</h2>
              <p>
              If you see anything in the documentation that is not correct, does not match
              your experience with the particular feature or requires further clarification,
              please use
              <a href="/account/comments/new/13/indexes-partial.html/" rel="nofollow">this form</a>
              to report a documentation issue.
              </p>
            </div>
          
        </div> 
      </div>
    </div>
    
    
    
    
    
    
  </body>
</html>
