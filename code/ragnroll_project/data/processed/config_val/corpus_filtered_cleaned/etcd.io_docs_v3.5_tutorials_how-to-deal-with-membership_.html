<!doctype html><html itemscope itemtype=http://schema.org/WebPage lang=en class=no-js><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>How to Add and Remove Members | etcd</title>
<meta name=description content="Guide to dealing with membership in etcd cluster"><meta property="og:url" content="https://etcd.io/docs/v3.5/tutorials/how-to-deal-with-membership/"><meta property="og:site_name" content="etcd"><meta property="og:title" content="How to Add and Remove Members"><meta property="og:description" content="Guide to dealing with membership in etcd cluster"><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="docs"><meta property="article:modified_time" content="2021-10-25T09:32:05-07:00"><meta itemprop=name content="How to Add and Remove Members"><meta itemprop=description content="Guide to dealing with membership in etcd cluster"><meta itemprop=dateModified content="2021-10-25T09:32:05-07:00"><meta itemprop=wordCount content="249"><meta name=twitter:card content="summary"><meta name=twitter:title content="How to Add and Remove Members"><meta name=twitter:description content="Guide to dealing with membership in etcd cluster"></head><body class=td-page><div class="container-fluid td-outer"><div class=td-main><div class="row flex-xl-nowrap"><main class="col-12 col-md-9 col-xl-8 ps-md-5" role=main><div class=td-content><h1>How to Add and Remove Members</h1><div class=lead>Guide to dealing with membership in etcd cluster</div><p><code>member</code> to add,remove,update membership:</p><p></p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#8f5902;font-style:italic># For each machine</span>
</span></span><span style=display:flex><span><span style=color:#000>TOKEN</span><span style=color:#ce5c00;font-weight:700>=</span>my-etcd-token-1
</span></span><span style=display:flex><span><span style=color:#000>CLUSTER_STATE</span><span style=color:#ce5c00;font-weight:700>=</span>new
</span></span><span style=display:flex><span><span style=color:#000>NAME_1</span><span style=color:#ce5c00;font-weight:700>=</span>etcd-node-1
</span></span><span style=display:flex><span><span style=color:#000>NAME_2</span><span style=color:#ce5c00;font-weight:700>=</span>etcd-node-2
</span></span><span style=display:flex><span><span style=color:#000>NAME_3</span><span style=color:#ce5c00;font-weight:700>=</span>etcd-node-3
</span></span><span style=display:flex><span><span style=color:#000>HOST_1</span><span style=color:#ce5c00;font-weight:700>=</span>10.240.0.13
</span></span><span style=display:flex><span><span style=color:#000>HOST_2</span><span style=color:#ce5c00;font-weight:700>=</span>10.240.0.14
</span></span><span style=display:flex><span><span style=color:#000>HOST_3</span><span style=color:#ce5c00;font-weight:700>=</span>10.240.0.15
</span></span><span style=display:flex><span><span style=color:#000>CLUSTER</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>${</span><span style=color:#000>NAME_1</span><span style=color:#4e9a06>}</span><span style=color:#ce5c00;font-weight:700>=</span>http://<span style=color:#4e9a06>${</span><span style=color:#000>HOST_1</span><span style=color:#4e9a06>}</span>:2380,<span style=color:#4e9a06>${</span><span style=color:#000>NAME_2</span><span style=color:#4e9a06>}</span><span style=color:#ce5c00;font-weight:700>=</span>http://<span style=color:#4e9a06>${</span><span style=color:#000>HOST_2</span><span style=color:#4e9a06>}</span>:2380,<span style=color:#4e9a06>${</span><span style=color:#000>NAME_3</span><span style=color:#4e9a06>}</span><span style=color:#ce5c00;font-weight:700>=</span>http://<span style=color:#4e9a06>${</span><span style=color:#000>HOST_3</span><span style=color:#4e9a06>}</span>:2380
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># For node 1</span>
</span></span><span style=display:flex><span><span style=color:#000>THIS_NAME</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>${</span><span style=color:#000>NAME_1</span><span style=color:#4e9a06>}</span>
</span></span><span style=display:flex><span><span style=color:#000>THIS_IP</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>${</span><span style=color:#000>HOST_1</span><span style=color:#4e9a06>}</span>
</span></span><span style=display:flex><span>etcd --data-dir<span style=color:#ce5c00;font-weight:700>=</span>data.etcd --name <span style=color:#4e9a06>${</span><span style=color:#000>THIS_NAME</span><span style=color:#4e9a06>}</span> <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>	--initial-advertise-peer-urls http://<span style=color:#4e9a06>${</span><span style=color:#000>THIS_IP</span><span style=color:#4e9a06>}</span>:2380 <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>	--listen-peer-urls http://<span style=color:#4e9a06>${</span><span style=color:#000>THIS_IP</span><span style=color:#4e9a06>}</span>:2380 <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>	--advertise-client-urls http://<span style=color:#4e9a06>${</span><span style=color:#000>THIS_IP</span><span style=color:#4e9a06>}</span>:2379 <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>	--listen-client-urls http://<span style=color:#4e9a06>${</span><span style=color:#000>THIS_IP</span><span style=color:#4e9a06>}</span>:2379 <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>	--initial-cluster <span style=color:#4e9a06>${</span><span style=color:#000>CLUSTER</span><span style=color:#4e9a06>}</span> <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>	--initial-cluster-state <span style=color:#4e9a06>${</span><span style=color:#000>CLUSTER_STATE</span><span style=color:#4e9a06>}</span> <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>	--initial-cluster-token <span style=color:#4e9a06>${</span><span style=color:#000>TOKEN</span><span style=color:#4e9a06>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># For node 2</span>
</span></span><span style=display:flex><span><span style=color:#000>THIS_NAME</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>${</span><span style=color:#000>NAME_2</span><span style=color:#4e9a06>}</span>
</span></span><span style=display:flex><span><span style=color:#000>THIS_IP</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>${</span><span style=color:#000>HOST_2</span><span style=color:#4e9a06>}</span>
</span></span><span style=display:flex><span>etcd --data-dir<span style=color:#ce5c00;font-weight:700>=</span>data.etcd --name <span style=color:#4e9a06>${</span><span style=color:#000>THIS_NAME</span><span style=color:#4e9a06>}</span> <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>	--initial-advertise-peer-urls http://<span style=color:#4e9a06>${</span><span style=color:#000>THIS_IP</span><span style=color:#4e9a06>}</span>:2380 <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>	--listen-peer-urls http://<span style=color:#4e9a06>${</span><span style=color:#000>THIS_IP</span><span style=color:#4e9a06>}</span>:2380 <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>	--advertise-client-urls http://<span style=color:#4e9a06>${</span><span style=color:#000>THIS_IP</span><span style=color:#4e9a06>}</span>:2379 <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>	--listen-client-urls http://<span style=color:#4e9a06>${</span><span style=color:#000>THIS_IP</span><span style=color:#4e9a06>}</span>:2379 <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>	--initial-cluster <span style=color:#4e9a06>${</span><span style=color:#000>CLUSTER</span><span style=color:#4e9a06>}</span> <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>	--initial-cluster-state <span style=color:#4e9a06>${</span><span style=color:#000>CLUSTER_STATE</span><span style=color:#4e9a06>}</span> <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>	--initial-cluster-token <span style=color:#4e9a06>${</span><span style=color:#000>TOKEN</span><span style=color:#4e9a06>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># For node 3</span>
</span></span><span style=display:flex><span><span style=color:#000>THIS_NAME</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>${</span><span style=color:#000>NAME_3</span><span style=color:#4e9a06>}</span>
</span></span><span style=display:flex><span><span style=color:#000>THIS_IP</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>${</span><span style=color:#000>HOST_3</span><span style=color:#4e9a06>}</span>
</span></span><span style=display:flex><span>etcd --data-dir<span style=color:#ce5c00;font-weight:700>=</span>data.etcd --name <span style=color:#4e9a06>${</span><span style=color:#000>THIS_NAME</span><span style=color:#4e9a06>}</span> <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>	--initial-advertise-peer-urls http://<span style=color:#4e9a06>${</span><span style=color:#000>THIS_IP</span><span style=color:#4e9a06>}</span>:2380 <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>	--listen-peer-urls http://<span style=color:#4e9a06>${</span><span style=color:#000>THIS_IP</span><span style=color:#4e9a06>}</span>:2380 <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>	--advertise-client-urls http://<span style=color:#4e9a06>${</span><span style=color:#000>THIS_IP</span><span style=color:#4e9a06>}</span>:2379 <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>	--listen-client-urls http://<span style=color:#4e9a06>${</span><span style=color:#000>THIS_IP</span><span style=color:#4e9a06>}</span>:2379 <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>	--initial-cluster <span style=color:#4e9a06>${</span><span style=color:#000>CLUSTER</span><span style=color:#4e9a06>}</span> <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>	--initial-cluster-state <span style=color:#4e9a06>${</span><span style=color:#000>CLUSTER_STATE</span><span style=color:#4e9a06>}</span> <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>	--initial-cluster-token <span style=color:#4e9a06>${</span><span style=color:#000>TOKEN</span><span style=color:#4e9a06>}</span>
</span></span></code></pre></div><p>Then replace a member with <code>member remove</code> and <code>member add</code> commands:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#8f5902;font-style:italic># get member ID</span>
</span></span><span style=display:flex><span><span style=color:#204a87>export</span> <span style=color:#000>ETCDCTL_API</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#0000cf;font-weight:700>3</span>
</span></span><span style=display:flex><span><span style=color:#000>HOST_1</span><span style=color:#ce5c00;font-weight:700>=</span>10.240.0.13
</span></span><span style=display:flex><span><span style=color:#000>HOST_2</span><span style=color:#ce5c00;font-weight:700>=</span>10.240.0.14
</span></span><span style=display:flex><span><span style=color:#000>HOST_3</span><span style=color:#ce5c00;font-weight:700>=</span>10.240.0.15
</span></span><span style=display:flex><span>etcdctl --endpoints<span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>${</span><span style=color:#000>HOST_1</span><span style=color:#4e9a06>}</span>:2379,<span style=color:#4e9a06>${</span><span style=color:#000>HOST_2</span><span style=color:#4e9a06>}</span>:2379,<span style=color:#4e9a06>${</span><span style=color:#000>HOST_3</span><span style=color:#4e9a06>}</span>:2379 member list
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># remove the member</span>
</span></span><span style=display:flex><span><span style=color:#000>MEMBER_ID</span><span style=color:#ce5c00;font-weight:700>=</span>278c654c9a6dfd3b
</span></span><span style=display:flex><span>etcdctl --endpoints<span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>${</span><span style=color:#000>HOST_1</span><span style=color:#4e9a06>}</span>:2379,<span style=color:#4e9a06>${</span><span style=color:#000>HOST_2</span><span style=color:#4e9a06>}</span>:2379,<span style=color:#4e9a06>${</span><span style=color:#000>HOST_3</span><span style=color:#4e9a06>}</span>:2379 <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>	member remove <span style=color:#4e9a06>${</span><span style=color:#000>MEMBER_ID</span><span style=color:#4e9a06>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># add a new member (node 4)</span>
</span></span><span style=display:flex><span><span style=color:#204a87>export</span> <span style=color:#000>ETCDCTL_API</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#0000cf;font-weight:700>3</span>
</span></span><span style=display:flex><span><span style=color:#000>NAME_1</span><span style=color:#ce5c00;font-weight:700>=</span>etcd-node-1
</span></span><span style=display:flex><span><span style=color:#000>NAME_2</span><span style=color:#ce5c00;font-weight:700>=</span>etcd-node-2
</span></span><span style=display:flex><span><span style=color:#000>NAME_4</span><span style=color:#ce5c00;font-weight:700>=</span>etcd-node-4
</span></span><span style=display:flex><span><span style=color:#000>HOST_1</span><span style=color:#ce5c00;font-weight:700>=</span>10.240.0.13
</span></span><span style=display:flex><span><span style=color:#000>HOST_2</span><span style=color:#ce5c00;font-weight:700>=</span>10.240.0.14
</span></span><span style=display:flex><span><span style=color:#000>HOST_4</span><span style=color:#ce5c00;font-weight:700>=</span>10.240.0.16 <span style=color:#8f5902;font-style:italic># new member</span>
</span></span><span style=display:flex><span>etcdctl --endpoints<span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>${</span><span style=color:#000>HOST_1</span><span style=color:#4e9a06>}</span>:2379,<span style=color:#4e9a06>${</span><span style=color:#000>HOST_2</span><span style=color:#4e9a06>}</span>:2379 <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>	member add <span style=color:#4e9a06>${</span><span style=color:#000>NAME_4</span><span style=color:#4e9a06>}</span> <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>	--peer-urls<span style=color:#ce5c00;font-weight:700>=</span>http://<span style=color:#4e9a06>${</span><span style=color:#000>HOST_4</span><span style=color:#4e9a06>}</span>:2380
</span></span></code></pre></div><p>Next, start the new member with <code>--initial-cluster-state existing</code> flag:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#8f5902;font-style:italic># [WARNING] If the new member starts from the same disk space,</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># make sure to remove the data directory of the old member</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>#</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># restart with &#39;existing&#39; flag</span>
</span></span><span style=display:flex><span><span style=color:#000>TOKEN</span><span style=color:#ce5c00;font-weight:700>=</span>my-etcd-token-1
</span></span><span style=display:flex><span><span style=color:#000>CLUSTER_STATE</span><span style=color:#ce5c00;font-weight:700>=</span>existing
</span></span><span style=display:flex><span><span style=color:#000>NAME_1</span><span style=color:#ce5c00;font-weight:700>=</span>etcd-node-1
</span></span><span style=display:flex><span><span style=color:#000>NAME_2</span><span style=color:#ce5c00;font-weight:700>=</span>etcd-node-2
</span></span><span style=display:flex><span><span style=color:#000>NAME_4</span><span style=color:#ce5c00;font-weight:700>=</span>etcd-node-4
</span></span><span style=display:flex><span><span style=color:#000>HOST_1</span><span style=color:#ce5c00;font-weight:700>=</span>10.240.0.13
</span></span><span style=display:flex><span><span style=color:#000>HOST_2</span><span style=color:#ce5c00;font-weight:700>=</span>10.240.0.14
</span></span><span style=display:flex><span><span style=color:#000>HOST_4</span><span style=color:#ce5c00;font-weight:700>=</span>10.240.0.16 <span style=color:#8f5902;font-style:italic># new member</span>
</span></span><span style=display:flex><span><span style=color:#000>CLUSTER</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>${</span><span style=color:#000>NAME_1</span><span style=color:#4e9a06>}</span><span style=color:#ce5c00;font-weight:700>=</span>http://<span style=color:#4e9a06>${</span><span style=color:#000>HOST_1</span><span style=color:#4e9a06>}</span>:2380,<span style=color:#4e9a06>${</span><span style=color:#000>NAME_2</span><span style=color:#4e9a06>}</span><span style=color:#ce5c00;font-weight:700>=</span>http://<span style=color:#4e9a06>${</span><span style=color:#000>HOST_2</span><span style=color:#4e9a06>}</span>:2380,<span style=color:#4e9a06>${</span><span style=color:#000>NAME_4</span><span style=color:#4e9a06>}</span><span style=color:#ce5c00;font-weight:700>=</span>http://<span style=color:#4e9a06>${</span><span style=color:#000>HOST_4</span><span style=color:#4e9a06>}</span>:2380
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#000>THIS_NAME</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>${</span><span style=color:#000>NAME_4</span><span style=color:#4e9a06>}</span>
</span></span><span style=display:flex><span><span style=color:#000>THIS_IP</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>${</span><span style=color:#000>HOST_4</span><span style=color:#4e9a06>}</span>
</span></span><span style=display:flex><span>etcd --data-dir<span style=color:#ce5c00;font-weight:700>=</span>data.etcd --name <span style=color:#4e9a06>${</span><span style=color:#000>THIS_NAME</span><span style=color:#4e9a06>}</span> <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>	--initial-advertise-peer-urls http://<span style=color:#4e9a06>${</span><span style=color:#000>THIS_IP</span><span style=color:#4e9a06>}</span>:2380 <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>	--listen-peer-urls http://<span style=color:#4e9a06>${</span><span style=color:#000>THIS_IP</span><span style=color:#4e9a06>}</span>:2380 <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>	--advertise-client-urls http://<span style=color:#4e9a06>${</span><span style=color:#000>THIS_IP</span><span style=color:#4e9a06>}</span>:2379 <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>	--listen-client-urls http://<span style=color:#4e9a06>${</span><span style=color:#000>THIS_IP</span><span style=color:#4e9a06>}</span>:2379 <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>	--initial-cluster <span style=color:#4e9a06>${</span><span style=color:#000>CLUSTER</span><span style=color:#4e9a06>}</span> <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>	--initial-cluster-state <span style=color:#4e9a06>${</span><span style=color:#000>CLUSTER_STATE</span><span style=color:#4e9a06>}</span> <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>	--initial-cluster-token <span style=color:#4e9a06>${</span><span style=color:#000>TOKEN</span><span style=color:#4e9a06>}</span>
</span></span></code></pre></div><div class=d-print-none><h2 class=feedback--title>Feedback</h2><p class=feedback--question>Was this page helpful?</p><button class="btn btn-primary mb-4 feedback--answer feedback--answer-yes">Yes</button>
<button class="btn btn-primary mb-4 feedback--answer feedback--answer-no">No</button><p class="feedback--response feedback--response-yes">Glad to hear it! Please <a href=https://github.com/etcd-io/website/issues/new>tell us how we can improve</a>.</p><p class="feedback--response feedback--response-no">Sorry to hear that. Please <a href=https://github.com/etcd-io/website/issues/new>tell us how we can improve</a>.</p></div><br><div class=td-page-meta__lastmod>Last modified October 25, 2021: <a href=https://github.com/etcd-io/website/commit/f54f3577a986cf608346020679191c46b910742a>adding weights to tutorials section. Setting weight for the Tutorials page to be just below old Demos page. Setting weight in individual pages to match order in old Demos page. (#530) (f54f357)</a></div></div></main></div></div></div></body></html>